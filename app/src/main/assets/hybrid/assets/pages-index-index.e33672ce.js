import{u as e,a,b as l,c as t,s,r as i,o,i as u,d as n,e as r,f as c,g as d,h as v,$ as f,j as _,k as p,l as b,w as m,m as h,n as w,p as g,q as y,t as k,v as x,x as T,y as C,F as I,z as F,A as j,B as A,C as B,D as M,E as D,G as S,H as E,I as U,J as $,K as q,L,M as P,N as z,O as V,P as G,Q as N,R as O,S as R,T as H,U as J,V as K,W as Q,X as W,Y as X,Z as Y,_ as Z,a0 as ee}from"./index-57837331.js";import{D as ae,v as le,_ as te}from"./verify.2515faf7.js";import{i as se,g as ie,_ as oe,a as ue,b as ne,c as re}from"./platform.a4ea23e8.js";import{_ as ce,a as de}from"./ti-button.4f7538b7.js";import"./components-ti-keyboard-ti-keyboard.d1d94a05.js";const ve=ce({__name:"index",setup(ce){const ve=e(),fe=a(),_e=l(),pe=t(),{userInfo:be}=s(fe),{tableInfo:me}=s(_e);i({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1});const he=i({ip:"",port:"",device_id:"",remark:""}),we=i(0),ge=i(!0);i(!1),i(!1);const ye=i();i([]);const ke=i(3e4),xe=i(!1),Te=i(),Ce=i("");i([]);const Ie=i(),Fe=i(!1),je=i(),Ae=i(!1),Be=i(!1),Me=i(!0),De=i(!1),Se=i(!1),Ee=i(!1);i(!0);const Ue=window.config().versionName,$e=()=>{},qe=()=>{},Le=()=>{const e=w();he.value.ip=(null==e?void 0:e.ip)||g()||"127.0.0.1",he.value.port=(null==e?void 0:e.port)||"8080"},Pe=e=>{he.value.remark=e},ze=e=>{he.value.ip=e},Ve=e=>{he.value.port=e},Ge=async()=>{var e;const a={...he.value};if(a.ip)if(a.port)try{const l=await D(S(`${null==a?void 0:a.ip}:${a.port}`),!1);1==parseInt(l.data.cashier.order_method.is_table_order)?(E(a),U(l.data.app_id),$(l.data.shop_supplier_id),q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Fe.value=!0}),150),ve.clearCartData()):uni.showToast({title:A("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){-102==l.code?uni.showToast({title:A("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:A("绑定失败"),icon:"none"})}else uni.showToast({title:A("請輸入連接埠"),icon:"none"});else uni.showToast({title:A("請輸入伺服器位址"),icon:"none"})},Ne=e=>{Fe.value=!1,e&&(Ie.value=e,Ce.value=e.table_no)},Oe=()=>{null==pe||pe.goodsBaseRefresh({},!0),setTimeout((()=>{uni.showToast({title:A("清除成功"),icon:"none"})}),100)},Re=()=>{Le(),Ce.value=L().table_no,Ie.value=L(),he.value.remark=P("machine_remark")},He=async()=>{var e;const a={...he.value};if(a.ip)if(a.port)if(w().ip==a.ip&&w().port==a.port||z()!==Ie.value.table_id)try{const l=await D(S(`${null==a?void 0:a.ip}:${a.port}`),!1);if(!Ie.value)return void uni.showToast({title:A("請查找桌位"),icon:"none"});1==parseInt(l.data.cashier.order_method.is_table_order)?(E(a),U(l.data.app_id),$(l.data.shop_supplier_id),q(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Je()}),150)):uni.showToast({title:A("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){-102==l.code?uni.showToast({title:A("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:A("綁定失敗"),icon:"none"})}else uni.showToast({title:A("請查找桌位"),icon:"none"});else uni.showToast({title:A("請輸入連接埠"),icon:"none"});else uni.showToast({title:A("請輸入伺服器位址"),icon:"none"})},Je=async()=>{if(z()===Ie.value.table_id&&he.value.remark==P("machine_remark"))return uni.showToast({title:A("绑定成功"),icon:"none"}),void(Te.value=!1);try{const e=await V({key:P("machine_id"),table_id:Ie.value.table_id,old_table_id:z(),device_remark:he.value.remark});G(Ie.value),null==fe||fe.getUserInfo(!0),null==_e||_e.getTableInfoAsync(!0),uni.showToast({title:e.msg,icon:"none"}),Te.value=!1,he.value.remark!=P("machine_remark")&&N({key:"machine_remark",data:he.value.remark}),ve.clearCartData()}catch(e){uni.showToast({title:e.msg||e.errMsg,icon:"none"})}},Ke=()=>{Ye()},Qe=async()=>{var e,a,l,t,s,i;try{if(await(null==fe?void 0:fe.getUserInfo(!0)),1!=parseInt(null==(e=null==be?void 0:be.value)?void 0:e.cashier.order_method.is_table_order))return void(null==(a=je.value)||a.tiCallClick("1"));const o=await(null==_e?void 0:_e.getTableInfoAsync(!0));if(30===o.data.status){if(1==(null==(l=o.data.order)?void 0:l.is_buffet))return Ae.value=!0,xe.value=!0,void hideVideoCloseSwiperAutoplay();null==_e||_e.openTablePage(null==(s=null==(t=o.data)?void 0:t.order)?void 0:s.is_buffet)}else 1===parseInt(o.data.tablet.is_customer_order)?We():null==(i=je.value)||i.tiCallClick("1")}catch(o){"request:fail"==o.errMsg&&null!=(null==pe?void 0:pe.getGoodsBaseList())&&(null==_e||_e.openTablePage())}},We=()=>{Me.value=1==be.value.buffet.is_open,Be.value=!0},Xe=e=>{var a;Be.value=!1,e&&(null==(a=je.value)||a.tiCallClick("1"))},Ye=()=>{Se.value=!0,Ee.value=!0},Ze=async e=>{if(e)try{await le({password:e});Te.value=!0,he.value.remark=P("machine_remark")||"",Ie.value=L(),Ce.value=Ie.value.table_no,ea()}catch(a){"request:fail"==a.errMsg||"request:fail"==a.errmsg?uni.showToast({title:A("网络异常，请检查您的网络设置"),icon:"none"}):(a.errMsg||a.msg)&&uni.showToast({title:a.msg||a.errMsg,icon:"none"})}else uni.showToast({title:A("請輸入密碼"),icon:"none",duration:3e3})},ea=()=>{Se.value=!1,Ee.value=!1},aa=e=>{var a,l;we.value=(null==e?void 0:e.detail.current)||0,ke.value=3e4,ta(null==(l=null==(a=be.value)?void 0:a.tablet)?void 0:l.carousel,we.value)},la=e=>{let a=Math.floor(e.detail.duration)+5;ke.value=1e3*a},ta=(e,a)=>{const l=e[a];"video"==y(l.real_name)&&setTimeout((()=>{ye.value=l}),50)},sa=()=>{var e,a,l,t;Y().in(this).select(".ti-swiper-item-video").fields({node:!0,size:!0}).exec((e=>{e[0].node.play()})),we.value==(null==(a=null==(e=be.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(we.value=0,ta(null==(t=null==(l=be.value)?void 0:l.tablet)?void 0:t.carousel,we.value)):we.value+=1};return o((()=>{null==_e||_e.getTableInfoAsync(),u()&&n()&&r({url:"/pages/index/opentable-index"})})),c((()=>{var e;null==(e=je.value)||e.showBuffet(!1,0)})),Le(),d((()=>{aa(),null==fe||fe.getUserInfo(!0),null==_e||_e.getTableInfoAsync(!0),se()?he.value.device_id=ie():v({success:e=>{he.value.device_id=e.deviceId}})})),f("authorization",(e=>{De.value=!e})),(e,a)=>{const l=O(R("ti-layout-head"),te),t=k,s=H,i=Z,o=ee,r=J,c=K,d=Q,v=O(R("ti-input"),ue),f=O(R("ti-layout-table-list"),ne),w=O(R("ti-button"),de),g=O(R("ti-modal"),re),D=W;return _(u)()&&!_(n)()?(p(),b(t,{key:0,class:"ti-page",onClick:a[4]||(a[4]=e=>_(M)())},{default:m((()=>[x(t,null,{default:m((()=>{var e,a;return[x(l,{ref_key:"refCallServer",ref:je,onDoubleLogo:Ke,is_call_service:parseInt(null==(a=null==(e=_(be))?void 0:e.tablet)?void 0:a.is_call_service)},null,8,["is_call_service"])]})),_:1}),x(t,{class:"ti-page-content"},{default:m((()=>{var e;return[x(t,{class:"ti-page-left"},{default:m((()=>[x(r,{onChange:aa,class:"ti-swiper",current:we.value,autoplay:ge.value,circular:"",interval:ke.value,"indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:m((()=>{var e,l;return[(p(!0),T(I,null,C(null==(l=null==(e=_(be))?void 0:e.tablet)?void 0:l.carousel,((e,l)=>(p(),b(o,{class:"ti-swiper-item",key:l},{default:m((()=>["image"===_(y)(e.real_name)?(p(),b(t,{key:0,class:"ti-swiper-item"},{default:m((()=>["image"===_(y)(e.real_name)?(p(),b(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):h("",!0)])),_:2},1024)):h("",!0),"video"===_(y)(e.real_name)?(p(),b(t,{key:1,class:"ti-swiper-item",onTouchmove:a[0]||(a[0]=X((()=>{}),["stop"]))},{default:m((()=>{var e;return[x(i,{onEnded:sa,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ye.value)?void 0:e.file_path,onLoadedmetadata:la},null,8,["src"])]})),_:1})):h("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay","interval"])])),_:1}),x(t,{class:"ti-page-right"},{default:m((()=>[x(t,{class:"ti-store-box"},{default:m((()=>[x(t,{class:"ti-store-item"},{default:m((()=>{var e;return[x(s,{class:"ti-store-logo",src:null==(e=_(be))?void 0:e.logo},null,8,["src"]),x(c,{class:"ti-store-name"},{default:m((()=>{var e;return[F(j(null==(e=_(be))?void 0:e.name),1)]})),_:1})]})),_:1}),x(t,{class:"ti-table-item"},{default:m((()=>[x(t,{class:"ti-table-number"},{default:m((()=>{var e;return[F(j(_(A)("桌號："))+j(null==(e=_(me))?void 0:e.table_no),1)]})),_:1}),x(t,{class:"ti-table-button",onClick:Qe},{default:m((()=>[x(c,{class:"ti-table-button-text"},{default:m((()=>[F(j(_(A)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),x(ae,{show:Be.value,title:"["+(null==(e=_(me))?void 0:e.table_no)+"]"+_(A)("就餐人数"),placeholder:_(A)("請輸入人數"),isBuffet:Me.value,password:Ee.value,onExit:Xe},null,8,["show","title","placeholder","isBuffet","password"]),x(ae,{show:Se.value,title:_(A)("密碼"),password:Ee.value,placeholder:_(A)("請輸入密碼"),onExit:ea,onConfirm:Ze},null,8,["show","title","password","placeholder"])]})),_:1}),x(g,{show:Te.value,title:_(A)("設置")},{content:m((()=>[x(t,{class:"ti-item-input"},{default:m((()=>[x(t,{class:"ti-label-box"},{default:m((()=>[x(t,{class:"ti-label-left"},{default:m((()=>[x(c,{class:"ti-label-server"},{default:m((()=>[F(j(_(A)("客戶端版本")),1)])),_:1}),x(c,{class:"ti-label-server",style:{"margin-left":"50px"}},{default:m((()=>[F(j(_(Ue)),1)])),_:1}),x(c,{class:"ti-label-server",style:{"margin-left":"10px",color:"blue"},onClick:$e},{default:m((()=>[F(j(_(A)("檢查新版本")),1)])),_:1}),x(c,{class:"ti-label-server",style:{"margin-left":"50px"}},{default:m((()=>[F(j(_(A)("服務端版本")),1)])),_:1}),x(c,{class:"ti-label-server",style:{"margin-left":"30px"}},{default:m((()=>[F(j(_(Ue)),1)])),_:1})])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-item-input"},{default:m((()=>[x(t,{class:"ti-label-box"},{default:m((()=>[x(t,{class:"ti-label-left",style:{"align-items":"center","justify-content":"center"}},{default:m((()=>[x(c,{class:"ti-label-server"},{default:m((()=>[F(j(_(A)("聲音提醒")),1)])),_:1}),x(d,{style:{"margin-left":"30px"},checked:"true",onChange:qe}),x(c,{class:"ti-label-server",style:{"margin-left":"10px"}},{default:m((()=>[F(j(_(A)("注：默認開啓")),1)])),_:1})])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-item-input"},{default:m((()=>[x(t,{class:"ti-label-box"},{default:m((()=>[x(t,{class:"ti-label-left"},{default:m((()=>[x(c,{class:"ti-label-server"},{default:m((()=>[F(j(_(A)("當前機器ID")),1)])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-input-box"},{default:m((()=>[x(v,{type:"text",clearable:!1,disabled:!0,value:he.value.device_id},null,8,["value"])])),_:1})])),_:1}),x(t,{class:"ti-item-input"},{default:m((()=>[x(t,{class:"ti-label-box"},{default:m((()=>[x(t,{class:"ti-label-left"},{default:m((()=>[x(c,{class:"ti-label-server"},{default:m((()=>[F(j(_(A)("機器備註(非必填)")),1)])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-input-box"},{default:m((()=>[x(v,{type:"text",value:he.value.remark,onInput:Pe,placeholder:_(A)("機器備註"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),x(t,{class:"ti-item-input"},{default:m((()=>[x(t,{class:"ti-label-box"},{default:m((()=>[x(t,{class:"ti-label-left"},{default:m((()=>[x(c,{class:"ti-label-server"},{default:m((()=>[F(j(_(A)("服務器連接地址")),1)])),_:1})])),_:1}),x(t,{class:"ti-label-right",onClick:Ge},{default:m((()=>[x(c,{class:"ti-label-table"},{default:m((()=>[F(j(Ce.value?_(A)("已選 : ")+_(B)(Ce.value,19):_(A)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),x(t,{class:"ti-input-box"},{default:m((()=>[x(v,{type:"text",onInput:ze,value:he.value.ip,placeholder:_(A)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),x(t,{class:"ti-colon"},{default:m((()=>[F(":")])),_:1}),x(t,{class:"ti-input-port"},{default:m((()=>[x(v,{type:"number",onInput:Ve,value:he.value.port,placeholder:_(A)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),x(f,{show:Fe.value,"onUpdate:show":a[1]||(a[1]=e=>Fe.value=e),onConfirm:Ne},null,8,["show"])])),_:1})])),footer:m((()=>[x(t,{class:"footer-button"},{default:m((()=>[x(w,{onClick:Oe},{default:m((()=>[F(j(_(A)("清除緩存")),1)])),_:1}),x(w,{onClick:Re},{default:m((()=>[F(j(_(A)("重置")),1)])),_:1}),x(w,{type:"primary",onClick:He},{default:m((()=>[F(j(_(A)("確定")),1)])),_:1})])),_:1})])),_:1},8,["show","title"]),x(g,{class:"ti-dialog-buffet",show:xe.value,title:_(A)("提示"),onCancel:a[2]||(a[2]=a=>(xe.value=!1,Ae.value=!1,e.showVideoOpenSwiperAutoplay())),onConfirm:a[3]||(a[3]=e=>{null==_e||_e.openTablePage(1)})},{content:m((()=>[x(t,{class:"ti-dialog-content"},{default:m((()=>[x(D,{class:"ti-buffet-scroll","scroll-y":""},{default:m((()=>[x(t,{class:"ti-buffet-message"},{default:m((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:m((()=>[F(j(_(A)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:m((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:m((()=>[F(j(_(A)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:m((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:m((()=>[F(j(_(A)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-message"},{default:m((()=>[x(t,{class:"ti-buffet-case"}),x(t,{class:"ti-buffet-text"},{default:m((()=>[F(j(_(A)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),x(t,{class:"ti-buffet-tips"},{default:m((()=>[F(j(_(A)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),x(g,{class:"ti-action-tips",show:De.value,title:_(A)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:_(A)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:m((()=>[x(t,{class:"warning-header"},{default:m((()=>[x(t,{class:"warning-image-round"},{default:m((()=>[x(s,{class:"warning-image",src:oe,mode:""})])),_:1}),x(t,{class:"warning-text"},{default:m((()=>[F(j(_(A)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})):h("",!0)}}},[["__scopeId","data-v-e30d16a7"]]);export{ve as default};
