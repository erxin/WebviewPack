import{r as e,h as t,j as a,w as l,q as s,k as i,a5 as u,n as o,F as n,t as c,a3 as r,a6 as d,a7 as _,e as v,a8 as f,R as p,S as m,p as h,f as g,a9 as b,aa as y,Y as w,ab as k,v as x,x as C,a0 as T,X as I,s as A,ac as L,ad as S,ae as O,af as U,ag as D,y as R,ah as P,ai as E,aj as N,ak as j,K as B,T as z,a1 as F,al as $,u as M,$ as q,am as Q,an as W,ao as K,ap as G,aq as Y,ar as H,as as J,at as V,au as X,av as Z,o as ee,g as te,d as ae,l as le,m as se,aw as ie,I as ue,H as oe,ax as ne,z as ce,A as re,B as de,C as _e,D as ve,E as fe,G as pe,J as me,P as he,c as ge,L as be,M as ye,N as we}from"./index-301fad33.js";import{i as ke,a as xe,b as Ce,c as Te,D as Ie,v as Ae,_ as Le}from"./verify.c03d2a0a.js";import{e as Se,r as Oe,u as Ue,f as De,c as Re,h as Pe,j as Ee,k as Ne,i as je,g as Be,_ as ze,a as Fe,b as $e}from"./platform.ecb524cd.js";import{_ as Me,a as qe}from"./ti-button.8ef07edc.js";import"./components-ti-keyboard-ti-keyboard.372de17d.js";var Qe=/\s/;var We=/^\s+/;function Ke(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Qe.test(e.charAt(t)););return t}(e)+1).replace(We,""):e}var Ge=NaN,Ye=/^[-+]0x[0-9a-f]+$/i,He=/^0b[01]+$/i,Je=/^0o[0-7]+$/i,Ve=parseInt;function Xe(e){if("number"==typeof e)return e;if(ke(e))return Ge;if(Se(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Se(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ke(e);var a=He.test(e);return a||Je.test(e)?Ve(e.slice(2),a?2:8):Ye.test(e)?Ge:+e}const Ze=function(){return Oe.Date.now()};var et=Math.max,tt=Math.min;function at(e,t,a){var l,s,i,u,o,n,c=0,r=!1,d=!1,_=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var a=l,i=s;return l=s=void 0,c=t,u=e.apply(i,a)}function f(e){var a=e-n;return void 0===n||a>=t||a<0||d&&e-c>=i}function p(){var e=Ze();if(f(e))return m(e);o=setTimeout(p,function(e){var a=t-(e-n);return d?tt(a,i-(e-c)):a}(e))}function m(e){return o=void 0,_&&l?v(e):(l=s=void 0,u)}function h(){var e=Ze(),a=f(e);if(l=arguments,s=this,n=e,a){if(void 0===o)return function(e){return c=e,o=setTimeout(p,t),r?v(e):u}(n);if(d)return clearTimeout(o),o=setTimeout(p,t),v(n)}return void 0===o&&(o=setTimeout(p,t)),u}return t=Xe(t)||0,Se(a)&&(r=!!a.leading,i=(d="maxWait"in a)?et(Xe(a.maxWait)||0,t):i,_="trailing"in a?!!a.trailing:_),h.cancel=function(){void 0!==o&&clearTimeout(o),c=0,l=n=s=o=void 0},h.flush=function(){return void 0===o?u:m(Ze())},h}const lt=""+new URL("orange-occupy-bitmap-0d6d0ba4.svg",import.meta.url).href,st=""+new URL("placeholder_square-f2c1eaed.svg",import.meta.url).href,it=""+new URL("placeholder_round-7fab4b50.svg",import.meta.url).href,ut=Me({__name:"ti-image",props:{src:{type:String,required:!0},isSquare:{type:Boolean,default:!0}},setup(n){const c=e(!0),r=e(!1),d=()=>{c.value=!0,r.value=!1},_=()=>{c.value=!1,r.value=!0};return(e,v)=>{const f=o;return t(),a(f,{class:"container"},{default:l((()=>[n.src&&!r.value?(t(),s("img",{key:0,class:"image-content",src:n.src,onLoad:d,onError:_,mode:"widthFix"},null,40,["src"])):i("",!0),n.src||r.value?i("",!0):(t(),s("img",{key:1,class:"image-content",src:lt,onLoad:d,onError:_,mode:"widthFix"},null,32)),c.value?i("",!0):(t(),a(f,{key:2},{default:l((()=>[u(e.$slots,"default",{},(()=>[!c.value&&n.isSquare?(t(),s("img",{key:0,class:"image-placeholder",src:st,mode:"widthFix"})):i("",!0),c.value||n.isSquare?i("",!0):(t(),s("img",{key:1,class:"image-placeholder",src:it,mode:"widthFix"}))]),!0)])),_:3}))])),_:3})}}},[["__scopeId","data-v-9cf3b6f5"]]);const ot=Me(xe,[["render",function(e,d,_,v,f,p){const m=o;return t(),a(m,{class:"l-ball-wrapper",ref:"l-ball-wrapper"},{default:l((()=>[(t(!0),s(n,null,c(e.balls,(e=>(t(),s(n,{key:e.time},[e.done?i("",!0):(t(),a(m,{key:0,class:"l-ball",ref_for:!0,ref:e.ref,style:r(e.style),animation:e.data},null,8,["style","animation"]))],64)))),128)),u(e.$slots,"default",{active:e.active},void 0,!0)])),_:3},512)}],["__scopeId","data-v-b3f08bc3"]]),nt=""+new URL("pengren-96abe417.svg",import.meta.url).href,ct=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,rt=""+new URL("icon-lock-bd74ef9c.svg",import.meta.url).href,dt=Me({__name:"ti-category",props:{scrollLeft:{type:Number,default:0},scrollInterval:{type:Number,default:200},threshold:{type:Number,default:5}},setup(s,{expose:n}){const c=s,r=e(0),k=e(!1),x=e(!1),C=e(0),T=e(0),I=e(`ti-${d(16)}`);_((()=>c.scrollLeft),(()=>{r.value=c.scrollLeft}));const A=at((e=>{r.value=e.detail.scrollLeft,k.value=c.threshold<e.detail.scrollLeft,x.value=T.value+e.detail.scrollLeft<e.detail.scrollWidth-c.threshold}),300),L=()=>{k.value=!1},S=()=>{x.value=!1},O=e=>{let t=0;"left"==e?t=r.value-c.scrollInterval:"right"==e&&(t=r.value+c.scrollInterval);const a=C.value-T.value;r.value=Math.min(a,Math.max(t,0))},U=()=>{b((()=>{r.value=0;y().in(this).select(`#${I.value}`).fields({size:!0,scrollOffset:!0},(e=>{T.value=(null==e?void 0:e.width)||0,C.value=(null==e?void 0:e.scrollWidth)||0,C.value>T.value?x.value=!0:(k.value=!1,x.value=!1)})).exec()}))};return v((()=>{U(),window.addEventListener("resize",U)})),f((()=>{window.removeEventListener("resize",U)})),n({getScrollWidth:U}),(e,s)=>{const n=p(m("uni-icons"),Ce),d=o,_=w;return t(),a(d,{class:"ti-category-box"},{default:l((()=>[k.value?(t(),a(d,{key:0,class:"ti-category-left",onClick:s[0]||(s[0]=e=>O("left"))},{default:l((()=>[h(d,{class:"ti-category-btn"},{default:l((()=>[h(n,{type:"left",size:"14",color:"#100A05"})])),_:1})])),_:1})):i("",!0),h(_,{id:I.value,class:"ti-category","scroll-left":r.value,"scroll-x":"","enable-flex":"","scroll-with-animation":"","upper-threshold":c.threshold,"lower-threshold":c.threshold,onScrolltoupper:L,onScrolltolower:S,onScroll:g(A)},{default:l((()=>[u(e.$slots,"default",{},void 0,!0)])),_:3},8,["id","scroll-left","upper-threshold","lower-threshold","onScroll"]),x.value?(t(),a(d,{key:1,class:"ti-category-right",onClick:s[1]||(s[1]=e=>O("right"))},{default:l((()=>[h(d,{class:"ti-category-btn"},{default:l((()=>[h(n,{type:"right",size:"14",color:"#100A05"})])),_:1})])),_:1})):i("",!0)])),_:3})}}},[["__scopeId","data-v-50a73735"]]),_t=Me({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null},defaultIndex:{type:Number,default:0}},emits:["update:menuId"],setup(u,{emit:r}){const d=r,v=u,f=e(0),w=e(v.defaultIndex),A=e([]),L=e();_((()=>v.list),(async e=>{var t;if(!e||0==e.length)return;await b();const a=y().in(this);e.map(((e,t)=>{a.select(`#scroll-item-${t}`).boundingClientRect((e=>{if(!e)return;const a=A.value;a[t]=e.width+10,A.value=a})).exec()})),S(w.value),null==(t=L.value)||t.getScrollWidth()}),{deep:!0,immediate:!0});const S=e=>{w.value=e,f.value=A.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(A.value[e]+100),d("update:menuId",v.list[e].category_id)};return(e,u)=>{const r=I,d=o,_=p(m("ti-category"),dt);return t(),a(d,{class:"ti-dish-menu"},{default:l((()=>[v.list&&v.list.length>0?(t(),a(_,{key:0,ref_key:"scrollRef",ref:L,scrollLeft:f.value},{default:l((()=>[h(d,{class:"ti-menu-content"},{default:l((()=>[(t(!0),s(n,null,c(v.list,((e,s)=>(t(),a(d,{key:s,class:k(["ti-menu-item",{active:s==w.value}]),id:`scroll-item-${s}`,onClick:e=>S(s)},{default:l((()=>[h(r,{class:"ti-menu-title"},{default:l((()=>[x(C(e.name[g(T)()]||e.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scrollLeft"])):i("",!0)])),_:1})}}},[["__scopeId","data-v-94d6e40f"]]),vt=Me({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId","update:isSpecial"],setup(u,{emit:r}){const d=Ue(),{categoryList:v}=A(d),f=r,b=e(),y=e(0),w=e(0),I=L((()=>{let e=(v.value.find((e=>e.category_id==y.value))||{}).child||[];return e&&e.length>0&&(e=[De].concat(e)),e})),S=L((()=>v.value.find((e=>e.category_id==y.value)))),O=L((()=>I.value.find((e=>e.category_id==w.value))));_((()=>y.value),(()=>{var e,t;f("update:isSpecial",null==(e=S.value)?void 0:e.is_special),f("update:categoryId",y.value),I.value&&I.value.length>0&&(w.value=I.value[0].category_id,U(w.value)),null==(t=b.value)||t.getScrollWidth()}));const U=e=>{var t;w.value=e,f("update:isSpecial",null==(t=O.value)?void 0:t.is_special),f("update:categoryId",w.value>0?w.value:y.value)};return(e,u)=>{const r=o,d=p(m("ti-category"),dt);return t(),a(r,{class:"ti-category-box"},{default:l((()=>[h(_t,{list:g(v),menuId:y.value,"onUpdate:menuId":u[0]||(u[0]=e=>y.value=e)},null,8,["list","menuId"]),I.value&&I.value.length>0?(t(),a(r,{key:0,class:"ti-dish-secondary"},{default:l((()=>[h(d,{ref_key:"categoryRef",ref:b},{default:l((()=>[h(r,{class:"ti-secondary-box"},{default:l((()=>[(t(!0),s(n,null,c(I.value,((e,s)=>(t(),a(r,{key:s,class:k([{active:e.category_id==w.value},"ti-secondary-item"]),onClick:t=>U(e.category_id)},{default:l((()=>[x(C(e.name[g(T)()]||e.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},512)])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-ab8727e6"]]);function ft(e){return S("order.Order/sendKitchen",e,{isLoading:!0,isMessage:!1})}const pt=Me({__name:"goods-detail",props:{show:{type:Boolean,default:!1},goodsDetail:{type:Object,default:()=>({})}},emits:["update:show","success","cancel"],setup(u,{emit:r}){const d=O(),v=r,f=u,b=e({});e(!1);const y=e(!1),w=e({product_name:"",product_id:null,product_num:1,total_price:null,price:null,product_price:null,product_sku_id:null,attr:[],feed_ids:[],bag_price:0,delivery:U()?30:40,describe:null,is_buffet:1,limit_num:0});_((()=>f.show),(()=>{f.show&&A()}));const A=async()=>{var e,t,a,l,s,i,u,o,n,c,r,d,_;b.value=f.goodsDetail,w.value.product_name=null==(e=b.value)?void 0:e.product_name,w.value.product_name_text=null==(t=b.value)?void 0:t.product_name_text,w.value.product_id=null==(a=b.value)?void 0:a.product_id,w.value.total_price=null==(l=b.value)?void 0:l.product_price,w.value.price=null==(s=b.value)?void 0:s.product_price,w.value.product_price=null==(i=b.value)?void 0:i.product_price,w.value.is_buffet=null==(u=b.value)?void 0:u.is_buffet,w.value.limit_num=null==(o=b.value)?void 0:o.limit_num,(null==(n=b.value)?void 0:n.sku.length)>0&&(null==(c=b.value)||c.sku.some((e=>{if(e.stock_num>0)return w.value.product_sku_id=e.product_sku_id,!0}))),(null==(r=b.value)?void 0:r.product_attr.length)>0&&(null==(d=b.value)||d.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?w.value.attr[t]=0:w.value.attr[t]=null}))),(null==(_=w.value)?void 0:_.feed_ids.length)>0&&(w.value.feed_ids=[])},L=(e,t)=>w.value.attr[e]==t;return(e,u)=>{const r=p(m("ti-image"),ut),_=o,A=I,S=p(m("ti-modal"),Re);return t(),a(S,{show:f.show,title:g(R)("商品詳情"),cancelText:g(R)("取消"),confirmText:g(R)("確定"),confirmLoading:y.value,onCancel:u[0]||(u[0]=e=>v("cancel")),onConfirm:u[1]||(u[1]=e=>(async()=>{var e,t,a,l;const s={x:event.clientX,y:event.clientY};if(y.value)return;const i={...w.value};i.attr=i.attr.join(",");let u=[];if(w.value.product_sku_id&&(null==(e=b.value)?void 0:e.sku.length)>0){const e=null==(t=b.value)?void 0:t.sku.find((e=>e.product_sku_id==w.value.product_sku_id));i.price=parseFloat(null==e?void 0:e.product_price)||0,i.total_price=parseFloat(null==e?void 0:e.product_price)||0,u.push(null==e?void 0:e.spec_name)}w.value.attr&&w.value.attr.length>0&&w.value.attr.map(((e,t)=>{var a;const l=null==(a=b.value)?void 0:a.product_attr[t];(null==l?void 0:l.attribute_value)&&l.attribute_value[e]&&u.push(l.attribute_value[e])})),w.value.product_sku_id&&(null==(a=b.value)?void 0:a.sku)&&(null==(l=b.value)?void 0:l.sku.length)>0&&w.value.feed_ids.map((e=>{var t;const a=((null==(t=b.value)?void 0:t.feed)||[]).find((t=>t.product_feed_id==e));u.push(null==a?void 0:a.feed_name),i.price=N(i.price,null==a?void 0:a.price),i.total_price=N(i.total_price,null==a?void 0:a.price)})),i.describe=u.join(";"),i.delivery=U()?30:40,i.order_id=j(),i.table_id=B(),d.detailAddCart(i),v("cancel",!1),setTimeout((()=>{v("success",s)}),100)})())},{content:l((()=>[h(_,{class:"ti-dialog-content"},{default:l((()=>[h(_,{class:"ti-detail-box"},{default:l((()=>[h(_,{class:"ti-detail-image"},{default:l((()=>{var e,t;return[h(r,{src:g(D)(null==(t=null==(e=b.value)?void 0:e.image[0])?void 0:t.file_path,117,88)},null,8,["src"])]})),_:1}),h(_,{class:"ti-detail-con"},{default:l((()=>[h(_,{class:"ti-detail-title text-ellipsis"},{default:l((()=>{var e,t;return[x(C((null==(e=b.value)?void 0:e.product_name[g(T)()])||(null==(t=b.value)?void 0:t.product_name_text)),1)]})),_:1}),h(_,{class:"ti-price-box"},{default:l((()=>[h(A,{class:"ti-detail-unit"},{default:l((()=>[x(C(g(R)("單價：")),1)])),_:1}),h(A,{class:"ti-detail-price"},{default:l((()=>{var e;return[x(C(g(P)((null==(e=b.value)?void 0:e.product_price)||0)),1)]})),_:1}),h(A,{class:"ti-detail-subPrice"},{default:l((()=>{var e;return[x(C(g(E)((null==(e=b.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),h(_,{class:"ti-price-box"},{default:l((()=>[h(A,{class:"ti-detail-unit"},{default:l((()=>[x(C(g(R)("單位：")),1)])),_:1}),h(A,{class:"ti-detail-price"},{default:l((()=>{var e,t;return[x(C((null==(e=b.value)?void 0:e.product_unit[g(T)()])||(null==(t=b.value)?void 0:t.product_unit_text)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),h(_,{class:"ti-detail-specs"},{default:l((()=>[h(_,{class:"ti-specs-box"},{default:l((()=>{var e,u,o,r,d,v;return[(null==(e=b.value)?void 0:e.sku)&&(null==(u=b.value)?void 0:u.sku.length)>0?(t(),a(_,{key:0,class:"ti-specs-item"},{default:l((()=>[h(_,{class:"ti-specs-title"},{default:l((()=>[x(C(g(R)("規格")),1)])),_:1}),h(_,{class:"ti-specs-child"},{default:l((()=>{var e;return[(t(!0),s(n,null,c(null==(e=b.value)?void 0:e.sku,(e=>(t(),a(_,{key:e.product_sku_id,class:k([{active:e.product_sku_id==w.value.product_sku_id,disabled:e.stock_num<=0},"ti-child-item"]),onClick:t=>(e=>{e.stock_num<=0||w.value.product_sku_id!=e.product_sku_id&&(w.value.product_sku_id=e.product_sku_id)})(e)},{default:l((()=>[h(A,{class:"ti-child-name"},{default:l((()=>[x(C(e.spec_name_i18n[g(T)()]||e.spec_name_text),1)])),_:2},1024),h(A,{class:"ti-child-price"},{default:l((()=>[x(C(g(P)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),h(A,{class:"ti-child-subPrice"},{default:l((()=>[x(C(g(E)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):i("",!0),(null==(o=b.value)?void 0:o.product_attr)&&(null==(r=b.value)?void 0:r.product_attr.length)>0?(t(),a(_,{key:1},{default:l((()=>{var e;return[(t(!0),s(n,null,c(null==(e=b.value)?void 0:e.product_attr,((e,i)=>(t(),a(_,{key:i,class:"ti-specs-item"},{default:l((()=>[h(_,{class:"ti-specs-title"},{default:l((()=>[x(C(e.attribute_name_i18n[g(T)()]||e.attribute_name_text),1)])),_:2},1024),h(_,{class:"ti-specs-child"},{default:l((()=>[(t(!0),s(n,null,c(null==e?void 0:e.attribute_value_i18n,((s,u)=>(t(),a(_,{key:u,class:k([{active:L(i,u)},"ti-child-item"]),onClick:e=>((e,t)=>{w.value.attr[e]=t})(i,u)},{default:l((()=>[h(A,{class:"ti-child-name"},{default:l((()=>[x(C(s[g(T)()]||(null==e?void 0:e.attribute_value_text[u])),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:1})):i("",!0),(null==(d=b.value)?void 0:d.feed)&&(null==(v=b.value)?void 0:v.feed.length)>0?(t(),a(_,{key:2,class:"ti-specs-item"},{default:l((()=>[h(_,{class:"ti-specs-title"},{default:l((()=>[x(C(g(R)("加料")),1)])),_:1}),h(_,{class:"ti-specs-child"},{default:l((()=>{var e;return[(t(!0),s(n,null,c(null==(e=b.value)?void 0:e.feed,(e=>(t(),a(_,{key:e.product_feed_id,class:k([{active:(w.value.feed_ids||[]).indexOf(e.product_feed_id)>-1,disabled:e.stock_num<=0},"ti-child-item"]),onClick:t=>(e=>{if(e.stock_num<=0)return;const t=w.value.feed_ids.indexOf(e.product_feed_id);t>=0?w.value.feed_ids.splice(t,1):w.value.feed_ids.push(e.product_feed_id)})(e)},{default:l((()=>[h(A,{class:"ti-child-name"},{default:l((()=>[x(C(e.feed_name_i18n[g(T)()]||e.feed_name_text),1)])),_:2},1024),h(A,{class:"ti-child-price"},{default:l((()=>[x(C(g(P)((null==e?void 0:e.price)||0)),1)])),_:2},1024),h(A,{class:"ti-child-subPrice"},{default:l((()=>[x(C(g(E)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):i("",!0)]})),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText","confirmLoading"])}}},[["__scopeId","data-v-8611e7f7"]]),mt=Me({__name:"dish-car-order-nav",emits:["car","confirm"],setup(s,{expose:u,emit:n}){const c=O(),{cartTotalQuantity:r,cartTotalAmount:d}=A(c),v=n,f=()=>{v("car")},p=()=>{v("confirm")};e();const m=e(!1);_((()=>r.value),(()=>{r.value>0?m.value=!0:m.value=!1}),{immediate:!0});const b=async()=>{};return b(),u({getCarData:b}),(e,s)=>{const u=z,n=I,c=o;return t(),a(c,{class:"ti-car-order"},{default:l((()=>[h(c,{class:"ti-order-total",onClick:f},{default:l((()=>[h(u,{class:"ti-total-image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE9SURBVHgB7ZjxrcIgEMY/Xt4AbvAYwRHc4DmKbuAG6gR1A92g3UA3sE6gTnAesZqG1gLKSf/oL7nQwKV8Be6AAj1DPR6IaMTF6NmgVIlUGDFsR2qSVUJ7I8iQIwWVKF2zWU3UBH2AhexJhtx8dFufPw5NF8gwYTu2jbxLkIYsmV3hEiQdYdoepdSCGn38OpzXbP+Qo2Q7YCAA9aqhyhNbyK6jHe+Zcy9PFrQgec52v11R9o0IayTe1IJKu6JL0B8S4EqM0lztii5BGvIELWoNeU52ReopC4qyAvL472PmWECyZAiF5LJ1Ti9uM8pDlMb9yKnxOWbNHHj/KjDwJs4pq8PTN+VizFb4DHuofxD88qW1MGcx/UPFjFsi5RzLv84nmTr0eBL3OEPNnxGrmP7vCDKXuk2V1Bax/Qd8uQE+N6CHpHz4IAAAAABJRU5ErkJggg=="}),h(n,{class:"ti-total-price"},{default:l((()=>[x(C(g(P)(g(d)||0)),1)])),_:1}),h(n,{class:"ti-total-subPrice"},{default:l((()=>[x(C(g(E)(g(d)||0)),1)])),_:1})])),_:1}),m.value?(t(),a(c,{key:0,class:"ti-total-badge-box"},{default:l((()=>[h(n,{class:"ti-total-badge"},{default:l((()=>[x(C(g(r)),1)])),_:1})])),_:1})):i("",!0),h(c,{class:"ti-order-btn",onClick:p},{default:l((()=>[h(n,{class:"ti-btn-text"},{default:l((()=>[x(C(e.$t("下單")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-f0193bc6"]]),ht=Me({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})},isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["change"],setup(s,{emit:i}){const u=O(),{myCartList:n}=A(u),c=s;e(!1);const r=async e=>{var t,a,l,s,i,o,r,d,_;if((null==n?void 0:n.value.filter((e=>e.product_id===c.productItem.product_id))).reduce(((e,t)=>e+c.productItem.product_num),0)>=c.productItem.limit_num&&0!=c.productItem.limit_num&&"up"==e)return uni.showToast({title:R("已限購"),icon:"none"});if(c.isOrderOverTime&&1==(null==(t=c.productItem)?void 0:t.is_buffet)&&"up"==e&&1!=c.isOverTime)return void $("buffet_remain",R("點餐時間已到，無法繼續下單"));if(0==c.buyContinue&&1==c.isOverTime&&"up"==e)return void $("buffet_remain",R("用餐時間已到，無法繼續下單"));if(1==c.isOverTime&&1==(null==(a=c.productItem)?void 0:a.is_buffet)&&"up"==e)return void $("buffet_remain",R("自助餐时间已到达，自助餐商品不可继续下单"));const v={product_id:null==(l=c.productItem)?void 0:l.product_id,product_num:null==(s=c.productItem)?void 0:s.product_num,price:null==(i=c.productItem)?void 0:i.price,describe:null==(o=c.productItem)?void 0:o.describe,attr:null==(r=c.productItem)?void 0:r.attr,product_sku_id:null==(d=c.productItem)?void 0:d.product_sku_id,feed_ids:null==(_=c.productItem)?void 0:_.feed_ids,type:e};u.changeCartData(v)};return(e,i)=>{const u=o;return t(),a(u,{class:"ti-number-box",onClick:i[2]||(i[2]=F((()=>{}),["stop"]))},{default:l((()=>[h(u,{class:"ti-number-btn ti-number-minus",disabled:!1,onClick:i[0]||(i[0]=e=>r("down"))},{default:l((()=>[h(u,{class:"ti-number-minus-reduce"})])),_:1}),h(u,{class:"ti-number-input"},{default:l((()=>[x(C(s.productItem.product_num),1)])),_:1}),h(u,{class:"ti-number-btn ti-number-plus",disabled:!1,onClick:i[1]||(i[1]=e=>r("up"))},{default:l((()=>[h(u,{class:"ti-number-plus-add"}),h(u,{class:"ti-number-plus-add2"})])),_:1})])),_:1})}}},[["__scopeId","data-v-a748c112"]]),gt=Me({__name:"dish-car-ordering-list",props:{isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["success","change","sendkitchenFail","close"],setup(u,{emit:r}){const d=O(),{myCartList:_,cartTotalQuantity:v,cartTotalAmount:f}=A(d),b=M();A(b);const y=u,k=e(!1),L=r;e(),e(),e({table_id:""});const S=async e=>{},U=async e=>{try{k.value=!0;const e=await ft({table_id:B(),add_product_arr:_.value});uni.showToast({title:R(e.msg),icon:"none"}),setTimeout((()=>{L("success"),d.clearCartData()}),200)}catch(t){L("sendkitchenFail",t)}finally{k.value=!1}};return q("handleDelProuct",(e=>{S()})),(e,u)=>{const r=o,d=I,b=w,k=p(m("ti-button"),qe),A=p(m("ti-empty-data"),Pe);return t(),a(r,{class:"ti-shop-list-box"},{default:l((()=>{var e,o;return[(null==(e=g(_))?void 0:e.length)>0?(t(),a(r,{key:0,class:"ti-shop-list"},{default:l((()=>[h(r,null,{default:l((()=>[h(r,{class:"ti-cart-shop-head"},{default:l((()=>[h(r,{class:"ti-shop-head-title"},{default:l((()=>[x(C(g(R)("商品名稱")),1)])),_:1}),h(r,{class:"ti-shop-head-money yx-shop-head-price"},{default:l((()=>[x(C(g(R)("單價")),1)])),_:1}),h(r,{class:"ti-shop-head-num"},{default:l((()=>[x(C(g(R)("數量")),1)])),_:1}),h(r,{class:"ti-shop-head-money"},{default:l((()=>[x(C(g(R)("小計")),1)])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-scroll-box"},{default:l((()=>[h(b,{class:"ti-shop-scroll","scroll-y":""},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[(t(!0),s(n,null,c(g(_),((e,s)=>(t(),a(r,{class:"ti-shop-item",key:e},{default:l((()=>[h(r,{class:"ti-shop-item-box"},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[h(r,{class:"ti-shop-body-top"},{default:l((()=>[h(r,{class:"ti-shop-title text-ellipsis"},{default:l((()=>[x(C((null==e?void 0:e.product_name[g(T)()])||(null==e?void 0:e.product_name_text)),1)])),_:2},1024),h(r,{class:"ti-shop-spec"},{default:l((()=>{return[x(C((t=null==e?void 0:e.describe,a=g(Q)(),t.split(";").filter((e=>""!==e.trim())).map((e=>JSON.parse(e))).map((e=>e[a])).join(";"))),1)];var t,a})),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-money yx-shop-body-pirce"},{default:l((()=>[h(d,{class:"ti-shop-price"},{default:l((()=>[x(C(g(P)((null==e?void 0:e.price)||0)),1)])),_:2},1024),h(d,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(g(E)((null==e?void 0:e.price)||0)),1)])),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-number"},{default:l((()=>[h(ht,{buyContinue:y.buyContinue,isOverTime:y.isOverTime,isOrderOverTime:y.isOrderOverTime,productItem:e,onChange:u[0]||(u[0]=e=>S())},null,8,["buyContinue","isOverTime","isOrderOverTime","productItem"])])),_:2},1024),h(r,{class:"ti-shop-total-money"},{default:l((()=>[h(d,{class:"ti-shop-price"},{default:l((()=>[x(C(g(P)((null==e?void 0:e.total_price)||0)),1)])),_:2},1024),h(d,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(g(E)((null==e?void 0:e.total_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-content-bottom"},{default:l((()=>[h(r,{class:"ti-car-shop-bottom"},{default:l((()=>[h(r,{class:"ti-shop-bottom-item"},{default:l((()=>[h(r,null,{default:l((()=>[h(d,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(g(R)("共")+(g(v)||0)+g(R)("件")),1)])),_:1})])),_:1}),h(r,null,{default:l((()=>[h(d,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(g(R)("商品金額：")),1)])),_:1}),h(d,{class:"ti-shop-bottom-price"},{default:l((()=>[x(C(g(P)(g(f)||0)),1)])),_:1}),h(d,{class:"ti-shop-bottom-subPrice"},{default:l((()=>[x(C(g(E)(g(f)||0)),1)])),_:1})])),_:1})])),_:1})])),_:1}),h(r,{class:"bottom-button"},{default:l((()=>[h(k,{title:g(R)("退出"),onClick:u[1]||(u[1]=e=>L("close")),class:"close-button"},null,8,["title"]),h(k,{title:g(R)("確認下單"),type:"primary",onClick:U},null,8,["title"])])),_:1})])),_:1})])),_:1})):i("",!0),(null==(o=g(_))?void 0:o.length)<=0?(t(),a(r,{key:1,class:"ti-empty-data-box"},{default:l((()=>[h(A,{title:g(R)("當前無待下單商品")},null,8,["title"]),h(k,{title:g(R)("退出"),onClick:u[2]||(u[2]=e=>L("close"))},null,8,["title"])])),_:1})):i("",!0)]})),_:1})}}},[["__scopeId","data-v-ee4b674a"]]),bt=Me({__name:"dish-car-ordered-list",emits:["close"],setup(u,{emit:r}){const d=e([]),_=e(""),v=e();let f=0;const b=r;(async()=>{try{const t=await(e={table_id:B()},S("order.Order/getSendKitchen",e));d.value=t.data.list||[],_.value=t.data.total_price,t.data.list.forEach((e=>{f+=e.plist.length})),v.value=f}catch(t){}var e})();return(e,u)=>{const r=o,f=I,y=w,k=p(m("ti-button"),qe),T=p(m("ti-empty-data"),Pe);return t(),a(r,{class:"ti-shop-list-box"},{default:l((()=>[Object.keys(d.value).length>0?(t(),a(r,{key:0,class:"ti-shop-list"},{default:l((()=>[h(r,{class:"ti-scroll-box"},{default:l((()=>[h(y,{class:"ti-shop-scroll","scroll-y":""},{default:l((()=>[(t(!0),s(n,null,c(d.value,((e,u)=>(t(),a(r,{class:"ti-shop-item",key:u},{default:l((()=>[h(r,{class:"ti-shop-time-top"}),h(r,{class:"ti-shop-time-box"},{default:l((()=>[x(C(e.date+" "+g(R)("下單")),1)])),_:2},1024),(t(!0),s(n,null,c(e.plist,((s,u)=>(t(),a(r,{key:u},{default:l((()=>[h(r,{class:"ti-shop-item-box"},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[h(r,{class:"ti-shop-body-top"},{default:l((()=>[h(r,{class:"ti-shop-title text-ellipsis"},{default:l((()=>[x(C(s.product_name_text||s.name_text||s.buffet_name_text),1)])),_:2},1024),s.product_attr||s.customer_type_name_text?(t(),a(r,{key:0,class:"ti-shop-spec"},{default:l((()=>[x("("+C(s.product_attr||s.customer_type_name_text)+")",1)])),_:2},1024)):i("",!0)])),_:2},1024),h(r,{class:"ti-shop-body-money yx-shop-body-pirce"},{default:l((()=>[h(f,{class:"ti-shop-price"},{default:l((()=>[x(C(g(P)((null==s?void 0:s.product_price)||(null==s?void 0:s.price)||0)),1)])),_:2},1024),h(f,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(g(E)((null==s?void 0:s.product_price)||(null==s?void 0:s.price)||0)),1)])),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-state"},{default:l((()=>[null!=s.finish_num?(t(),a(r,{key:0,class:"ti-state-left"},{default:l((()=>[x(C(null!=s.finish_num?s.finish_num:s.num),1)])),_:2},1024)):i("",!0),null!=s.finish_num?(t(),a(r,{key:1,class:"ti-state-line"},{default:l((()=>[x("/")])),_:1})):i("",!0),h(r,{class:"ti-state-right"},{default:l((()=>[x(C(s.total_num||s.num),1)])),_:2},1024),null!=s.finish_num?(t(),a(r,{key:2,class:"ti-state-text"},{default:l((()=>{return[x(C((e=null!=s.finish_num?s.kitchen_status:s.is_comb,R(0===e?"製作中":1===e?"已完成":"未知"))),1)];var e})),_:2},1024)):i("",!0)])),_:2},1024),h(r,{class:"ti-shop-body-money"},{default:l((()=>[h(f,{class:"ti-shop-price"},{default:l((()=>[x(C(g(P)((null==s?void 0:s.total_product_price)||(null==s?void 0:s.total_price)||0)),1)])),_:2},1024),h(f,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(g(E)((null==s?void 0:s.total_product_price)||(null==s?void 0:s.total_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),u!=e.length-1?(t(),a(r,{key:0,class:"ti-shop-item-box-bottom-border"})):i("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})])),_:1}),h(r,{class:"ti-content-bottom"},{default:l((()=>[h(r,{class:"ti-car-shop-bottom"},{default:l((()=>[h(r,{class:"ti-shop-bottom-item"},{default:l((()=>[h(r,null,{default:l((()=>[h(f,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(g(R)("共")+(v.value||0)+g(R)("件")),1)])),_:1})])),_:1}),h(r,null,{default:l((()=>[h(f,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(g(R)("商品金額：")),1)])),_:1}),h(f,{class:"ti-shop-bottom-price"},{default:l((()=>[x(C(g(P)(_.value||0)),1)])),_:1}),h(f,{class:"ti-shop-bottom-subPrice"},{default:l((()=>[x(C(g(E)(_.value||0)),1)])),_:1})])),_:1})])),_:1})])),_:1}),h(k,{title:g(R)("退出"),onClick:u[0]||(u[0]=e=>b("close")),style:{}},null,8,["title"])])),_:1})])),_:1})):i("",!0),Object.keys(d.value).length<=0?(t(),a(r,{key:1,class:"ti-empty-data-box"},{default:l((()=>[h(T,{title:g(R)("當前無已下單商品")},null,8,["title"]),h(k,{title:g(R)("退出"),onClick:u[1]||(u[1]=e=>b("close"))},null,8,["title"])])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-60e32d8d"]]),yt=Me({__name:"goods-not-enough",props:{show:{type:Boolean,default:!1},productList:{type:Array,default:[]}},emits:["update:show","confirm"],setup(e,{emit:i}){const u=i,r=e,d=()=>{u("confirm")};return(i,_)=>{const v=I,f=o,g=w,b=p(m("ti-modal"),Re);return t(),a(b,{class:"ti-action-tip",show:r.show,isCancelShow:!1,title:i.$t("温馨提示"),confirmText:i.$t("確定"),onCancel:_[0]||(_[0]=e=>u("update:show",!1)),onConfirm:d},{content:l((()=>[h(f,{class:"ti-dialog-content"},{default:l((()=>[h(f,{class:"ti-detail-box"},{default:l((()=>[h(v,{class:"ti-detail-des"},{default:l((()=>[x(C(i.$t("商品庫存不足，請重新選擇")),1)])),_:1})])),_:1}),h(f,{class:"ti-detail-specs"},{default:l((()=>[h(g,{"scroll-y":""},{default:l((()=>[(t(!0),s(n,null,c(e.productList,((e,s)=>(t(),a(f,{class:"ti-specs-box"},{default:l((()=>[h(f,{class:"ti-specs-item"},{default:l((()=>[h(f,{class:"ti-specs-title"},{default:l((()=>[x(C(e.product_name_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmText"])}}},[["__scopeId","data-v-a9bc6e2e"]]),wt=Me({__name:"dish-list",emits:["success","goodsDetail","notEnough"],setup(u,{expose:r,emit:d}){W((e=>({"06bfdcfe":me.value,c5c21280:he.value})));const f=Ee(),{goodsLoading:S,goodsInfo:U}=A(f),N=L((()=>{var e;return f.getGoodsInfo(null==(e=U.value)?void 0:e.list)})),j=Ue();A(j);const F=O(),{myCartList:$}=A(F),M=d,Q=e(!1),Z=e({}),ee=e(0),te=e({category_id:null}),ae=e(!1),le=e(!1),se=e(!1),ie=e(0),ue=e(0),oe=e(!1),ne=e(!1),ce=e("");e(!1);const re=e(!1),de=e(),_e=e();e(F.cartTotalQuantity);const ve=e([]);q("sendProductList",(e=>{ve.value=e}));const fe=(e,t=ve.value)=>t.some((t=>t.product_id===e)),pe=(e,t=ve.value)=>{const a=t.find((t=>t.product_id===e));return a?a.total_num:0},me=e("0px"),he=e("0px"),ge=e(0),be=e(1),ye=()=>{y().in(this).select(".content-gridview").fields({size:!0},(e=>{const t=X(180,4,e.width);be.value=t;const a=(e.width-180*t)/(2*t);me.value=2*a+"px",he.value=`${a}px`,ge.value=e.width})).exec()};_((()=>te.value.category_id),(()=>{Ae()}));const we=e=>{_e.value.action(e),M("success"),de.value.getCarData()},ke=()=>{M("success"),de.value.getCarData()},xe=()=>{var e;(null==(e=U.value)?void 0:e.isNextPage)&&Ae(!0)},Ce=()=>{Q.value=!1},Ie=e=>{ne.value=!0,ce.value=e},Ae=async e=>{const t={...te.value};t.category_id||(t.category_id=0),1==ee.value&&(t.is_special=1);try{await(null==f?void 0:f.getCacheGoodsList(t,e))}catch(a){uni.showToast({title:a.toString(),icon:"none"})}};q("closeShowLanguage",(e=>{e.isSelectLanguage&&K()&&setTimeout((()=>{Ae()}),500)})),e([]);const Le=e(),Se=()=>{Le.value=!0,qe.value=!0},Oe=()=>{De()};e([]);const De=async e=>{$.value.length>0?ze():(Le.value=!0,qe.value=!1)},je=e([]),Be=e(!1),ze=async()=>{try{const e=await ft({table_id:B(),add_product_arr:$.value});uni.showToast({title:R(e.msg),icon:"none"}),setTimeout((()=>{M("success"),F.clearCartData(),de.value.getCarData(),Le.value=!0,qe.value=!1}),300)}catch(e){$e(e)}},Fe=(e,t)=>{e||(Le.value=!1)},$e=e=>{-32==e.code?Je(R("單次僅可下單"),e.data.value,R("個數量，請分多次下單")):-31==e.code?Je(R("剩余"),Math.ceil(e.data.value/60),R("分鐘即可繼續下單")):0==e.code&&e.data.length>0||-14==e.code?Ze(R("以下商品庫存不足，請刪除後再下單"),e.data):-11==e.code?Ze(R("以下商品超出限購數量，請在限購數量內下單"),e.data):-33==e.code?Ze(R("以下商品價格有變動，請覈對後再下單"),e.data):-12==e.code&&(Ke.value||0==re.value?Ie(R("自助餐时间已到达，自助餐商品不可继续下单")):Ie(R("用餐時間已到，無法繼續下單"))),0==e.data.length?Ke.value||0==re.value?Ie(R("自助餐时间已到达，自助餐商品不可继续下单")):Ie(R("用餐時間已到，無法繼續下單")):M("notEnough",e.data)};e([]);const Me=async()=>{Be.value=!1},qe=e(!0),Qe=e=>{qe.value=e},We=()=>{qe.value=!1,de.value.getCarData()};qe.value=!0;const Ke=e(!0);e(-1);const Ge=e(),Ye=e(),He=e(!1);v((()=>{q("globalLock",(e=>{oe.value=1==e})),q("sendHead",(e=>{const t=-1!=parseInt(e.buffet.buffet_expired_time);if(Ke.value=1==e.buffet.is_buy_continue,!t)return re.value=!1,void(He.value=!1);const a=e.buffet.buffet_remaining_time,l=60*parseInt(e.buffet.minute);a<=l&&Ge.value>=l&&(ie.value=e.buffet.minute,ae.value=!0),Ge.value=a;const s=re.value;if(re.value=0==e.buffet.buffet_remaining_time,re.value!=s&&1==re.value&&(ae.value=!0,He.value=!0),1==e.buffet.is_remain_continue&&0!=e.buffet.remain_continue_time){const t=e.buffet.buffet_order_remaining_time,a=60*parseInt(e.buffet.remain_continue_notice_time);t<=a&&Ye.value>=a&&(ue.value=e.buffet.remain_continue_notice_time,le.value=!0),Ye.value=t;const l=He.value;He.value=0==e.buffet.buffet_order_remaining_time,He.value!=l&&1==He.value&&1!=re.value&&(le.value=!0)}})),q("buffet_remain",(e=>{Ie(e)})),q("quota",(e=>{Je(R("單次僅可下單"),e,R("個數量，請分多次下單"))}))}));const Je=(e,t,a)=>{Ie(e+" "+t+" "+a)},Ve=e(""),Xe=e([]),Ze=(e,t)=>{se.value=!0,Ve.value=e,Xe.value=t};return G((()=>{null==j||j.getCategory(!0)})),Y((()=>{H("globalLock"),H("closeShowLanguage"),H("refresh"),H("buffet_remain")})),r({handleSuccess:ke}),(e,u)=>{const r=p(m("ti-loading"),Te),d=o,_=p(m("ti-image"),ut),v=z,f=I,y=p(m("ti-empty-data"),Pe),A=J("RecycleScroller"),L=p(m("l-ball"),ot),O=p(m("ti-drawer"),Ne),j=p(m("ti-modal"),Re),B=w;return t(),s(n,null,[h(d,{class:"ti-dish-box"},{default:l((()=>[h(vt,{categoryId:te.value.category_id,"onUpdate:categoryId":u[0]||(u[0]=e=>te.value.category_id=e),isSpecial:ee.value,"onUpdate:isSpecial":u[1]||(u[1]=e=>ee.value=e)},null,8,["categoryId","isSpecial"]),h(d,{class:"ti-dish-list"},{default:l((()=>[g(S)?(t(),a(r,{key:0})):(t(),a(A,{key:1,"item-secondary-size":ge.value/be.value,"item-size":220,items:N.value,"grid-items":be.value,"key-field":"product_id",class:"content-gridview",prerender:6,onScrollEnd:xe,onResize:ye,onVisible:ye},{default:l((({item:e,index:s})=>[h(d,{class:"ti-goods-item left",onClick:t=>(async(e,t)=>{const a=(null==$?void 0:$.value.filter((e=>e.product_id===t.product_id))).reduce(((e,t)=>e+t.product_num),0);if(t.product_stock<=0)return uni.showToast({title:R("已售罄"),icon:"none"});if(1==t.limit_num_status||a>=t.limit_num&&0!=t.limit_num)return uni.showToast({title:R("已限購"),icon:"none"});if(!He.value||re.value||1!=t.is_buffet){if(Ke.value){if(He.value&&1==t.is_buffet)return void Ie(R("自助餐时间已到达，自助餐商品不可继续下单"))}else if(re.value&&He.value||re.value)return void Ie(R("用餐時間已到，無法添加商品"));if((null==t?void 0:t.sku.length)<=1&&0==(null==t?void 0:t.product_attr.length)&&0==(null==t?void 0:t.feed.length))return _e.value.action(e),F.addCart(t);b((()=>{1==Q.value?Q.value=!1:(Q.value=!0,Z.value=t)}))}else Ie(R("點餐時間已到，無法繼續下單"))})(t,e)},{default:l((()=>[!e.product_stock||e.product_stock<=0?(t(),a(d,{key:0,class:"ti-goods-sold-out"},{default:l((()=>[x(C(g(R)("已售罄")),1)])),_:1})):1==e.limit_num_status?(t(),a(d,{key:1,class:"ti-goods-sold-out"},{default:l((()=>[x(C(g(R)("已限购")),1)])),_:1})):i("",!0),h(d,{class:k(["ti-goods-box",{"ti-goods-disabled":e.product_stock<=0||1==e.limit_num_status}])},{default:l((()=>[e.limit_num&&e.limit_num>0?(t(),a(d,{key:0,class:"ti-goods-quota"},{default:l((()=>[x(C(g(V)("限購{count}份",{count:e.limit_num||0})),1)])),_:2},1024)):i("",!0),h(d,{class:"ti-goods-image"},{default:l((()=>{var s;return[h(_,{src:g(D)(null==(s=e.image[0])?void 0:s.file_path,180,126)||""},null,8,["src"]),fe(e.product_id)&&1==(null==e?void 0:e.is_show_kitchen)?(t(),a(d,{key:0,class:"cooking"},{default:l((()=>[h(v,{class:"cooking-image",src:nt}),h(d,{class:"cooking-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(pe(e.product_id)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):i("",!0)]})),_:2},1024),h(d,{class:"ti-goods-content"},{default:l((()=>[h(d,{class:"ti-goods-title line-clamp-2"},{default:l((()=>[x(C(e.product_name[g(T)()].length>18?e.product_name[g(T)()].slice(0,17)+"...":e.product_name[g(T)()]||e.product_name_text||"-"),1)])),_:2},1024),h(d,{class:"ti-price-box"},{default:l((()=>[h(f,{class:"ti-goods-price"},{default:l((()=>[x(C(g(P)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024),h(f,{class:"ti-goods-subPrice",style:{display:"block"}},{default:l((()=>[x(C(g(E)((null==e?void 0:e.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),empty:l((()=>[0==N.value.length?(t(),a(y,{key:0})):i("",!0)])),after:l((()=>[0!=N.value.length?(t(),a(r,{key:0,status:g(U).isNextPage?"loading":"no-more"},null,8,["status"])):i("",!0)])),_:1},8,["item-secondary-size","items","grid-items"]))])),_:1}),h(d,{class:"ti-car-order-nav"},{default:l((()=>[h(L,{ref_key:"ballRef",ref:_e,offset:150,size:23,duration:500},{default:l((({active:e})=>[h(mt,{ref_key:"carRef",ref:de,class:k(["nav-car",{active:e}]),onCar:Se,onConfirm:Oe},null,8,["class"])])),_:1},512)])),_:1})])),_:1}),h(pt,{show:Q.value,"onUpdate:show":u[2]||(u[2]=e=>Q.value=e),goodsDetail:Z.value,onCancel:Ce,onSuccess:we},null,8,["show","goodsDetail"]),h(yt,{style:{"z-index":"9999"},show:Be.value,"onUpdate:show":u[3]||(u[3]=e=>Be.value=e),productList:je.value,onConfirm:Me},null,8,["show","productList"]),h(O,{show:Le.value,width:603.992,title:g(R)("我點的菜"),maskClick:!0,onChange:Fe},{content:l((()=>[h(d,{class:"ti-drawer-content"},{default:l((()=>[h(d,{class:"ti-content-head"},{default:l((()=>[h(d,{class:"ti-switch-box"},{default:l((()=>[h(d,{class:k(qe.value?"ti-switch-on":"ti-switch-off"),onClick:u[4]||(u[4]=e=>Qe(!0))},{default:l((()=>[h(f,{class:k(qe.value?"ti-switch-text-on":"ti-switch-text-off")},{default:l((()=>[x(C(g(R)("未下單")),1)])),_:1},8,["class"])])),_:1},8,["class"]),h(d,{class:"ti-switch-space"}),h(d,{class:k(qe.value?"ti-switch-off":"ti-switch-on"),onClick:u[5]||(u[5]=e=>Qe(!1))},{default:l((()=>[h(f,{class:k(qe.value?"ti-switch-text-off":"ti-switch-text-on")},{default:l((()=>[x(C(g(R)("已下單")),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})])),_:1}),qe.value?(t(),a(gt,{key:0,buyContinue:Ke.value,isOverTime:re.value,isOrderOverTime:He.value,onSuccess:We,onClose:u[6]||(u[6]=e=>Le.value=!1),onChange:ke,onSendkitchenFail:$e},null,8,["buyContinue","isOverTime","isOrderOverTime"])):i("",!0),qe.value?i("",!0):(t(),a(bt,{key:1,onClose:u[7]||(u[7]=e=>Le.value=!1)}))])),_:1})])),footer:l((()=>[h(d)])),_:1},8,["show","title"]),h(j,{class:"ti-action-tips",show:ae.value,"onUpdate:show":u[8]||(u[8]=e=>ae.value=e),isCancelShow:!1,onConfirm:u[9]||(u[9]=e=>ae.value=!1)},{title:l((()=>[h(d,{class:"warning-header"},{default:l((()=>[h(d,{class:"warning-image-round"},{default:l((()=>[h(v,{class:"warning-image",src:ct})])),_:1}),re.value?(t(),a(d,{key:1,class:"warning-text"},{default:l((()=>[x(C(g(R)("用餐時間結束")),1)])),_:1})):(t(),a(d,{key:0,class:"warning-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(g(R)("用餐")),1)])),_:1}),h(f,null,{default:l((()=>[x(C(g(R)("還有")),1)])),_:1}),h(f,{class:"warning-text red"},{default:l((()=>[x(C(ie.value),1)])),_:1}),h(f,null,{default:l((()=>[x(C(g(R)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:l((()=>[re.value?(t(),a(d,{key:1,class:"warning-text"},{default:l((()=>[x(C(g(R)("如有需要，請呼叫服務員")),1)])),_:1})):(t(),a(d,{key:0,class:"warning-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(g(R)("請盡快用餐,如有需要，請呼叫服務員")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(j,{class:"ti-action-tips",show:le.value,"onUpdate:show":u[10]||(u[10]=e=>le.value=e),isCancelShow:!1,onConfirm:u[11]||(u[11]=e=>le.value=!1)},{title:l((()=>[h(d,{class:"warning-header"},{default:l((()=>[h(d,{class:"warning-image-round"},{default:l((()=>[h(v,{class:"warning-image",src:ct})])),_:1}),He.value?(t(),a(d,{key:1,class:"warning-text"},{default:l((()=>[x(C(g(R)("點餐時間結束")),1)])),_:1})):(t(),a(d,{key:0,class:"warning-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(g(R)("點餐")),1)])),_:1}),h(f,null,{default:l((()=>[x(C(g(R)("還有")),1)])),_:1}),h(f,{class:"warning-text red"},{default:l((()=>[x(C(ue.value),1)])),_:1}),h(f,null,{default:l((()=>[x(C(g(R)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:l((()=>[He.value?(t(),a(d,{key:1,class:"warning-text"},{default:l((()=>[x(C(g(R)("如有需要，請呼叫服務員")),1)])),_:1})):(t(),a(d,{key:0,class:"warning-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(g(R)("請在剩餘時間完成選購")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(j,{class:"ti-order-tip",show:se.value,"onUpdate:show":u[12]||(u[12]=e=>se.value=e),title:g(R)("溫馨提示"),isCancelShow:!1,onConfirm:u[13]||(u[13]=e=>se.value=!1)},{content:l((()=>[h(d,{class:"place-order-text"},{default:l((()=>[h(f,null,{default:l((()=>[x(C(Ve.value),1)])),_:1})])),_:1}),h(B,{"scroll-y":"true",class:"place-scroll-content"},{default:l((()=>[(t(!0),s(n,null,c(Xe.value,((e,s)=>(t(),a(d,{class:"place-order-text",key:s},{default:l((()=>[h(f,{class:"place-srcoll-item"},{default:l((()=>[x(C(e.product_name_text),1)])),_:2},1024),h(f,null,{default:l((()=>[x("    "+C(e.product_attr?"("+e.product_attr+")":""),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["show","title"]),h(j,{class:"ti-action-tips",show:oe.value,"onUpdate:show":u[14]||(u[14]=e=>oe.value=e),isCancelShow:!1,isConfirmShow:!1},{title:l((()=>[h(d,{class:"warning-header"},{default:l((()=>[h(d,{class:"warning-image-round"},{default:l((()=>[h(v,{class:"warning-image",src:rt})])),_:1}),h(d,{class:"warning-text"},{default:l((()=>[x(C(g(R)("订单已锁定")),1)])),_:1})])),_:1})])),footer:l((()=>[h(d)])),_:1},8,["show"]),h(j,{class:"ti-action-tips",show:ne.value,"onUpdate:show":u[15]||(u[15]=e=>ne.value=e),isCancelShow:!1,isConfirmShow:!0,onConfirm:u[16]||(u[16]=e=>ne.value=!1),title:g(R)("溫馨提示"),content:ce.value},{title:l((()=>[h(d,{class:"warning-header"},{default:l((()=>[h(d,{class:"warning-image-round"},{default:l((()=>[h(v,{class:"warning-image",src:ct})])),_:1}),h(d,{class:"warning-text"},{default:l((()=>[x(C(g(R)("温馨提示")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-40e3217b"]]),kt=Me({__name:"opentable-index",setup(s){const i=Ue(),u=Ee();Z(),e();const n=()=>{N()},c=e(),r=e(),d=e("");e([]);const _=e(),f=e(!1),b=e(!1),y=e({ip:"",port:"",device_id:"",remark:""}),w=()=>{const e=le();y.value.ip=(null==e?void 0:e.ip)||se()||"127.0.0.1",y.value.port=(null==e?void 0:e.port)||"8080"},k=e=>{y.value.remark=e},T=e=>{y.value.ip=e},A=e=>{y.value.port=e},L=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const a=await de(_e(`${null==t?void 0:t.ip}:${t.port}`),!1);ve(t),fe(a.data.app_id),pe(a.data.shop_supplier_id),oe(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{f.value=!0}),150)}catch(a){-102==a.code?uni.showToast({title:R("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:R("绑定失败"),icon:"none"})}else uni.showToast({title:R("請輸入連接埠"),icon:"none"});else uni.showToast({title:R("請輸入伺服器位址"),icon:"none"})},S=e=>{f.value=!1,e&&(_.value=e,d.value=e.table_no)},O=()=>{w(),d.value=ue().table_no,_.value=ue()},U=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const a=await de(_e(`${null==t?void 0:t.ip}:${t.port}`),!1);if(!_.value)return void uni.showToast({title:R("請查找桌位"),icon:"none"});ve(t),fe(a.data.app_id),pe(a.data.shop_supplier_id),oe(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{D()}),150)}catch(a){-102==a.code?uni.showToast({title:R("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:R("绑定失败"),icon:"none"})}else uni.showToast({title:R("請輸入連接埠"),icon:"none"});else uni.showToast({title:R("請輸入伺服器位址"),icon:"none"})},D=async()=>{if(B()===_.value.table_id&&y.value.remark==me("machine_remark"))return uni.showToast({title:R("绑定成功"),icon:"none"}),r.value=!1,he(!1),void setTimeout((()=>{ge({url:"/pages/index/index"})}),150);try{await be({key:me("machine_id"),table_id:_.value.table_id,old_table_id:B(),device_remark:y.value.remark});ye(_.value),uni.showToast({title:R("绑定成功"),icon:"none"}),r.value=!1,he(!1),setTimeout((()=>{ge({url:"/pages/index/index"})}),150),y.value.remark!=me("machine_remark")&&we({key:"machine_remark",data:y.value.remark})}catch(e){uni.showToast({title:e.msg||e.errMsg,icon:"none"})}},P=e(!1),E=e(!1),N=()=>{P.value=!0,E.value=!0},j=async e=>{if(e)try{await Ae({password:e});y.value.remark=me("machine_remark")||"",r.value=!0,_.value=ue(),d.value=_.value.table_no,F()}catch(t){(t.errMsg||t.msg)&&uni.showToast({title:t.msg||t.errMsg,icon:"none"})}else uni.showToast({title:R("請輸入密碼"),icon:"none"})},F=()=>{P.value=!1,E.value=!1};w(),q("goodsRefresh",(()=>{null==i||i.getCategory(!0),null==u||u.getCacheGoodsList(!0)}));const $=e({name:"",logo:"",tableNo:"",is_call_service:1}),M=async e=>{var t,a,l;if(K())try{const s=await ie(e);$.value.name=s.data.name,$.value.logo=s.data.logo,$.value.tableNo=ue().table_no,$.value.is_call_service=parseInt(null==(a=null==(t=null==s?void 0:s.data)?void 0:t.tablet)?void 0:a.is_call_service),oe(null==(l=s.data)?void 0:l.currency),ne(s)}catch(s){}};return q("authorization",(e=>{b.value=!e})),q("refresh",(e=>{M(!1)})),ee((()=>{M(!1)})),Y((()=>{H("refresh")})),v((()=>{je()?y.value.device_id=Be():te({success:e=>{y.value.device_id=e.deviceId}})})),ae((()=>{var e;null==(e=c.value)||e.showBuffet(!0,0)})),(e,s)=>{const i=p(m("ti-layout-head"),Le),u=o,_=I,v=p(m("ti-input"),Fe),w=p(m("ti-layout-table-list"),$e),D=p(m("ti-modal"),Re),N=z;return t(),a(u,{class:"ti-page",onClick:s[1]||(s[1]=e=>g(re)())},{default:l((()=>[h(u,null,{default:l((()=>[h(i,{ref_key:"refCallServer",ref:c,isPay:!0,isTableNo:!0,onDoubleLogo:n,is_call_service:parseInt($.value.is_call_service)},null,8,["is_call_service"])])),_:1}),h(wt),h(Ie,{show:P.value,title:g(R)("密碼"),password:E.value,placeholder:g(R)("請輸入密碼"),onExit:F,onConfirm:j},null,8,["show","title","password","placeholder"]),h(D,{show:r.value,title:g(R)("設置"),cancelText:g(R)("重置"),confirmText:g(R)("確定"),onCancel:O,onConfirm:U},{content:l((()=>[h(u,{class:"ti-item-input"},{default:l((()=>[h(u,{class:"ti-label-box"},{default:l((()=>[h(u,{class:"ti-label-left"},{default:l((()=>[h(_,{class:"ti-label-server"},{default:l((()=>[x(C(g(R)("當前機器ID")),1)])),_:1})])),_:1})])),_:1}),h(u,{class:"ti-input-box"},{default:l((()=>[h(v,{type:"text",clearable:!1,disabled:!0,value:y.value.device_id},null,8,["value"])])),_:1})])),_:1}),h(u,{class:"ti-item-input"},{default:l((()=>[h(u,{class:"ti-label-box"},{default:l((()=>[h(u,{class:"ti-label-left"},{default:l((()=>[h(_,{class:"ti-label-server"},{default:l((()=>[x(C(g(R)("機器備註(非必填)")),1)])),_:1})])),_:1})])),_:1}),h(u,{class:"ti-input-box"},{default:l((()=>[h(v,{type:"text",onInput:k,value:y.value.remark,placeholder:g(R)("機器備註"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),h(u,{class:"ti-item-input"},{default:l((()=>[h(u,{class:"ti-label-box"},{default:l((()=>[h(u,{class:"ti-label-left"},{default:l((()=>[h(_,{class:"ti-label-server"},{default:l((()=>[x(C(g(R)("服務器連接地址")),1)])),_:1})])),_:1}),h(u,{class:"ti-label-right",onClick:L},{default:l((()=>[h(_,{class:"ti-label-table"},{default:l((()=>[x(C(d.value?g(R)("已選 : ")+g(ce)(d.value,19):g(R)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),h(u,{class:"ti-input-box"},{default:l((()=>[h(v,{type:"text",onInput:T,value:y.value.ip,placeholder:g(R)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),h(u,{class:"ti-colon"},{default:l((()=>[x(":")])),_:1}),h(u,{class:"ti-input-port"},{default:l((()=>[h(v,{type:"number",onInput:A,value:y.value.port,placeholder:g(R)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1}),h(w,{show:f.value,"onUpdate:show":s[0]||(s[0]=e=>f.value=e),onConfirm:S},null,8,["show"])])),_:1},8,["show","title","cancelText","confirmText"]),h(D,{class:"ti-action-tips",show:b.value,title:g(R)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:g(R)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:l((()=>[h(u,{class:"warning-header"},{default:l((()=>[h(u,{class:"warning-image-round"},{default:l((()=>[h(N,{class:"warning-image",src:ze,mode:""})])),_:1}),h(u,{class:"warning-text"},{default:l((()=>[x(C(g(R)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})}}},[["__scopeId","data-v-cb52c464"]]);export{kt as default};
