var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,t=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,o=(e,a,l)=>new Promise(((s,t)=>{var o=e=>{try{u(l.next(e))}catch(a){t(a)}},i=e=>{try{u(l.throw(e))}catch(a){t(a)}},u=e=>e.done?s(e.value):Promise.resolve(e.value).then(o,i);u((l=l.apply(e,a)).next())}));import{_ as i,k as u,l as n,u as r,m as d,p as c,q as v,t as p,v as f,x as m,y as _,z as h,A as w,b as g,c as y,w as b,i as x,d as k,B as V,C,D as I,$ as T,E as j,F as O,G as P,H as U,I as F,J as L,K as S,L as $,j as E,r as R,M as q,N as z,O as A,P as B,Q as D,R as G,S as H,T as J}from"./index-b2264b5a.js";import{_ as K,a as M,S as N}from"./set-language.c7ac2668.js";import"./ti-select.6374d6a5.js";const Q=""+new URL("icon-comput-ad5a078b.svg",import.meta.url).href,W=i({__name:"index",setup(e){const i=u(),W=n(),X=r(),Y=d(!0),Z=d(!1),ee=d(!1),ae=d({user_name:"",password:"",device_id:""}),le=c((()=>!ae.value.user_name||!ae.value.password)),se=d(!1),te=d(!0),oe=d({ip:"",port:"",device_id:""}),ie=d(!1),ue=d("");v((()=>te.value),(()=>{te.value&&ne()})),p((()=>{var e;(null==(e=f())?void 0:e.api_url)&&m()&&_()&&(te.value=!1),ne(),h({success:e=>{oe.value.device_id=e.deviceId,ae.value.device_id=e.deviceId}})}));const ne=()=>{const e=f();oe.value.ip=(null==e?void 0:e.ip)||w()||"127.0.0.1",oe.value.port=(null==e?void 0:e.port)||"8080"},re=()=>o(this,null,(function*(){var e,o,i,u,n,r,d,c;const v=((e,o)=>{for(var i in o||(o={}))l.call(o,i)&&t(e,i,o[i]);if(a)for(var i of a(o))s.call(o,i)&&t(e,i,o[i]);return e})({},oe.value);if(!v.ip)return uni.showToast({title:T("请输入服务器地址"),icon:"none"});if(!v.port)return uni.showToast({title:T("请输入端口"),icon:"none"});try{se.value=!0;const a=yield j(O(`${null==v?void 0:v.ip}:${v.port}`),{key:oe.value.device_id,address:oe.value.ip,port:oe.value.port});(null==(o=null==(e=a.data)?void 0:e.shop)?void 0:o.app_id)&&(null==(u=null==(i=a.data)?void 0:i.shop)?void 0:u.shop_supplier_id)?(te.value=!1,uni.showToast({title:T("绑定成功"),icon:"none"}),P(null==(r=null==(n=a.data)?void 0:n.shop)?void 0:r.app_id),U(null==(c=null==(d=a.data)?void 0:d.shop)?void 0:c.shop_supplier_id),F(v),setTimeout((()=>{var e;f()&&L(`${null==(e=f())?void 0:e.api_url}/cashier-mini`)}),100),W.getList()):-100==a.code?(ue.value=a.msg,ie.value=!0):uni.showToast({title:T("绑定失败"),icon:"none"})}catch(p){uni.showToast({title:T("绑定失败"),icon:"none"})}finally{se.value=!1}})),de=()=>o(this,null,(function*(){if(!ae.value.user_name)return uni.showToast({title:T("請輸入賬號"),icon:"none"});if(!ae.value.password)return uni.showToast({title:T("输入登录密码"),icon:"none"});try{ee.value=!0;const e=yield S(ae.value);e.data.token&&($(e.data.token),X.getUserInfo(!0),i.getList(),E({title:T("加载中...")}),R({url:"/pages/index/index"}))}catch(e){}finally{ee.value=!1}})),ce=e=>{e&&(1==Y.value&&(ae.value.user_name+=e),1==Z.value&&(ae.value.password+=e))},ve=e=>{Y.value="username"===e,Z.value="password"===e},pe=()=>{1==Y.value&&(ae.value.user_name=""),1==Z.value&&(ae.value.password="")},fe=()=>{te.value=!te.value};return(e,a)=>{const l=q,s=x,t=z,o=A(B("ti-button"),D),i=A(B("ti-input"),G),u=A(B("ti-keyboard"),H),n=A(B("ti-modal"),J);return g(),y(s,{class:"ti-login"},{default:b((()=>[k(s,{class:"ti-login-img"},{default:b((()=>[k(l,{src:K,mode:"widthFix"})])),_:1}),k(s,{class:"ti-login-box"},{default:b((()=>[te.value?(g(),y(s,{key:0,class:"ti-serve-box"},{default:b((()=>[k(s,{class:"ti-serve-head"},{default:b((()=>[k(s,{class:"ti-serve-logo"},{default:b((()=>[k(l,{src:M,mode:"widthFix"})])),_:1}),k(s,{class:"ti-serve-title"},{default:b((()=>[V(C(I(T)("收银机")),1)])),_:1})])),_:1}),k(s,{class:"ti-serve-label"},{default:b((()=>[V(C(I(T)("服务器连接地址")),1)])),_:1}),k(s,{class:"ti-serve-input"},{default:b((()=>[k(s,{class:"ti-serve-ip"},{default:b((()=>[k(t,{modelValue:oe.value.ip,"onUpdate:modelValue":a[0]||(a[0]=e=>oe.value.ip=e),type:"text",placeholder:I(T)("服务器地址")},null,8,["modelValue","placeholder"])])),_:1}),k(s,{class:"ti-serve-colon"},{default:b((()=>[V(":")])),_:1}),k(s,{class:"ti-serve-port"},{default:b((()=>[k(t,{modelValue:oe.value.port,"onUpdate:modelValue":a[1]||(a[1]=e=>oe.value.port=e),type:"number",placeholder:I(T)("端口")},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),k(s,{class:"ti-serve-btn"},{default:b((()=>[k(o,{onClick:ne},{default:b((()=>[V(C(I(T)("重置")),1)])),_:1}),k(o,{loading:se.value,type:"primary",onClick:re},{default:b((()=>[V(C(I(T)("確定")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):(g(),y(s,{key:1,class:"ti-login-form"},{default:b((()=>[k(s,{class:"ti-form-box"},{default:b((()=>[k(s,{class:"ti-form-head"},{default:b((()=>[k(s,{class:"ti-login-logo"},{default:b((()=>[k(l,{src:M,mode:"widthFix"})])),_:1}),k(s,{class:"ti-login-title"},{default:b((()=>[V(C(I(T)("收银机")),1)])),_:1})])),_:1}),k(s,{class:"ti-form-username"},{default:b((()=>[k(i,{modelValue:ae.value.user_name,"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value.user_name=e),prefixIcon:"icon-user",placeholder:I(T)("請輸入用戶名"),focus:Y.value,onClick:a[3]||(a[3]=e=>ve("username"))},null,8,["modelValue","placeholder","focus"])])),_:1}),k(s,{class:"ti-form-password"},{default:b((()=>[k(i,{modelValue:ae.value.password,"onUpdate:modelValue":a[4]||(a[4]=e=>ae.value.password=e),prefixIcon:"icon-lock",placeholder:I(T)("請輸入登錄密碼"),focus:Z.value,password:!0,onClick:a[5]||(a[5]=e=>ve("password"))},null,8,["modelValue","placeholder","focus"])])),_:1}),k(s,{class:"ti-form-btn"},{default:b((()=>[k(o,{type:"primary",loading:ee.value,disabled:I(le),onClick:de},{default:b((()=>[V(C(I(T)("登錄")),1)])),_:1},8,["loading","disabled"])])),_:1}),k(s,{class:"ti-form-link",onClick:fe},{default:b((()=>[V(C(I(T)("更换服务器")),1)])),_:1})])),_:1}),k(s,{class:"ti-form-keyboard"},{default:b((()=>[k(u,{isExit:!1,isPrimary:!1,onInput:ce,onClear:pe})])),_:1})])),_:1}))])),_:1}),k(s,{class:"ti-language-box"},{default:b((()=>[k(N)])),_:1}),k(n,{class:"ti-action-tips",show:ie.value,"onUpdate:show":a[6]||(a[6]=e=>ie.value=e),isCancelShow:!1,content:ue.value,onConfirm:a[7]||(a[7]=e=>ie.value=!1)},{title:b((()=>[k(s,{class:"warning-header"},{default:b((()=>[k(s,{class:"warning-image-round"},{default:b((()=>[k(l,{class:"warning-image",src:Q,mode:"aspectFit"})])),_:1}),k(s,{class:"warning-title"},{default:b((()=>[V(C(I(T)("绑定失败")),1)])),_:1})])),_:1})])),_:1},8,["show","content"])])),_:1})}}},[["__scopeId","data-v-cecd146c"]]);export{W as default};
