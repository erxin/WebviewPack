import{_ as a,Q as e,d as l,b as s,s as o,r as t,R as n,j as i,T as u,U as c,H as d,I as r,m as g,n as v,w as A,v as f,l as p,B as m,x as w,z as _,A as h,V as b,W as B,X as x,Y as y,Z as U,a0 as C,a1 as k,a2 as T,a3 as S,a4 as I,a5 as j,a6 as E,a7 as L,f as Q,a8 as R,t as G,K as V,a9 as O,aa as Y,M as X,J as D,ab as J,$ as M,F as H,ac as z,C as N,ad as K,ae as F}from"./index-94f20d72.js";import{a as Z,b as P,c as q,l as W,g as $,d as aa,V as ea,_ as la}from"./login.e6bb16be.js";import{_ as sa,a as oa}from"./red-ring.277552e8.js";import{_ as ta}from"./ti-button.7fd4373f.js";const na=a({__name:"ti-login",emits:["login","focus","blur","bindErr"],setup(a,{emit:O}){const Y=e(),X=l(),D=s(),{baseInfo:J}=o(s()),M=O,H=t({user_name:"",password:"",code:"",device_id:""}),z=t(!0),N=t(!1),K=t(!1),F=t(!1),aa=t(!1),ea=t(!1),la=t(),oa=t(),na=t(),ia=()=>{H.value.user_name?H.value.password?H.value.code?ua():uni.showToast({title:m("请输入验证码"),icon:"none"}):uni.showToast({title:m("请输入密码"),icon:"none"}):uni.showToast({title:m("请输入账号/手机号"),icon:"none"})},ua=async()=>{var a;H.value.device_id=B();try{const e=await W(H.value,oa.value);x(e.data.app_id),y(H.value.device_id),U(e.data.token),C((null==(a=e.data)?void 0:a.real_name)||"NULL"),uni.showToast({title:e.msg,icon:"none"}),ca()}catch(e){M("bindErr",e),ra()}},ca=async()=>{var a;try{const e=await k();1==parseInt(e.data.cashier.order_method.is_table_order)?(T(e.data.shop_supplier_id),S(null==(a=e.data)?void 0:a.currency),null==D||D.setUserInfo(e.data),aa.value=!0):uni.showToast({title:m("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(e){}},da=async a=>{if(aa.value=!1,a)try{const e=await I({table_id:a.table_id,key:H.value.device_id});j(a),E({title:m("加载中...")}),await(null==Y?void 0:Y.getCategoryList(!0)),await(null==X?void 0:X.getGoodsBaseList({category_id:0},!0)),L(),Q({url:"/pages/index/index"}),uni.showToast({title:e.msg,icon:"none"})}catch(e){}},ra=async()=>{var a,e,l;if(!ea.value)try{ea.value=!0;const s=await $({v:1});(null==(a=s.data)?void 0:a.sign)?(la.value=null==(e=s.data)?void 0:e.base64,oa.value=null==(l=s.data)?void 0:l.sign):uni.showToast({title:m("验证码生成失败"),icon:"none"})}catch(s){}finally{ea.value=!1,ga()}},ga=()=>{na.value&&clearTimeout(na.value),na.value=setTimeout((()=>{ra()}),178200)},va=a=>{z.value="username"===a,N.value="password"===a,K.value="verifycode"===a,M("focus")},Aa=()=>{M("blur")};return n((()=>[H.value.user_name,H.value.password,H.value.code]),(([a,e,l])=>{F.value=!!(a&&e&&l)})),i((()=>{})),u((()=>{if("function"==typeof window.config){let a=window.config().saasApiUrl;R()||(a=window.location.origin),a?(c(a),ra()):uni.showToast({title:"请配置config.js文件的saasApiUrl参数",icon:"error"})}})),(a,e)=>{const l=d(r("ti-input-d"),Z),s=G,o=d(r("ti-loading"),sa),t=d(r("uni-icons"),P),n=V,i=d(r("ti-button"),ta),u=d(r("ti-layout-table-list"),q);return g(),v(s,{class:"container"},{default:A((()=>[f(s,{class:"ti-item-input"},{default:A((()=>[f(l,{modelValue:H.value.user_name,"onUpdate:modelValue":e[0]||(e[0]=a=>H.value.user_name=a),prefixIcon:"icon-user",placeholder:p(m)("请输入账号/手机号"),focus:z.value,disabled:!1,popKeyboard:!0,onFocus:e[1]||(e[1]=a=>va("username")),onBlur:Aa},null,8,["modelValue","placeholder","focus"])])),_:1}),f(s,{class:"ti-item-input"},{default:A((()=>[f(l,{modelValue:H.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>H.value.password=a),prefixIcon:"icon-lock",class:"ti-member-input",placeholder:p(m)("请输入密码 "),password:!0,disabled:!1,popKeyboard:!0,focus:N.value,onFocus:e[3]||(e[3]=a=>va("password")),onBlur:Aa},null,8,["modelValue","placeholder","focus"])])),_:1}),f(s,{class:"ti-item-input"},{default:A((()=>[f(s,{class:"ti-input-box"},{default:A((()=>[f(l,{modelValue:H.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>H.value.code=a),prefixIcon:"icon-shield-tick",placeholder:p(m)("请输入验证码"),focus:K.value,popKeyboard:!0,disabled:!1,onFocus:e[5]||(e[5]=a=>va("verifycode")),onBlur:Aa,onConfirm:ia},null,8,["modelValue","placeholder","focus"]),f(s,{class:"ti-login-code",onClick:ra},{default:A((()=>[la.value?(g(),w("img",{key:0,src:la.value,alt:""},null,8,["src"])):ea.value?(g(),v(o,{key:1})):(g(),v(s,{key:2,class:"ti-login-code-error"},{default:A((()=>[f(t,{"custom-prefix":"iconfont",type:"icon-shuaxin",size:"16",color:"#999"}),f(n,{style:{"margin-left":"5px"}},{default:A((()=>[_(h(p(m)("重新加载")),1)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),f(s,null,{default:A((()=>[f(i,{class:b(["ti-login-btn",{islogin:F.value}]),onClick:ia},{default:A((()=>[_(h(p(m)("登录")),1)])),_:1},8,["class"])])),_:1}),f(u,{show:aa.value,onConfirm:da,onCancel:e[6]||(e[6]=a=>(aa.value=!1,ra()))},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-7092f270"]]),ia=""+new URL("binding-page-bg-image-db048039.png",import.meta.url).href,ua=a({__name:"set-language",props:{firstBind:{type:Boolean,default:!1}},setup(a){const e=a,l=t(O[Y()]),s=t(),o=a=>{s.value.isShow()?s.value.close():s.value.open()},n=()=>{l.value=O[Y()]};return(a,t)=>{const i=d(r("ti-layout-language-item"),aa),u=G,c=D,p=V;return g(),v(u,{class:"ti-language",onClick:[o,t[0]||(t[0]=X((()=>{}),["stop"]))]},{default:A((()=>[f(u,{class:"ti-language-box"},{default:A((()=>[f(i,{ref_key:"refShowLanguage",ref:s,firstBind:e.firstBind,onLanguageText:n},null,8,["firstBind"])])),_:1}),f(c,{class:"ti-language-global",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIeSURBVHgB5VXdcdswDAYUKpXVPrAbeASNoExQZ4ImE7QbxB6hE9gb1BvYnSDaoN6gfOg5PsshA0CyJEbUnZK7vCTfnX9EfvgAkAAE8CGgP8c3ehL/1Wns6s+9nnz6OcY2GhRNL2ckWolY9x0Qpp3tjBa/CY84HMCLHOhU3QG43+BcoTVoQMx7JIRc9ogDDpYU0N0oB5U4zuUhORVwUBkMgfeYI3DzkBP0xBNKNYJlxYeteSiv+KjoODJwaMBZU1lFlJXTUOLalGWhJ2rTZmmvzf5xHQxIzjNRlDol/0Kwjdie7y2UQUWkc+XUH0/GlFBQxSwpm/zZJXOGO1rbmn15q9OLGVjKkI7LGDBdWtSJ/gd9NnCM/0GEG4jVrBbqi1eh8VpeP2RiQ7as0a0q1Rq4GyE2EaLpCA1h2nCxcZxTULy+8jLwxGXHGhgL1+NOGxl4Y7QO+NK6sNH4SsIetwg5WFBXblsjp4OOfew8rvBJA+HX+bG5ZHMoV/Szkh44/KeqqI0Q/pATGCpT+U8NBxcknHyhMjXDd9c2Gryi0SDYaMpjoaWoIq5nclaPijjOIHbUSG7ncSOc0ldh9se1jIojjYpIMr31JHuRpGpOy9XQuiy/SldzE4Vg3ZUMO27OSm5BDudeHM9tzP5EBLeQB29aBuBN27540EHjxFKqiJnMlm51ncHTlveQGxSvQ+KjIZefqvvmlcmvz2T4Lfa+8ARyhNbiDRkX2gAAAABJRU5ErkJggg=="}),f(p,{class:"ti-language-text"},{default:A((()=>[_(h(l.value),1)])),_:1}),f(c,{class:"ti-language-arrow-down",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACPSURBVHgB7Y9BCoUwDESH/w3EuskRPIpH8AZ6M72ZR9ClO60KQRGtYF0ofbRQmslMAgQC70TEHkb6SM8kEkPDfBMqcIFJpz02aF377dSMTt8DalfIXLc6/ehZ4JyIqdSJTjbZTL7oSlzFFXLL3BXixfwwxFDlzfwkxJ+5hph/LjE1i3nUCkcZnkAsCAS+xQhmhzo19D7FAAAAAABJRU5ErkJggg=="})])),_:1})}}},[["__scopeId","data-v-e2382d00"]]),ca=a({__name:"first-binding",setup(a){var e;F((a=>({"7c16b6ad":b.value})));const l=t(!1),s=t(""),o=t(""),n=t(),u=t(!1),c=J().deviceModel,b=t(""),B=t(0);let x=Date.now();const y=t();R()||(y.value=null==(e=window.config())?void 0:e.title);const U=a=>{0!=a.code?(-20==a.code||-201==a.code?(o.value=m("温馨提示"),n.value="../../static/red-ring.svg"):-21==a.code?(o.value=m("登录失败"),n.value="../../static/monitor-mobbile.svg"):(o.value=m("温馨提示"),n.value="../../static/red-ring.svg"),-20!=a.code&&-201!=a.code&&-21!=a.code||(l.value=!0,s.value=a.msg)):uni.showToast({title:a.msg,icon:"none"})},C=()=>{"PC"!=c&&(b.value="-15%")},k=()=>{b.value=""},T=()=>{const a=Date.now();a-x>1e3?B.value=1:B.value++,x=a,B.value>=6&&(new ea,B.value=0)};return M("authorization",(a=>{u.value=!a})),i((()=>{R()||(document.title=window.config().title)})),(a,e)=>{const t=D,i=G,c=V,b=d(r("ti-login"),na),B=d(r("ti-modal"),la);return g(),w(H,null,[f(i,{class:"page",onClick:e[0]||(e[0]=a=>p(N)())},{default:A((()=>[f(i,{class:"ti-page-bg"},{default:A((()=>[f(t,{class:"ti-bg-image",src:ia})])),_:1}),f(i,{class:"ti-flex"},{default:A((()=>[f(i,{class:"ti-flex-round"},{default:A((()=>[f(i,{class:"ti-round-box"},{default:A((()=>[f(i,{class:"ti-round-content"},{default:A((()=>[p(R)()?(g(),v(i,{key:0,class:"ti-item-logo",onClick:T},{default:A((()=>["jbc"==p(z)()?(g(),v(c,{key:0,class:"ti-platform"},{default:A((()=>[_("JBC · "+h(p(m)("平板")),1)])),_:1})):"ttpos"==p(z)()?(g(),v(c,{key:1,class:"ti-platform"},{default:A((()=>[_("TTPOS · "+h(p(m)("平板")),1)])),_:1})):(g(),v(c,{key:2,class:"ti-platform"},{default:A((()=>[_("TTPOS · "+h(p(m)("平板")),1)])),_:1}))])),_:1})):(g(),v(i,{key:1,class:"ti-item-logo"},{default:A((()=>[f(i,{class:"ti-platform"},{default:A((()=>[_(h(y.value+" · "+p(m)("平板")),1)])),_:1})])),_:1})),f(b,{class:"m-top-32px",onFocus:C,onBlur:k,onBindErr:U})])),_:1})])),_:1})])),_:1})])),_:1}),f(i,{class:"ti-language-box"},{default:A((()=>[f(ua,{firstBind:!0})])),_:1})])),_:1}),f(B,{class:"ti-action-tips",show:l.value,"onUpdate:show":e[1]||(e[1]=a=>l.value=a),isCancelShow:!1,isConfirmShow:!0,content:s.value,onConfirm:e[2]||(e[2]=a=>l.value=!1),confirmType:"danger"},{title:A((()=>[f(i,{class:"warning-header"},{default:A((()=>[f(i,{class:"warning-image-round"},{default:A((()=>[f(t,{class:"warning-image",src:n.value,mode:""},null,8,["src"])])),_:1}),f(i,{class:"warning-text yx-text-bold"},{default:A((()=>[_(h(o.value),1)])),_:1})])),_:1})])),default:A((()=>[K("template",null,[f(i)])])),_:1},8,["show","content"]),f(B,{class:"ti-action-tips",show:u.value,title:p(m)("店鋪到期"),isCancelShow:!1,onConfirm:e[3]||(e[3]=a=>u.value=!1),isConfirmShow:!0,content:p(m)("店鋪狀態已到期，如需使用，請聯繫銷售代表"),confirmType:"danger"},{title:A((()=>[f(i,{class:"warning-header"},{default:A((()=>[f(i,{class:"warning-image-round"},{default:A((()=>[f(t,{class:"warning-image",src:oa,mode:""})])),_:1}),f(i,{class:"warning-text"},{default:A((()=>[_(h(p(m)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-db5b1a15"]]);export{ca as default};
