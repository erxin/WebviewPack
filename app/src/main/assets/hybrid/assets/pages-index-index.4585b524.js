import{_ as e,u as a,a as l,b as t,c as s,d as o,s as i,r as u,o as n,i as r,e as c,f as v,g as d,h as f,j as _,$ as p,k as m,l as b,m as g,n as w,w as h,p as y,q as x,t as C,v as T,x as k,y as I,F,z as A,A as j,B,C as E,D as M,E as P,G as V,H as S,I as U,J as q,S as O,K as z,L as D,M as L,N,O as G,P as H}from"./index-94f20d72.js";import{D as J,T as K,a as $,_ as Q,v as R,b as W}from"./ti-store-expire.6111c689.js";import{_ as X}from"./login.e6bb16be.js";import"./components-ti-keyboard-ti-keyboard.c73d8311.js";import"./ti-button.7fd4373f.js";const Y=e({__name:"index",setup(e){const{clearOpenping:Y,getOpenPing:Z}=a();l();const ee=t(),ae=s();o();const{userInfo:le}=i(ee),{tableInfo:te}=i(ae),se=u(0),oe=u(!0);u(!1),u(!1);const ie=u();u([]);const ue=u(3e4),ne=u(!1),re=u(),ce=u(!1),ve=u(!1),de=u(!0),fe=u(!1),_e=u(!1),pe=u(!1);u(!0);let me="";const be=u(null),ge=u(!1);let we=null;const he=u(!1),ye=()=>{("1"===x("client_voice").value&&x("client_voice").time>x("server_voice").time||"1"===x("server_voice").value&&(null==x("client_voice").time||x("server_voice").time>x("client_voice").time))&&(we=M(),we.src="/static/new.mp3",we.autoplay=!1,we.loop=!1,we.play(),we.onPlay((()=>{})),we.onEnded((()=>{we.destroy()})))},xe=async()=>{var e,a,l,t,s,o;try{if(await(null==ee?void 0:ee.getUserInfo(!0)),1!=parseInt(null==(e=null==le?void 0:le.value)?void 0:e.cashier.order_method.is_table_order))return void(null==(a=re.value)||a.tiCallClick("1"));const i=await(null==ae?void 0:ae.getTableInfoAsync(!0));if(30===i.data.status){if(1==(null==(l=i.data.order)?void 0:l.is_buffet))return ce.value=!0,ne.value=!0,void hideVideoCloseSwiperAutoplay();null==ae||ae.openTablePage(null==(s=null==(t=i.data)?void 0:t.order)?void 0:s.is_buffet)}else 1===parseInt(i.data.tablet.is_customer_order)?Ce():null==(o=re.value)||o.tiCallClick("1")}catch(i){"request:fail"==i.errMsg&&(null==ae||ae.openTablePage())}},Ce=()=>{Y(),de.value=1==le.value.buffet.is_open,ve.value=!0},Te=e=>{var a;Z(),ve.value=!1,e&&(null==(a=re.value)||a.tiCallClick("1"))},ke=async e=>{if(e)try{const a=await R({password:e});me=a.data.server_version,he.value=!0,Fe()}catch(a){"request:fail"==a.errMsg||"request:fail"==a.errmsg?uni.showToast({title:B("网络异常，请检查您的网络设置"),icon:"none"}):(a.errMsg||a.msg)&&uni.showToast({title:a.msg||a.errMsg,icon:"none"})}else uni.showToast({title:B("請輸入密碼"),icon:"none"})},Ie=()=>{he.value=!1,setTimeout((()=>{null==ee||ee.getUserInfo(!0),null==ae||ae.getTableInfoAsync(!0)}),1150)},Fe=()=>{_e.value=!1,pe.value=!1},Ae=e=>{var a,l,t;se.value=(null==e?void 0:e.detail.current)||0,ue.value=3e4,Be(null==(l=null==(a=le.value)?void 0:a.tablet)?void 0:l.carousel,se.value),null==(t=be.value)||t.pause()},je=e=>{let a=Math.floor(e.detail.duration)+5;ue.value=1e3*a},Be=(e,a)=>{const l=e[a];"video"==P(l.real_name)&&(be.value=V("myVideo"),setTimeout((()=>{ie.value=l}),50))},Ee=()=>{var e,a,l,t;N().in(this).select(".ti-swiper-item-video").fields({node:!0,size:!0}).exec((e=>{e[0].node.play()})),se.value==(null==(a=null==(e=le.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(se.value=0,Be(null==(t=null==(l=le.value)?void 0:l.tablet)?void 0:t.carousel,se.value)):se.value+=1};return n((()=>{null==ae||ae.getTableInfoAsync(),r()&&c()&&v({url:"/pages/index/opentable-index"})})),d((()=>{var e,a;oe.value=!0,null==(e=be.value)||e.play(),null==(a=re.value)||a.showBuffet(!1,0)})),f((()=>{var e;oe.value=!1,null==(e=be.value)||e.pause()})),_((()=>{null==ee||ee.getUserInfo(!0),null==ae||ae.getTableInfoAsync(!0),p("fuyixin",(()=>{ge.value=!0,ye()}))})),m((()=>{var e;null==(e=be.value)||e.pause(),oe.value=!1})),p("authorization",(e=>{fe.value=!e})),(e,a)=>{const l=S(U("ti-layout-head"),W),t=C,s=q,o=G,i=H,u=O,n=z,v=D,d=S(U("ti-modal"),X);return b(r)()&&!b(c)()?(g(),w(t,{key:0,class:"ti-page",onClick:a[8]||(a[8]=e=>b(E)())},{default:h((()=>[T(t,null,{default:h((()=>{var e,t;return[T(l,{ref_key:"refCallServer",ref:re,onDoubleLogo:a[0]||(a[0]=e=>(_e.value=!0,void(pe.value=!0))),is_call_service:parseInt(null==(t=null==(e=b(le))?void 0:e.tablet)?void 0:t.is_call_service)},null,8,["is_call_service"])]})),_:1}),T(t,{class:"ti-page-content"},{default:h((()=>{var e;return[T(t,{class:"ti-page-left"},{default:h((()=>[T(u,{onChange:Ae,class:"ti-swiper",current:se.value,autoplay:oe.value,circular:"",interval:ue.value,"indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:h((()=>{var e,l;return[(g(!0),k(F,null,I(null==(l=null==(e=b(le))?void 0:e.tablet)?void 0:l.carousel,((e,l)=>(g(),w(i,{class:"ti-swiper-item",key:l},{default:h((()=>["image"===b(P)(e.real_name)?(g(),w(t,{key:0,class:"ti-swiper-item"},{default:h((()=>["image"===b(P)(e.real_name)?(g(),w(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):y("",!0)])),_:2},1024)):y("",!0),"video"===b(P)(e.real_name)?(g(),w(t,{key:1,class:"ti-swiper-item",onTouchmove:a[1]||(a[1]=L((()=>{}),["stop"]))},{default:h((()=>{var e;return[T(o,{id:"myVideo",onEnded:Ee,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ie.value)?void 0:e.file_path,onLoadedmetadata:je},null,8,["src"])]})),_:1})):y("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay","interval"])])),_:1}),T(t,{class:"ti-page-right"},{default:h((()=>[T(t,{class:"ti-store-box"},{default:h((()=>[T(t,{class:"ti-store-item"},{default:h((()=>{var e;return[T(s,{class:"ti-store-logo",src:null==(e=b(le))?void 0:e.logo},null,8,["src"]),T(n,{class:"ti-store-name"},{default:h((()=>{var e;return[A(j(null==(e=b(le))?void 0:e.name),1)]})),_:1})]})),_:1}),T(t,{class:"ti-table-item"},{default:h((()=>[T(t,{class:"ti-table-number"},{default:h((()=>{var e;return[A(j(b(B)("桌號："))+j(null==(e=b(te))?void 0:e.table_no),1)]})),_:1}),T(t,{class:"ti-table-button",onClick:xe},{default:h((()=>[T(n,{class:"ti-table-button-text"},{default:h((()=>[A(j(b(B)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),T(J,{show:ve.value,title:"["+(null==(e=b(te))?void 0:e.table_no)+"]"+b(B)("就餐人数"),placeholder:b(B)("請輸入人數"),isBuffet:de.value,password:pe.value,onExit:Te},null,8,["show","title","placeholder","isBuffet","password"]),T(J,{show:_e.value,title:b(B)("密碼"),password:pe.value,placeholder:b(B)("請輸入密碼"),onExit:Fe,onConfirm:ke},null,8,["show","title","password","placeholder"])]})),_:1}),T(d,{class:"ti-dialog-buffet",show:ne.value,title:b(B)("提示"),onCancel:a[2]||(a[2]=a=>(ne.value=!1,ce.value=!1,e.showVideoOpenSwiperAutoplay())),onConfirm:a[3]||(a[3]=e=>{null==ae||ae.openTablePage(1)})},{content:h((()=>[T(t,{class:"ti-dialog-content"},{default:h((()=>[T(v,{class:"ti-buffet-scroll","scroll-y":""},{default:h((()=>[T(t,{class:"ti-buffet-message"},{default:h((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:h((()=>[A(j(b(B)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:h((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:h((()=>[A(j(b(B)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:h((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:h((()=>[A(j(b(B)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:h((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:h((()=>[A(j(b(B)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-tips"},{default:h((()=>[A(j(b(B)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),T(K,{show:he.value,"onUpdate:show":a[4]||(a[4]=e=>he.value=e),serverVersionNum:b(me),onBindSuccess:Ie},null,8,["show","serverVersionNum"]),T($,{show:fe.value,"onUpdate:show":a[5]||(a[5]=e=>fe.value=e)},null,8,["show"]),T(d,{class:"ti-action-order",show:ge.value,content:b(B)("桌台已开启，可以开始点餐啦~"),onConfirm:a[6]||(a[6]=e=>(xe(),ge.value=!1)),onCancel:a[7]||(a[7]=e=>ge.value=!1)},{title:h((()=>[T(t,{class:"warning-header"},{default:h((()=>[T(t,{class:"warning-image-round"},{default:h((()=>[T(s,{class:"warning-image",src:Q,mode:""})])),_:1}),T(t,{class:"warning-text"},{default:h((()=>[A(j(b(B)("开始点餐")),1)])),_:1})])),_:1})])),_:1},8,["show","content"])])),_:1})):y("",!0)}}},[["__scopeId","data-v-8cc82555"]]);export{Y as default};
