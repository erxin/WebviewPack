import{u as e,a,s as l,r as t,o as s,i,b as o,c as u,d as n,e as r,f as c,g as d,w as v,h as f,j as _,k as p,l as b,m,n as h,p as w,F as g,q as y,t as x,$ as T,v as C,x as k,y as I,z as F,A as j,B as E,C as $,D as B,E as S,G as U,H as D,I as L,J as R,K as A,L as q,M as z,N as G,O as H,S as J,P as K,Q as M,R as N,T as O}from"./index-f651c2bf.js";import{D as P,v as Q,_ as V}from"./verify.1412804c.js";import{_ as W,a as X,b as Y}from"./ti-modal.a07d11c7.js";import{_ as Z}from"./ti-button.b24de7c2.js";import"./components-ti-keyboard-ti-keyboard.f41b966b.js";const ee=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,ae=Z({__name:"index",setup(Z){const ae=e(),le=a(),{userInfo:te}=l(ae),{tableInfo:se}=l(le),{getUserInfo:ie,setUserInfo:oe}=e(),{getTableInfoAsync:ue}=a(),ne=t(!1),re=t(!1);ue();const ce=t(0),de=t(!0),ve=t(!1),fe=t(!1),_e=t(),pe=e=>{var a,l;ce.value=e.detail.current,be(null==(l=null==(a=te.value)?void 0:a.tablet)?void 0:l.carousel,ce.value)};t([]);const be=(e,a)=>{const l=e[a];"video"==I(l.real_name)?setTimeout((()=>{_e.value=l,fe.value=!0,de.value=!1,ve.value=!0}),50):ve.value=!1},me=()=>{var e,a,l,t;fe.value=!1,de.value=!0,ce.value==(null==(a=null==(e=te.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(ce.value=0,be(null==(t=null==(l=te.value)?void 0:l.tablet)?void 0:t.carousel,ce.value)):ce.value+=1},he=()=>{Je()},we=()=>{u({url:"/pages/index/index"})},ge=t(),ye=t("");t([]);const xe=t(),Te=t(!1),Ce=t({ip:"",port:"",device_id:""}),ke=()=>{const e=_();Ce.value.ip=(null==e?void 0:e.ip)||p()||"127.0.0.1",Ce.value.port=(null==e?void 0:e.port)||"8080"},Ie=e=>{Ce.value.ip=e},Fe=e=>{Ce.value.port=e},je=async()=>{var e;const a={...Ce.value};if(a.ip)if(a.port)try{const l=await F(j(`${null==a?void 0:a.ip}:${a.port}`));1==parseInt(l.data.cashier.order_method.is_table_order)?(E(a),$(l.data.app_id),B(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Te.value=!0}),150)):uni.showToast({title:T("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:T("绑定失败"),icon:"none"})}else uni.showToast({title:T("請輸入連接埠"),icon:"none"});else uni.showToast({title:T("請輸入伺服器位址"),icon:"none"})},Ee=e=>{Te.value=!1,e&&(xe.value=e,ye.value=e.table_no)},$e=()=>{ke(),ye.value=U().table_no,xe.value=U()},Be=async()=>{var e;const a={...Ce.value};if(a.ip)if(a.port)try{const l=await F(j(`${null==a?void 0:a.ip}:${a.port}`));if(!xe.value)return void uni.showToast({title:T("請查找桌位"),icon:"none"});1==parseInt(l.data.cashier.order_method.is_table_order)?(E(a),$(l.data.app_id),B(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Se()}),150)):uni.showToast({title:T("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:T("绑定失败"),icon:"none"})}else uni.showToast({title:T("請輸入連接埠"),icon:"none"});else uni.showToast({title:T("請輸入伺服器位址"),icon:"none"})},Se=async()=>{if(D()===xe.value.table_id)return uni.showToast({title:T("绑定成功"),icon:"none"}),void(ge.value=!1);try{const e=await L({table_id:xe.value.table_id,old_table_id:D()});R(xe.value),ie(),ue(),uni.showToast({title:e.msg,icon:"none"}),ge.value=!1}catch(e){}},Ue=t(),De=t(!1),Le=async()=>{var e,a,l,t,s;if(ie(),1===parseInt(null==(e=null==te?void 0:te.value)?void 0:e.tablet.is_customer_order)&&1===parseInt(null==(a=null==te?void 0:te.value)?void 0:a.cashier.order_method.is_table_order))try{const e=await A({table_id:D()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)qe();else{if(1==(null==(t=e.data.order)?void 0:t.is_buffet))return De.value=!0,void(re.value=!0);Re()}else null==(s=Ue.value)||s.tiCallClick("1")}catch(i){}else null==(l=Ue.value)||l.tiCallClick("1")},Re=()=>{q(!0),u({url:"/pages/index/opentable-index"})},Ae=t(!1),qe=()=>{Ae.value=!0},ze=e=>{var a;Ae.value=!1,e&&(null==(a=Ue.value)||a.tiCallClick("1"))},Ge=t(!1),He=t(!1),Je=()=>{Ge.value=!0,He.value=!0},Ke=async e=>{if(e)try{await Q({password:e});ge.value=!0,xe.value=U(),ye.value=xe.value.table_no,Me()}catch(a){}else uni.showToast({title:T("請輸入密碼"),icon:"none",duration:3e3})},Me=()=>{(()=>{Ge.value=!1,He.value=!1;const e=setTimeout((()=>{ge.value,clearTimeout(e)}),300)})()};return t({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),s((()=>{i()&&o()&&u({url:"/pages/index/opentable-index"})})),n((()=>{var e;null==(e=Ue.value)||e.showBuffet(!1,0)})),ke(),(e,a)=>{const l=z(G("ti-layout-head"),V),t=b,s=H,u=J,n=K,_=M,p=N,F=z(G("ti-input"),W),j=z(G("ti-layout-table-list"),X),E=z(G("ti-modal"),Y),$=O;return r(i)()&&!r(o)()?(c(),d(t,{key:0,class:"ti-page",onClick:a[3]||(a[3]=e=>r(k)())},{default:v((()=>[m(t,null,{default:v((()=>{var e,a;return[m(l,{ref_key:"refCallServer",ref:Ue,onDoubleLogo:he,onRefresh:we,is_call_service:parseInt(null==(a=null==(e=r(te))?void 0:e.tablet)?void 0:a.is_call_service)},null,8,["is_call_service"])]})),_:1}),m(t,{class:"ti-page-content"},{default:v((()=>{var e;return[m(t,{class:"ti-page-left"},{default:v((()=>[fe.value?f("",!0):(c(),d(n,{key:0,onChange:pe,class:"ti-swiper",current:ce.value,autoplay:de.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:v((()=>{var e,a;return[(c(!0),h(g,null,w(null==(a=null==(e=r(te))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(c(),d(u,{class:"ti-swiper-item",key:a},{default:v((()=>["image"===r(I)(e.real_name)?(c(),d(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):f("",!0),"video"===r(I)(e.real_name)?(c(),d(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):f("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),fe.value?(c(),d(n,{key:1,class:"ti-swiper"},{default:v((()=>[m(u,{class:"ti-swiper-item"},{default:v((()=>{var e;return[m(_,{onEnded:me,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=_e.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):f("",!0)])),_:1}),m(t,{class:"ti-page-right"},{default:v((()=>[m(t,{class:"ti-store-box"},{default:v((()=>[m(t,{class:"ti-store-item"},{default:v((()=>{var e;return[m(s,{class:"ti-store-logo",src:null==(e=r(te))?void 0:e.logo},null,8,["src"]),m(p,{class:"ti-store-name"},{default:v((()=>{var e;return[y(x(null==(e=r(te))?void 0:e.name),1)]})),_:1})]})),_:1}),m(t,{class:"ti-table-item"},{default:v((()=>[m(t,{class:"ti-table-number"},{default:v((()=>{var e;return[y(x(r(T)("當前桌號："))+x(null==(e=r(se))?void 0:e.table_no),1)]})),_:1}),m(t,{class:"ti-table-button",onClick:Le},{default:v((()=>[m(p,{class:"ti-table-button-text"},{default:v((()=>[y(x(r(T)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),m(P,{show:Ae.value,title:"["+(null==(e=r(se))?void 0:e.table_no)+"]"+r(T)("就餐人数"),placeholder:r(T)("請輸入人數"),isBuffet:!0,password:He.value,onExit:ze},null,8,["show","title","placeholder","password"]),m(P,{show:Ge.value,title:r(T)("密碼"),password:He.value,placeholder:r(T)("請輸入密碼"),onExit:Me,onConfirm:Ke},null,8,["show","title","password","placeholder"])]})),_:1}),m(E,{show:ge.value,title:r(T)("設置"),cancelText:r(T)("重置"),confirmText:r(T)("確定"),onCancel:$e,onConfirm:Be},{content:v((()=>[m(t,{class:"ti-item-input"},{default:v((()=>[m(t,{class:"ti-label-box"},{default:v((()=>[m(t,{class:"ti-label-left"},{default:v((()=>[m(p,{class:"ti-label-server"},{default:v((()=>[y(x(r(T)("服務器連接地址")),1)])),_:1})])),_:1}),m(t,{class:"ti-label-right",onClick:je},{default:v((()=>[m(p,{class:"ti-label-table"},{default:v((()=>[y(x(ye.value?r(T)("已選 : ")+r(C)(ye.value,19):r(T)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),m(t,{class:"ti-input-box"},{default:v((()=>[m(F,{type:"text",onInput:Ie,value:Ce.value.ip,placeholder:r(T)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),m(t,{class:"ti-colon"},{default:v((()=>[y(":")])),_:1}),m(t,{class:"ti-input-port"},{default:v((()=>[m(F,{type:"number",onInput:Fe,value:Ce.value.port,placeholder:r(T)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),m(j,{show:Te.value,"onUpdate:show":a[0]||(a[0]=e=>Te.value=e),onConfirm:Ee},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),m(E,{class:"ti-dialog-buffet",show:re.value,title:r(T)("提示"),onCancel:a[1]||(a[1]=e=>(re.value=!1,void(De.value=!1))),onConfirm:a[2]||(a[2]=e=>Re())},{content:v((()=>[m(t,{class:"ti-dialog-content"},{default:v((()=>[m($,{class:"ti-buffet-scroll","scroll-y":""},{default:v((()=>[m(t,{class:"ti-buffet-message"},{default:v((()=>[m(t,{class:"ti-buffet-case"}),m(t,{class:"ti-buffet-text"},{default:v((()=>[y(x(r(T)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),m(t,{class:"ti-buffet-message"},{default:v((()=>[m(t,{class:"ti-buffet-case"}),m(t,{class:"ti-buffet-text"},{default:v((()=>[y(x(r(T)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),m(t,{class:"ti-buffet-message"},{default:v((()=>[m(t,{class:"ti-buffet-case"}),m(t,{class:"ti-buffet-text"},{default:v((()=>[y(x(r(T)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),m(t,{class:"ti-buffet-message"},{default:v((()=>[m(t,{class:"ti-buffet-case"}),m(t,{class:"ti-buffet-text"},{default:v((()=>[y(x(r(T)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),m(t,{class:"ti-buffet-tips"},{default:v((()=>[y(x(r(T)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),m(E,{class:"ti-action-tips",show:ne.value,title:r(T)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:r(T)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:v((()=>[m(t,{class:"warning-header"},{default:v((()=>[m(t,{class:"warning-image-round"},{default:v((()=>[m(s,{class:"warning-image",src:ee,mode:""})])),_:1}),m(t,{class:"warning-text"},{default:v((()=>[y(x(r(T)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})):f("",!0)}}},[["__scopeId","data-v-8cb4f8b5"]]);export{ae as default};
