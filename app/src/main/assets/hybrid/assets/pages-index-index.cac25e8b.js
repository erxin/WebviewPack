import{u as e,a,s as l,r as t,o as s,i,b as o,c as u,d as n,g as r,e as c,f as d,h as v,w as f,j as _,k as p,l as b,m,n as h,p as w,q as g,F as y,t as x,v as T,$ as C,x as k,y as I,z as F,A as j,B as E,C as U,D as $,E as B,G as S,H as D,I as L,J as R,K as A,L as q,M as z,N as G,O as H,P as J,S as K,Q as M,R as N,T as O,U as P}from"./index-95e93e7f.js";import{D as Q,v as V,_ as W}from"./verify.3c545fba.js";import{_ as X,a as Y,b as Z}from"./ti-modal.54c88d82.js";import{_ as ee}from"./ti-button.1f18b138.js";import"./components-ti-keyboard-ti-keyboard.7b0ffbdf.js";const ae=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,le=ee({__name:"index",setup(ee){const le=e(),te=a(),{userInfo:se}=l(le),{tableInfo:ie}=l(te),{getUserInfo:oe,setUserInfo:ue}=e(),{getTableInfoAsync:ne}=a(),re=t(!1),ce=t(!1);ne();const de=t(0),ve=t(!0),fe=t(!1),_e=t(!1),pe=t(),be=e=>{var a,l;de.value=e.detail.current,me(null==(l=null==(a=se.value)?void 0:a.tablet)?void 0:l.carousel,de.value)};t([]);const me=(e,a)=>{const l=e[a];"video"==F(l.real_name)?setTimeout((()=>{pe.value=l,_e.value=!0,ve.value=!1,fe.value=!0}),50):fe.value=!1},he=()=>{var e,a,l,t;_e.value=!1,ve.value=!0,de.value==(null==(a=null==(e=se.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(de.value=0,me(null==(t=null==(l=se.value)?void 0:l.tablet)?void 0:t.carousel,de.value)):de.value+=1},we=()=>{Ke()},ge=()=>{u({url:"/pages/index/index"})},ye=t(),xe=t("");t([]);const Te=t(),Ce=t(!1),ke=t({ip:"",port:"",device_id:""}),Ie=()=>{const e=p();ke.value.ip=(null==e?void 0:e.ip)||b()||"127.0.0.1",ke.value.port=(null==e?void 0:e.port)||"8080"},Fe=e=>{ke.value.ip=e},je=e=>{ke.value.port=e},Ee=async()=>{var e;const a={...ke.value};if(a.ip)if(a.port)try{const l=await j(E(`${null==a?void 0:a.ip}:${a.port}`));1==parseInt(l.data.cashier.order_method.is_table_order)?(U(a),$(l.data.app_id),B(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Ce.value=!0}),150)):uni.showToast({title:C("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:C("绑定失败"),icon:"none"})}else uni.showToast({title:C("請輸入連接埠"),icon:"none"});else uni.showToast({title:C("請輸入伺服器位址"),icon:"none"})},Ue=e=>{Ce.value=!1,e&&(Te.value=e,xe.value=e.table_no)},$e=()=>{Ie(),xe.value=D().table_no,Te.value=D()},Be=async()=>{var e;const a={...ke.value};if(a.ip)if(a.port)try{const l=await j(E(`${null==a?void 0:a.ip}:${a.port}`));if(!Te.value)return void uni.showToast({title:C("請查找桌位"),icon:"none"});1==parseInt(l.data.cashier.order_method.is_table_order)?(U(a),$(l.data.app_id),B(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Se()}),150)):uni.showToast({title:C("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:C("绑定失败"),icon:"none"})}else uni.showToast({title:C("請輸入連接埠"),icon:"none"});else uni.showToast({title:C("請輸入伺服器位址"),icon:"none"})},Se=async()=>{if(L()===Te.value.table_id)return uni.showToast({title:C("绑定成功"),icon:"none"}),void(ye.value=!1);try{const e=await R({table_id:Te.value.table_id,old_table_id:L()});A(Te.value),oe(),ne(),uni.showToast({title:e.msg,icon:"none"}),ye.value=!1}catch(e){}},De=t(),Le=t(!1),Re=async()=>{var e,a,l,t,s;if(oe(),1===parseInt(null==(e=null==se?void 0:se.value)?void 0:e.tablet.is_customer_order)&&1===parseInt(null==(a=null==se?void 0:se.value)?void 0:a.cashier.order_method.is_table_order))try{const e=await q({table_id:L()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)ze();else{if(1==(null==(t=e.data.order)?void 0:t.is_buffet))return Le.value=!0,void(ce.value=!0);Ae()}else null==(s=De.value)||s.tiCallClick("1")}catch(i){}else null==(l=De.value)||l.tiCallClick("1")},Ae=()=>{z(!0),u({url:"/pages/index/opentable-index"})},qe=t(!1),ze=()=>{qe.value=!0},Ge=e=>{var a;qe.value=!1,e&&(null==(a=De.value)||a.tiCallClick("1"))},He=t(!1),Je=t(!1),Ke=()=>{He.value=!0,Je.value=!0},Me=async e=>{if(e)try{await V({password:e});ye.value=!0,Te.value=D(),xe.value=Te.value.table_no,Ne()}catch(a){}else uni.showToast({title:C("請輸入密碼"),icon:"none",duration:3e3})},Ne=()=>{(()=>{He.value=!1,Je.value=!1;const e=setTimeout((()=>{ye.value,clearTimeout(e)}),300)})()};return t({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),s((()=>{i()&&o()&&u({url:"/pages/index/opentable-index"})})),n((()=>{var e;null==(e=De.value)||e.showBuffet(!1,0)})),Ie(),r({success:e=>{ke.value.device_id=e.deviceId}}),(e,a)=>{const l=G(H("ti-layout-head"),W),t=m,s=J,u=K,n=M,r=N,p=O,b=G(H("ti-input"),X),j=G(H("ti-layout-table-list"),Y),E=G(H("ti-modal"),Z),U=P;return c(i)()&&!c(o)()?(d(),v(t,{key:0,class:"ti-page",onClick:a[3]||(a[3]=e=>c(I)())},{default:f((()=>[h(t,null,{default:f((()=>{var e,a;return[h(l,{ref_key:"refCallServer",ref:De,onDoubleLogo:we,onRefresh:ge,is_call_service:parseInt(null==(a=null==(e=c(se))?void 0:e.tablet)?void 0:a.is_call_service)},null,8,["is_call_service"])]})),_:1}),h(t,{class:"ti-page-content"},{default:f((()=>{var e;return[h(t,{class:"ti-page-left"},{default:f((()=>[_e.value?_("",!0):(d(),v(n,{key:0,onChange:be,class:"ti-swiper",current:de.value,autoplay:ve.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:f((()=>{var e,a;return[(d(!0),w(y,null,g(null==(a=null==(e=c(se))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(d(),v(u,{class:"ti-swiper-item",key:a},{default:f((()=>["image"===c(F)(e.real_name)?(d(),v(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):_("",!0),"video"===c(F)(e.real_name)?(d(),v(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):_("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),_e.value?(d(),v(n,{key:1,class:"ti-swiper"},{default:f((()=>[h(u,{class:"ti-swiper-item"},{default:f((()=>{var e;return[h(r,{onEnded:he,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=pe.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):_("",!0)])),_:1}),h(t,{class:"ti-page-right"},{default:f((()=>[h(t,{class:"ti-store-box"},{default:f((()=>[h(t,{class:"ti-store-item"},{default:f((()=>{var e;return[h(s,{class:"ti-store-logo",src:null==(e=c(se))?void 0:e.logo},null,8,["src"]),h(p,{class:"ti-store-name"},{default:f((()=>{var e;return[x(T(null==(e=c(se))?void 0:e.name),1)]})),_:1})]})),_:1}),h(t,{class:"ti-table-item"},{default:f((()=>[h(t,{class:"ti-table-number"},{default:f((()=>{var e;return[x(T(c(C)("當前桌號："))+T(null==(e=c(ie))?void 0:e.table_no),1)]})),_:1}),h(t,{class:"ti-table-button",onClick:Re},{default:f((()=>[h(p,{class:"ti-table-button-text"},{default:f((()=>[x(T(c(C)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),h(Q,{show:qe.value,title:"["+(null==(e=c(ie))?void 0:e.table_no)+"]"+c(C)("就餐人数"),placeholder:c(C)("請輸入人數"),isBuffet:!0,password:Je.value,onExit:Ge},null,8,["show","title","placeholder","password"]),h(Q,{show:He.value,title:c(C)("密碼"),password:Je.value,placeholder:c(C)("請輸入密碼"),onExit:Ne,onConfirm:Me},null,8,["show","title","password","placeholder"])]})),_:1}),h(E,{show:ye.value,title:c(C)("設置"),cancelText:c(C)("重置"),confirmText:c(C)("確定"),onCancel:$e,onConfirm:Be},{content:f((()=>[h(t,{class:"ti-item-input"},{default:f((()=>[h(t,{class:"ti-label-box"},{default:f((()=>[h(t,{class:"ti-label-left"},{default:f((()=>[h(p,{class:"ti-label-server"},{default:f((()=>[x(T(c(C)("服務器連接地址")),1)])),_:1})])),_:1}),h(t,{class:"ti-label-right",onClick:Ee},{default:f((()=>[h(p,{class:"ti-label-table"},{default:f((()=>[x(T(xe.value?c(C)("已選 : ")+c(k)(xe.value,19):c(C)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),h(t,{class:"ti-input-box"},{default:f((()=>[h(b,{type:"text",onInput:Fe,value:ke.value.ip,placeholder:c(C)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),h(t,{class:"ti-colon"},{default:f((()=>[x(":")])),_:1}),h(t,{class:"ti-input-port"},{default:f((()=>[h(b,{type:"number",onInput:je,value:ke.value.port,placeholder:c(C)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),h(j,{show:Ce.value,"onUpdate:show":a[0]||(a[0]=e=>Ce.value=e),onConfirm:Ue},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),h(E,{class:"ti-dialog-buffet",show:ce.value,title:c(C)("提示"),onCancel:a[1]||(a[1]=e=>(ce.value=!1,void(Le.value=!1))),onConfirm:a[2]||(a[2]=e=>Ae())},{content:f((()=>[h(t,{class:"ti-dialog-content"},{default:f((()=>[h(U,{class:"ti-buffet-scroll","scroll-y":""},{default:f((()=>[h(t,{class:"ti-buffet-message"},{default:f((()=>[h(t,{class:"ti-buffet-case"}),h(t,{class:"ti-buffet-text"},{default:f((()=>[x(T(c(C)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),h(t,{class:"ti-buffet-message"},{default:f((()=>[h(t,{class:"ti-buffet-case"}),h(t,{class:"ti-buffet-text"},{default:f((()=>[x(T(c(C)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),h(t,{class:"ti-buffet-message"},{default:f((()=>[h(t,{class:"ti-buffet-case"}),h(t,{class:"ti-buffet-text"},{default:f((()=>[x(T(c(C)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),h(t,{class:"ti-buffet-message"},{default:f((()=>[h(t,{class:"ti-buffet-case"}),h(t,{class:"ti-buffet-text"},{default:f((()=>[x(T(c(C)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),h(t,{class:"ti-buffet-tips"},{default:f((()=>[x(T(c(C)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),h(E,{class:"ti-action-tips",show:re.value,title:c(C)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:c(C)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:f((()=>[h(t,{class:"warning-header"},{default:f((()=>[h(t,{class:"warning-image-round"},{default:f((()=>[h(s,{class:"warning-image",src:ae,mode:""})])),_:1}),h(t,{class:"warning-text"},{default:f((()=>[x(T(c(C)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})):_("",!0)}}},[["__scopeId","data-v-0c49b4a6"]]);export{le as default};
