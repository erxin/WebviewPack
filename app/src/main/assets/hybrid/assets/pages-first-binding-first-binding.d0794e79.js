import{R as a,T as e,U as s,V as l,W as t,X as o,Y as n,Z as i,a0 as u,r as c,a1 as r,_ as d,n as v,p as f,q as p,z as m,F as g,A as _,y as w,C as h,D as b,B as y,t as A,x as k,L as x,a2 as U,d as B,b as C,s as I,a3 as j,w as T,k as S,a4 as E,j as G,a5 as L,J as O,K as V,m as Q,E as R,a6 as N,a7 as Y,a8 as D,a9 as H,aa as X,ab as z,ac as J,ad as K,ae as M,af as q,ag as P,ah as Z,ai as F,aj as W,ak as $,f as aa,al as ea,am as sa,N as la,an as ta,ao as oa,ap as na,$ as ia,aq as ua,G as ca,ar as ra,as as da,at as va}from"./index-8b476289.js";import{a as fa,b as pa,c as ma,d as ga,e as _a,V as wa,_ as ha}from"./ti-layout-table-list.6a15f4f1.js";import{_ as ba,a as ya}from"./red-ring.eead522c.js";import{_ as Aa}from"./ti-button.136725f5.js";var ka=Object.prototype.hasOwnProperty;function xa(u){if(null==u)return!0;if(a(u)&&(e(u)||"string"==typeof u||"function"==typeof u.splice||s(u)||l(u)||t(u)))return!u.length;var c=o(u);if("[object Map]"==c||"[object Set]"==c)return!u.size;if(n(u))return!i(u).length;for(var r in u)if(ka.call(u,r))return!1;return!0}const Ua=""+new URL("close-circle-eb05c338.svg",import.meta.url).href,Ba=u("accountInfo",(()=>{const a=c([]);return{users:a,saveUserInfo:(e,s,l)=>{l=r(l);const t=a.value.findIndex((a=>a.account===s));t>-1?(a.value[t].password=l,a.value[t].name=e):a.value.push({name:e,account:s,password:l})},deleteUserInfo:e=>{a.value=a.value.filter((a=>a.account!==e))},searchUsers:e=>e&&""!=e?a.value.filter((a=>a.account.includes(e))):a.value}}),{persist:{paths:["users"]}}),Ca=d({__name:"ti-users-list",props:{show:{type:Boolean,default:!1},usersInfo:{default:""}},emits:["update:show","chooseUser"],setup(a,{emit:e}){const s=Ba(),l=e,t=a;return(e,o)=>{const n=k,i=x;return a.show?(v(),f(n,{key:0,class:"container ti-overlay-y",onClick:o[0]||(o[0]=y((()=>{}),["stop"]))},{default:p((()=>[t.usersInfo.length>0?(v(!0),m(g,{key:0},_(t.usersInfo,((a,e)=>(v(),f(n,{class:"ti-item-box",key:e},{default:p((()=>[w(n,{class:"item",onClick:e=>(l("chooseUser",a),void l("update:show",!1))},{default:p((()=>[w(n,{class:"item-left"},{default:p((()=>[w(n,{class:"item-name"},{default:p((()=>[h(b(a.name),1)])),_:2},1024),w(n,{class:"item-account"},{default:p((()=>[h(b(a.account),1)])),_:2},1024)])),_:2},1024),w(n,{class:"item-right"},{default:p((()=>[w(i,{src:Ua,onClick:y((e=>(a=>{s.deleteUserInfo(a.account),l("update:show",!1)})(a)),["stop"])},null,8,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128)):(v(),f(n,{key:1,class:"ti-item-box"},{default:p((()=>[w(n,{class:"item no-data-item"},{default:p((()=>[w(n,{class:""},{default:p((()=>[h(b(e.$t("没有找到匹配的账号")),1)])),_:1})])),_:1})])),_:1}))])),_:1})):A("",!0)}}},[["__scopeId","data-v-d4121256"]]),Ia=""+new URL("payment-check-c054717b.svg",import.meta.url).href,ja=d({__name:"ti-login",emits:["login","focus","blur","bindErr"],setup(a,{emit:e}){const s=U(),l=B(),t=C(),o=Ba(),{users:n}=I(Ba()),i=e,u=c({user_name:"",password:"",code:"",device_id:"",brand:j()}),r=c(!0),d=c(!1),g=c(!1),_=c(!1),y=c(!1),ta=c(!1),oa=c(),na=c(),ia=c(),ua=c(!1),ca=c(),ra=c(!1),da=()=>{u.value.user_name?u.value.password?u.value.code?va():uni.showToast({title:R("请输入验证码"),icon:"none"}):uni.showToast({title:R("请输入密码"),icon:"none"}):uni.showToast({title:R("请输入账号/手机号"),icon:"none"})},va=async()=>{var a,e;u.value.device_id=D();try{const s=await H(u.value,na.value);X(s.data.app_id),z(u.value.device_id),J(s.data.token),K((null==(a=s.data)?void 0:a.real_name)||"user_name"),ra.value&&o.saveUserInfo(null==(e=s.data)?void 0:e.real_name,u.value.user_name,u.value.password),uni.showToast({title:s.msg,icon:"none"}),ga()}catch(s){i("bindErr",s),wa()}},ga=async()=>{var a;try{const e=await M();1==parseInt(e.data.cashier.order_method.is_table_order)?(q(e.data.shop_supplier_id),P(null==(a=e.data)?void 0:a.currency),null==t||t.setUserInfo(e.data),y.value=!0):uni.showToast({title:R("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(e){}},_a=async a=>{if(y.value=!1,a)try{const e=await Z({table_id:a.table_id,key:u.value.device_id,brand:j()});F(a),W({title:R("加载中...")}),await(null==s?void 0:s.getCategoryList(!0)),await(null==l?void 0:l.getGoodsBaseList({category_id:0},!0)),$(),aa({url:"/pages/index/index"}),uni.showToast({title:e.msg,icon:"none"})}catch(e){}},wa=async()=>{var a,e,s;if(!ta.value)try{ta.value=!0;const l=await ea({v:1});(null==(a=l.data)?void 0:a.sign)?(oa.value=null==(e=l.data)?void 0:e.base64,na.value=null==(s=l.data)?void 0:s.sign):uni.showToast({title:R("验证码生成失败"),icon:"none"})}catch(l){}finally{ta.value=!1,ha()}},ha=()=>{ia.value&&clearTimeout(ia.value),ia.value=setTimeout((()=>{wa()}),178200)},ya=a=>{r.value="username"===a,d.value="password"===a,g.value="verifycode"===a,g.value&&(ua.value=!1),i("focus")},ka=()=>{i("blur")},Ua=a=>{u.value.user_name=a.account,u.value.password=sa(a.password)};T((()=>u.value.user_name),(()=>{ca.value=o.searchUsers(u.value.user_name)}),{});const ja=a=>{a.target.closest(".container")||(ua.value=!1)};return T((()=>[u.value.user_name,u.value.password,u.value.code]),(([a,e,s])=>{_.value=!!(a&&e&&s)})),S((()=>{window.addEventListener("click",ja)})),E((()=>{window.removeEventListener("click",ja)})),G((()=>{if("function"==typeof window.config){let a=window.config().saasApiUrl;N()||(a=window.location.origin),a?(L(a),wa()):uni.showToast({title:"请配置config.js文件的saasApiUrl参数",icon:"error"})}})),(a,e)=>{const s=O(V("ti-input-d"),fa),l=k,t=O(V("ti-loading"),ba),i=O(V("uni-icons"),pa),c=la,U=x,B=O(V("ti-button"),Aa),C=O(V("ti-layout-table-list"),ma),I=O(V("ti-users-list"),Ca);return v(),f(l,{class:"container"},{default:p((()=>[w(l,{class:"ti-item-input user-input"},{default:p((()=>[w(s,{modelValue:u.value.user_name,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.user_name=a),prefixIcon:"icon-user",placeholder:Q(R)("请输入账号/手机号"),focus:r.value,disabled:!1,popKeyboard:!0,endIcon:!Q(xa)(Q(n))&&Q(N)(),onFocus:e[1]||(e[1]=a=>ya("username")),onBlur:ka,onEndClick:e[2]||(e[2]=a=>(ua.value=!ua.value,void(ca.value=o.searchUsers(u.value.user_name))))},null,8,["modelValue","placeholder","focus","endIcon"])])),_:1}),w(l,{class:"ti-item-input"},{default:p((()=>[w(s,{modelValue:u.value.password,"onUpdate:modelValue":e[3]||(e[3]=a=>u.value.password=a),prefixIcon:"icon-lock",class:"ti-member-input",placeholder:Q(R)("请输入密码 "),password:!0,disabled:!1,popKeyboard:!0,focus:d.value,onFocus:e[4]||(e[4]=a=>ya("password")),onBlur:ka},null,8,["modelValue","placeholder","focus"])])),_:1}),w(l,{class:"ti-item-input"},{default:p((()=>[w(l,{class:"ti-input-box"},{default:p((()=>[w(s,{modelValue:u.value.code,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.code=a),prefixIcon:"icon-shield-tick",placeholder:Q(R)("请输入验证码"),focus:g.value,popKeyboard:!0,disabled:!1,onFocus:e[6]||(e[6]=a=>ya("verifycode")),onBlur:ka,onConfirm:da},null,8,["modelValue","placeholder","focus"]),w(l,{class:"ti-login-code",onClick:wa},{default:p((()=>[oa.value?(v(),m("img",{key:0,src:oa.value,alt:""},null,8,["src"])):ta.value?(v(),f(t,{key:1})):(v(),f(l,{key:2,class:"ti-login-code-error"},{default:p((()=>[w(i,{"custom-prefix":"iconfont",type:"icon-shuaxin",size:"16",color:"#999"}),w(c,{style:{"margin-left":"5px"}},{default:p((()=>[h(b(Q(R)("重新加载")),1)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),Q(N)()?(v(),f(l,{key:0,class:"ti-item-check-box"},{default:p((()=>[ra.value?(v(),f(U,{key:0,class:"item-check-box select",src:Ia,onClick:e[7]||(e[7]=a=>ra.value=!ra.value)})):(v(),f(l,{key:1,class:"item-check-box",onClick:e[8]||(e[8]=a=>ra.value=!ra.value)})),w(l,{class:"item-check-box-title",onClick:e[9]||(e[9]=a=>ra.value=!ra.value)},{default:p((()=>[h(b(Q(R)("记住密码")),1)])),_:1})])),_:1})):A("",!0),w(l,null,{default:p((()=>[w(B,{class:Y(["ti-login-btn",{islogin:_.value}]),onClick:da},{default:p((()=>[h(b(Q(R)("登录")),1)])),_:1},8,["class"])])),_:1}),w(C,{show:y.value,onConfirm:_a,onCancel:e[10]||(e[10]=a=>(y.value=!1,wa()))},null,8,["show"]),w(I,{class:"users-list",show:ua.value,"onUpdate:show":e[11]||(e[11]=a=>ua.value=a),usersInfo:ca.value,onChooseUser:Ua},null,8,["show","usersInfo"])])),_:1})}}},[["__scopeId","data-v-2b4aab9b"]]),Ta=""+new URL("binding-page-bg-image-db048039.png",import.meta.url).href,Sa=d({__name:"set-language",props:{firstBind:{type:Boolean,default:!1}},setup(a){const e=a,s=c(ta[oa()]),l=c(),t=a=>{l.value.isShow()?l.value.close():l.value.open()},o=()=>{s.value=ta[oa()]};return(a,n)=>{const i=O(V("ti-layout-language-item"),ga),u=k,c=x,r=la;return v(),f(u,{class:"ti-language",onClick:[t,n[0]||(n[0]=y((()=>{}),["stop"]))]},{default:p((()=>[w(u,{class:"ti-language-box"},{default:p((()=>[w(i,{ref_key:"refShowLanguage",ref:l,firstBind:e.firstBind,onLanguageText:o},null,8,["firstBind"])])),_:1}),w(c,{class:"ti-language-global",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIeSURBVHgB5VXdcdswDAYUKpXVPrAbeASNoExQZ4ImE7QbxB6hE9gb1BvYnSDaoN6gfOg5PsshA0CyJEbUnZK7vCTfnX9EfvgAkAAE8CGgP8c3ehL/1Wns6s+9nnz6OcY2GhRNL2ckWolY9x0Qpp3tjBa/CY84HMCLHOhU3QG43+BcoTVoQMx7JIRc9ogDDpYU0N0oB5U4zuUhORVwUBkMgfeYI3DzkBP0xBNKNYJlxYeteSiv+KjoODJwaMBZU1lFlJXTUOLalGWhJ2rTZmmvzf5xHQxIzjNRlDol/0Kwjdie7y2UQUWkc+XUH0/GlFBQxSwpm/zZJXOGO1rbmn15q9OLGVjKkI7LGDBdWtSJ/gd9NnCM/0GEG4jVrBbqi1eh8VpeP2RiQ7as0a0q1Rq4GyE2EaLpCA1h2nCxcZxTULy+8jLwxGXHGhgL1+NOGxl4Y7QO+NK6sNH4SsIetwg5WFBXblsjp4OOfew8rvBJA+HX+bG5ZHMoV/Szkh44/KeqqI0Q/pATGCpT+U8NBxcknHyhMjXDd9c2Gryi0SDYaMpjoaWoIq5nclaPijjOIHbUSG7ncSOc0ldh9se1jIojjYpIMr31JHuRpGpOy9XQuiy/SldzE4Vg3ZUMO27OSm5BDudeHM9tzP5EBLeQB29aBuBN27540EHjxFKqiJnMlm51ncHTlveQGxSvQ+KjIZefqvvmlcmvz2T4Lfa+8ARyhNbiDRkX2gAAAABJRU5ErkJggg=="}),w(r,{class:"ti-language-text"},{default:p((()=>[h(b(s.value),1)])),_:1}),w(c,{class:"ti-language-arrow-down",src:_a})])),_:1})}}},[["__scopeId","data-v-e2382d00"]]),Ea=d({__name:"first-binding",setup(a){da((a=>({"57a96327":i.value})));const e=c(!1),s=c(""),l=c(""),t=c(),o=c(!1),n=na().deviceModel,i=c(""),u=c(0);let r=Date.now();const d=c(),_=a=>{0!=a.code?(-20==a.code||-201==a.code?(l.value=R("温馨提示"),t.value="../../static/red-ring.svg"):-21==a.code?(l.value=R("登录失败"),t.value="../../static/monitor-mobbile.svg"):(l.value=R("温馨提示"),t.value="../../static/red-ring.svg"),-20!=a.code&&-201!=a.code&&-21!=a.code||(e.value=!0,s.value=a.msg)):uni.showToast({title:a.msg,icon:"none"})},y=()=>{("PC"!=n||N())&&va({success:a=>{i.value="-"+a.screenHeight/2+"px"}})},A=()=>{i.value=""},U=()=>{const a=Date.now();a-r>1e3?u.value=1:u.value++,r=a,u.value>=6&&(new wa,u.value=0)};return ia("authorization",(a=>{o.value=!a})),S((()=>{var a;d.value=null==(a=window.config())?void 0:a.title})),(a,n)=>{const i=x,u=k,c=la,r=O(V("ti-login"),ja),B=O(V("ti-modal"),ha);return v(),m(g,null,[w(u,{class:"page",onClick:n[0]||(n[0]=a=>Q(ca)())},{default:p((()=>[w(u,{class:"ti-page-bg"},{default:p((()=>[w(i,{class:"ti-bg-image",src:Ta})])),_:1}),w(u,{class:"ti-flex"},{default:p((()=>[w(u,{class:"ti-flex-round"},{default:p((()=>[w(u,{class:"ti-round-box"},{default:p((()=>[w(u,{class:"ti-round-content"},{default:p((()=>[Q(N)()?(v(),f(u,{key:0,class:"ti-item-logo",onClick:U},{default:p((()=>["jbc"==Q(ua)()?(v(),f(c,{key:0,class:"ti-platform"},{default:p((()=>[h("JBCレジ · "+b(Q(R)("平板")),1)])),_:1})):"ttpos"==Q(ua)()?(v(),f(c,{key:1,class:"ti-platform"},{default:p((()=>[h("TTPOS · "+b(Q(R)("平板")),1)])),_:1})):(v(),f(c,{key:2,class:"ti-platform"},{default:p((()=>[h("TTPOS · "+b(Q(R)("平板")),1)])),_:1}))])),_:1})):(v(),f(u,{key:1,class:"ti-item-logo"},{default:p((()=>[w(u,{class:"ti-platform"},{default:p((()=>[h(b(d.value+" · "+Q(R)("平板")),1)])),_:1})])),_:1})),w(r,{class:"m-top-32px",onFocus:y,onBlur:A,onBindErr:_})])),_:1})])),_:1})])),_:1})])),_:1}),w(u,{class:"ti-language-box"},{default:p((()=>[w(Sa,{firstBind:!0})])),_:1})])),_:1}),w(B,{class:"ti-action-tips",show:e.value,"onUpdate:show":n[1]||(n[1]=a=>e.value=a),isCancelShow:!1,isConfirmShow:!0,content:s.value,onConfirm:n[2]||(n[2]=a=>e.value=!1),confirmType:"danger"},{title:p((()=>[w(u,{class:"warning-header"},{default:p((()=>[w(u,{class:"warning-image-round"},{default:p((()=>[w(i,{class:"warning-image",src:t.value,mode:""},null,8,["src"])])),_:1}),w(u,{class:"warning-text yx-text-bold"},{default:p((()=>[h(b(l.value),1)])),_:1})])),_:1})])),default:p((()=>[ra("template",null,[w(u)])])),_:1},8,["show","content"]),w(B,{class:"ti-action-tips",show:o.value,title:Q(R)("店鋪到期"),isCancelShow:!1,onConfirm:n[3]||(n[3]=a=>o.value=!1),isConfirmShow:!0,content:Q(R)("店鋪狀態已到期，如需使用，請聯繫銷售代表"),confirmType:"danger"},{title:p((()=>[w(u,{class:"warning-header"},{default:p((()=>[w(u,{class:"warning-image-round"},{default:p((()=>[w(i,{class:"warning-image",src:ya,mode:""})])),_:1}),w(u,{class:"warning-text"},{default:p((()=>[h(b(Q(R)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-955957ad"]]);export{Ea as default};
