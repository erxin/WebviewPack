import{_ as e,u as a,a as l,b as t,c as s,d as u,s as o,r as i,o as n,i as r,e as c,f as v,g as d,w as f,h as _,j as p,k as m,$ as b,l as g,m as h,n as w,p as y,q as x,t as C,v as k,x as I,y as T,z as F,A,F as j,B,C as E,D as M,E as P,G as V,H as S,I as U,J as q,K as O,L as D,S as L,M as N,N as z,O as G,P as H,Q as J}from"./index-8b476289.js";import{D as K,T as Q,a as $,_ as R,v as W,b as X}from"./ti-store-expire.f0222961.js";import{_ as Y}from"./ti-layout-table-list.6a15f4f1.js";import"./components-ti-keyboard-ti-keyboard.ba9f90ca.js";import"./ti-button.136725f5.js";const Z=e({__name:"index",setup(e){const{clearOpenping:Z,getOpenPing:ee}=a();l();const ae=t(),le=s();u();const{userInfo:te}=o(ae),{tableInfo:se}=o(le),ue=i(0),oe=i(!0);i(!1),i(!1);const ie=i();i([]);const ne=i(3e4),re=i(!1),ce=i(),ve=i(!1),de=i(!1),fe=i(!0),_e=i(!1),pe=i(!1),me=i(!1);i(!0);let be="";const ge=i(null),he=i(!1);let we=null;const ye=i(!1),xe=i(!1),Ce=()=>{("1"===k("client_voice").value&&k("client_voice").time>k("server_voice").time||"1"===k("server_voice").value&&(null==k("client_voice").time||k("server_voice").time>k("client_voice").time))&&(we=S(),we.src="/static/new.mp3",we.autoplay=!1,we.loop=!1,we.play(),we.onPlay((()=>{})),we.onEnded((()=>{we.destroy()})))},ke=async()=>{var e,a,l,t,s,u;try{if(await(null==ae?void 0:ae.getUserInfo(!0)),1!=parseInt(null==(e=null==te?void 0:te.value)?void 0:e.cashier.order_method.is_table_order))return void(null==(a=ce.value)||a.tiCallClick("1"));const o=await(null==le?void 0:le.getTableInfoAsync(!0));if(30===o.data.status){if(1==(null==(l=o.data.order)?void 0:l.is_buffet))return ve.value=!0,re.value=!0,void hideVideoCloseSwiperAutoplay();null==le||le.openTablePage(null==(s=null==(t=o.data)?void 0:t.order)?void 0:s.is_buffet)}else 1===parseInt(o.data.tablet.is_customer_order)?Ie():null==(u=ce.value)||u.tiCallClick("1")}catch(o){"request:fail"==o.errMsg&&(null==le||le.openTablePage())}},Ie=()=>{Z(),fe.value=1==te.value.buffet.is_open,de.value=!0},Te=e=>{var a;ee(),de.value=!1,e&&(null==(a=ce.value)||a.tiCallClick("1"))},Fe=async e=>{if(e)try{const a=await W({password:e});be=a.data.server_version,ye.value=!0,je()}catch(a){"request:fail"==a.errMsg||"request:fail"==a.errmsg?uni.showToast({title:P("网络异常，请检查您的网络设置"),icon:"none"}):(a.errMsg||a.msg)&&uni.showToast({title:a.msg||a.errMsg,icon:"none"})}else uni.showToast({title:P("請輸入密碼"),icon:"none"})},Ae=()=>{ye.value=!1,setTimeout((()=>{null==ae||ae.getUserInfo(!0),null==le||le.getTableInfoAsync(!0)}),1150)},je=()=>{pe.value=!1,me.value=!1},Be=e=>{ue.value=(null==e?void 0:e.detail.current)||0,ne.value=3e4,Me(ue.value)},Ee=e=>{let a=Math.floor(e.detail.duration)+5;ne.value=1e3*a},Me=e=>{var a,l,t,s,u,o;xe.value="video"==(null==(l=null==(a=te.value)?void 0:a.tablet)?void 0:l.carousel[e].type);const i=null==(s=null==(t=te.value)?void 0:t.tablet)?void 0:s.carousel[e];"video"==i.type?(ge.value=U("myVideo"),ie.value=i,null==(u=ge.value)||u.play(),oe.value=!1):(null==(o=ge.value)||o.stop(),oe.value=!0)},Pe=()=>{var e,a;ue.value==(null==(a=null==(e=te.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(ue.value=0,Me(ue.value)):(ue.value+=1,Me(ue.value))};return n((()=>{null==le||le.getTableInfoAsync(),r()&&c()&&v({url:"/pages/index/opentable-index"})})),d((()=>{var e;oe.value=!0,null==(e=ce.value)||e.showBuffet(!1,0),f((()=>te.value),(e=>{e&&Me(ue.value)}),{immediate:!0})})),_((()=>{var e;oe.value=!1,null==(e=ge.value)||e.pause()})),p((()=>{})),m((()=>{null==ae||ae.getUserInfo(!0),null==le||le.getTableInfoAsync(!0),b("fuyixin",(()=>{he.value=!0,Ce()}))})),g((()=>{var e;null==(e=ge.value)||e.pause(),oe.value=!1})),b("authorization",(e=>{_e.value=!e})),(e,a)=>{const l=q(O("ti-layout-head"),X),t=I,s=D,u=J,o=L,i=N,n=z,v=G,d=q(O("ti-modal"),Y);return h(r)()&&!h(c)()?(w(),y(t,{key:0,class:"ti-page",onClick:a[8]||(a[8]=e=>h(V)())},{default:x((()=>[T(t,null,{default:x((()=>{var e,t;return[T(l,{ref_key:"refCallServer",ref:ce,onDoubleLogo:a[0]||(a[0]=e=>(pe.value=!0,void(me.value=!0))),is_call_service:parseInt(null==(t=null==(e=h(te))?void 0:e.tablet)?void 0:t.is_call_service)},null,8,["is_call_service"])]})),_:1}),T(t,{class:"ti-page-content"},{default:x((()=>{var e;return[T(t,{class:"ti-page-left"},{default:x((()=>[xe.value?(w(),y(t,{key:1,class:"video-container",onTouchmove:a[1]||(a[1]=B((()=>{}),["stop"]))},{default:x((()=>{var e;return[T(i,{style:{height:"100%",width:"100%"},id:"myVideo",onEnded:Pe,controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ie.value)?void 0:e.file_path,"enable-progress-gesture":!1,onLoadedmetadata:Ee},null,8,["src"])]})),_:1})):(w(),y(o,{key:0,onChange:Be,class:"ti-swiper",current:ue.value,autoplay:oe.value,circular:"",interval:ne.value,"indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:x((()=>{var e,a;return[(w(!0),F(j,null,A(null==(a=null==(e=h(te))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(w(),y(u,{class:"ti-swiper-item",key:a},{default:x((()=>["image"===h(H)(e.real_name)?(w(),y(t,{key:0,class:"ti-swiper-item"},{default:x((()=>["image"===h(H)(e.real_name)?(w(),y(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):C("",!0)])),_:2},1024)):C("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay","interval"]))])),_:1}),T(t,{class:"ti-page-right"},{default:x((()=>[T(t,{class:"ti-store-box"},{default:x((()=>[T(t,{class:"ti-store-item"},{default:x((()=>{var e;return[T(s,{class:"ti-store-logo",src:null==(e=h(te))?void 0:e.logo},null,8,["src"]),T(n,{class:"ti-store-name"},{default:x((()=>{var e;return[E(M(null==(e=h(te))?void 0:e.name),1)]})),_:1})]})),_:1}),T(t,{class:"ti-table-item"},{default:x((()=>[T(t,{class:"ti-table-number"},{default:x((()=>{var e;return[E(M(h(P)("桌號："))+M(null==(e=h(se))?void 0:e.table_no),1)]})),_:1}),T(t,{class:"ti-table-button",onClick:ke},{default:x((()=>[T(n,{class:"ti-table-button-text"},{default:x((()=>[E(M(h(P)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),T(K,{show:de.value,title:"["+(null==(e=h(se))?void 0:e.table_no)+"]"+h(P)("就餐人数"),placeholder:h(P)("請輸入人數"),isBuffet:fe.value,password:me.value,onExit:Te},null,8,["show","title","placeholder","isBuffet","password"]),T(K,{show:pe.value,title:h(P)("密碼"),password:me.value,placeholder:h(P)("請輸入密碼"),onExit:je,onConfirm:Fe},null,8,["show","title","password","placeholder"])]})),_:1}),T(d,{class:"ti-dialog-buffet",show:re.value,title:h(P)("提示"),onCancel:a[2]||(a[2]=a=>(re.value=!1,ve.value=!1,e.showVideoOpenSwiperAutoplay())),onConfirm:a[3]||(a[3]=e=>{null==le||le.openTablePage(1)})},{content:x((()=>[T(t,{class:"ti-dialog-content"},{default:x((()=>[T(v,{class:"ti-buffet-scroll","scroll-y":""},{default:x((()=>[T(t,{class:"ti-buffet-message"},{default:x((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:x((()=>[E(M(h(P)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:x((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:x((()=>[E(M(h(P)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:x((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:x((()=>[E(M(h(P)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-message"},{default:x((()=>[T(t,{class:"ti-buffet-case"}),T(t,{class:"ti-buffet-text"},{default:x((()=>[E(M(h(P)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),T(t,{class:"ti-buffet-tips"},{default:x((()=>[E(M(h(P)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),T(Q,{show:ye.value,"onUpdate:show":a[4]||(a[4]=e=>ye.value=e),serverVersionNum:h(be),onBindSuccess:Ae},null,8,["show","serverVersionNum"]),T($,{show:_e.value,"onUpdate:show":a[5]||(a[5]=e=>_e.value=e)},null,8,["show"]),T(d,{class:"ti-action-order",show:he.value,content:h(P)("桌台已开启，可以开始点餐啦~"),onConfirm:a[6]||(a[6]=e=>(ke(),he.value=!1)),onCancel:a[7]||(a[7]=e=>he.value=!1)},{title:x((()=>[T(t,{class:"warning-header"},{default:x((()=>[T(t,{class:"warning-image-round"},{default:x((()=>[T(s,{class:"warning-image",src:R,mode:""})])),_:1}),T(t,{class:"warning-text"},{default:x((()=>[E(M(h(P)("开始点餐")),1)])),_:1})])),_:1})])),_:1},8,["show","content"])])),_:1})):C("",!0)}}},[["__scopeId","data-v-f1508ade"]]);export{Z as default};
