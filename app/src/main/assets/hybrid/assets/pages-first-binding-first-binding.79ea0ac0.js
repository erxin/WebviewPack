import{_ as a,R as e,d as l,b as s,s as o,r as t,T as n,w as i,k as u,j as c,U as d,J as r,K as g,n as v,p as A,q as f,y as p,m,E as w,z as _,C as h,D as b,V as B,W as y,X as x,Y as C,Z as U,a0 as k,a1 as T,a2 as S,a3 as I,a4 as E,a5 as j,a6 as G,a7 as L,a8 as Q,f as R,a9 as V,aa as O,x as Y,N as D,ab as X,ac as J,B as H,L as M,ad as z,$ as N,F as K,ae as F,G as Z,af as P,ag as q,ah as W}from"./index-5804117e.js";import{a as $,b as aa,c as ea,d as la,V as sa,_ as oa}from"./ti-layout-table-list.10135a73.js";import{_ as ta,a as na}from"./red-ring.9e6cdb3b.js";import{_ as ia}from"./ti-button.31ea88ae.js";const ua=a({__name:"ti-login",emits:["login","focus","blur","bindErr"],setup(a,{emit:X}){const J=e(),H=l(),M=s(),{baseInfo:z}=o(s()),N=X,K=t({user_name:"",password:"",code:"",device_id:"",brand:n()}),F=t(!0),Z=t(!1),P=t(!1),q=t(!1),W=t(!1),la=t(!1),sa=t(),oa=t(),na=t(),ua=()=>{K.value.user_name?K.value.password?K.value.code?ca():uni.showToast({title:w("请输入验证码"),icon:"none"}):uni.showToast({title:w("请输入密码"),icon:"none"}):uni.showToast({title:w("请输入账号/手机号"),icon:"none"})},ca=async()=>{var a;K.value.device_id=y();try{const e=await x(K.value,oa.value);C(e.data.app_id),U(K.value.device_id),k(e.data.token),T((null==(a=e.data)?void 0:a.real_name)||"user_name"),uni.showToast({title:e.msg,icon:"none"}),da()}catch(e){N("bindErr",e),ga()}},da=async()=>{var a;try{const e=await S();1==parseInt(e.data.cashier.order_method.is_table_order)?(I(e.data.shop_supplier_id),E(null==(a=e.data)?void 0:a.currency),null==M||M.setUserInfo(e.data),W.value=!0):uni.showToast({title:w("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(e){}},ra=async a=>{if(W.value=!1,a)try{const e=await j({table_id:a.table_id,key:K.value.device_id,brand:n()});G(a),L({title:w("加载中...")}),await(null==J?void 0:J.getCategoryList(!0)),await(null==H?void 0:H.getGoodsBaseList({category_id:0},!0)),Q(),R({url:"/pages/index/index"}),uni.showToast({title:e.msg,icon:"none"})}catch(e){}},ga=async()=>{var a,e,l;if(!la.value)try{la.value=!0;const s=await V({v:1});(null==(a=s.data)?void 0:a.sign)?(sa.value=null==(e=s.data)?void 0:e.base64,oa.value=null==(l=s.data)?void 0:l.sign):uni.showToast({title:w("验证码生成失败"),icon:"none"})}catch(s){}finally{la.value=!1,va()}},va=()=>{na.value&&clearTimeout(na.value),na.value=setTimeout((()=>{ga()}),178200)},Aa=a=>{F.value="username"===a,Z.value="password"===a,P.value="verifycode"===a,N("focus")},fa=()=>{N("blur")};return i((()=>[K.value.user_name,K.value.password,K.value.code]),(([a,e,l])=>{q.value=!!(a&&e&&l)})),u((()=>{})),c((()=>{if("function"==typeof window.config){let a=window.config().saasApiUrl;O()||(a=window.location.origin),a?(d(a),ga()):uni.showToast({title:"请配置config.js文件的saasApiUrl参数",icon:"error"})}})),(a,e)=>{const l=r(g("ti-input-d"),$),s=Y,o=r(g("ti-loading"),ta),t=r(g("uni-icons"),aa),n=D,i=r(g("ti-button"),ia),u=r(g("ti-layout-table-list"),ea);return v(),A(s,{class:"container"},{default:f((()=>[p(s,{class:"ti-item-input"},{default:f((()=>[p(l,{modelValue:K.value.user_name,"onUpdate:modelValue":e[0]||(e[0]=a=>K.value.user_name=a),prefixIcon:"icon-user",placeholder:m(w)("请输入账号/手机号"),focus:F.value,disabled:!1,popKeyboard:!0,onFocus:e[1]||(e[1]=a=>Aa("username")),onBlur:fa},null,8,["modelValue","placeholder","focus"])])),_:1}),p(s,{class:"ti-item-input"},{default:f((()=>[p(l,{modelValue:K.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>K.value.password=a),prefixIcon:"icon-lock",class:"ti-member-input",placeholder:m(w)("请输入密码 "),password:!0,disabled:!1,popKeyboard:!0,focus:Z.value,onFocus:e[3]||(e[3]=a=>Aa("password")),onBlur:fa},null,8,["modelValue","placeholder","focus"])])),_:1}),p(s,{class:"ti-item-input"},{default:f((()=>[p(s,{class:"ti-input-box"},{default:f((()=>[p(l,{modelValue:K.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>K.value.code=a),prefixIcon:"icon-shield-tick",placeholder:m(w)("请输入验证码"),focus:P.value,popKeyboard:!0,disabled:!1,onFocus:e[5]||(e[5]=a=>Aa("verifycode")),onBlur:fa,onConfirm:ua},null,8,["modelValue","placeholder","focus"]),p(s,{class:"ti-login-code",onClick:ga},{default:f((()=>[sa.value?(v(),_("img",{key:0,src:sa.value,alt:""},null,8,["src"])):la.value?(v(),A(o,{key:1})):(v(),A(s,{key:2,class:"ti-login-code-error"},{default:f((()=>[p(t,{"custom-prefix":"iconfont",type:"icon-shuaxin",size:"16",color:"#999"}),p(n,{style:{"margin-left":"5px"}},{default:f((()=>[h(b(m(w)("重新加载")),1)])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1}),p(s,null,{default:f((()=>[p(i,{class:B(["ti-login-btn",{islogin:q.value}]),onClick:ua},{default:f((()=>[h(b(m(w)("登录")),1)])),_:1},8,["class"])])),_:1}),p(u,{show:W.value,onConfirm:ra,onCancel:e[6]||(e[6]=a=>(W.value=!1,ga()))},null,8,["show"])])),_:1})}}},[["__scopeId","data-v-ab2908cc"]]),ca=""+new URL("binding-page-bg-image-db048039.png",import.meta.url).href,da=a({__name:"set-language",props:{firstBind:{type:Boolean,default:!1}},setup(a){const e=a,l=t(X[J()]),s=t(),o=a=>{s.value.isShow()?s.value.close():s.value.open()},n=()=>{l.value=X[J()]};return(a,t)=>{const i=r(g("ti-layout-language-item"),la),u=Y,c=M,d=D;return v(),A(u,{class:"ti-language",onClick:[o,t[0]||(t[0]=H((()=>{}),["stop"]))]},{default:f((()=>[p(u,{class:"ti-language-box"},{default:f((()=>[p(i,{ref_key:"refShowLanguage",ref:s,firstBind:e.firstBind,onLanguageText:n},null,8,["firstBind"])])),_:1}),p(c,{class:"ti-language-global",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIeSURBVHgB5VXdcdswDAYUKpXVPrAbeASNoExQZ4ImE7QbxB6hE9gb1BvYnSDaoN6gfOg5PsshA0CyJEbUnZK7vCTfnX9EfvgAkAAE8CGgP8c3ehL/1Wns6s+9nnz6OcY2GhRNL2ckWolY9x0Qpp3tjBa/CY84HMCLHOhU3QG43+BcoTVoQMx7JIRc9ogDDpYU0N0oB5U4zuUhORVwUBkMgfeYI3DzkBP0xBNKNYJlxYeteSiv+KjoODJwaMBZU1lFlJXTUOLalGWhJ2rTZmmvzf5xHQxIzjNRlDol/0Kwjdie7y2UQUWkc+XUH0/GlFBQxSwpm/zZJXOGO1rbmn15q9OLGVjKkI7LGDBdWtSJ/gd9NnCM/0GEG4jVrBbqi1eh8VpeP2RiQ7as0a0q1Rq4GyE2EaLpCA1h2nCxcZxTULy+8jLwxGXHGhgL1+NOGxl4Y7QO+NK6sNH4SsIetwg5WFBXblsjp4OOfew8rvBJA+HX+bG5ZHMoV/Szkh44/KeqqI0Q/pATGCpT+U8NBxcknHyhMjXDd9c2Gryi0SDYaMpjoaWoIq5nclaPijjOIHbUSG7ncSOc0ldh9se1jIojjYpIMr31JHuRpGpOy9XQuiy/SldzE4Vg3ZUMO27OSm5BDudeHM9tzP5EBLeQB29aBuBN27540EHjxFKqiJnMlm51ncHTlveQGxSvQ+KjIZefqvvmlcmvz2T4Lfa+8ARyhNbiDRkX2gAAAABJRU5ErkJggg=="}),p(d,{class:"ti-language-text"},{default:f((()=>[h(b(l.value),1)])),_:1}),p(c,{class:"ti-language-arrow-down",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACPSURBVHgB7Y9BCoUwDESH/w3EuskRPIpH8AZ6M72ZR9ClO60KQRGtYF0ofbRQmslMAgQC70TEHkb6SM8kEkPDfBMqcIFJpz02aF377dSMTt8DalfIXLc6/ehZ4JyIqdSJTjbZTL7oSlzFFXLL3BXixfwwxFDlzfwkxJ+5hph/LjE1i3nUCkcZnkAsCAS+xQhmhzo19D7FAAAAAABJRU5ErkJggg=="})])),_:1})}}},[["__scopeId","data-v-e2382d00"]]),ra=a({__name:"first-binding",setup(a){q((a=>({"57a96327":c.value})));const e=t(!1),l=t(""),s=t(""),o=t(),n=t(!1),i=z().deviceModel,c=t(""),d=t(0);let B=Date.now();const y=t(),x=a=>{0!=a.code?(-20==a.code||-201==a.code?(s.value=w("温馨提示"),o.value="../../static/red-ring.svg"):-21==a.code?(s.value=w("登录失败"),o.value="../../static/monitor-mobbile.svg"):(s.value=w("温馨提示"),o.value="../../static/red-ring.svg"),-20!=a.code&&-201!=a.code&&-21!=a.code||(e.value=!0,l.value=a.msg)):uni.showToast({title:a.msg,icon:"none"})},C=()=>{("PC"!=i||O())&&W({success:a=>{c.value="-"+a.screenHeight/2+"px"}})},U=()=>{c.value=""},k=()=>{const a=Date.now();a-B>1e3?d.value=1:d.value++,B=a,d.value>=6&&(new sa,d.value=0)};return N("authorization",(a=>{n.value=!a})),u((()=>{var a;y.value=null==(a=window.config())?void 0:a.title})),(a,t)=>{const i=M,u=Y,c=D,d=r(g("ti-login"),ua),B=r(g("ti-modal"),oa);return v(),_(K,null,[p(u,{class:"page",onClick:t[0]||(t[0]=a=>m(Z)())},{default:f((()=>[p(u,{class:"ti-page-bg"},{default:f((()=>[p(i,{class:"ti-bg-image",src:ca})])),_:1}),p(u,{class:"ti-flex"},{default:f((()=>[p(u,{class:"ti-flex-round"},{default:f((()=>[p(u,{class:"ti-round-box"},{default:f((()=>[p(u,{class:"ti-round-content"},{default:f((()=>[m(O)()?(v(),A(u,{key:0,class:"ti-item-logo",onClick:k},{default:f((()=>["jbc"==m(F)()?(v(),A(c,{key:0,class:"ti-platform"},{default:f((()=>[h("JBCレジ · "+b(m(w)("平板")),1)])),_:1})):"ttpos"==m(F)()?(v(),A(c,{key:1,class:"ti-platform"},{default:f((()=>[h("TTPOS · "+b(m(w)("平板")),1)])),_:1})):(v(),A(c,{key:2,class:"ti-platform"},{default:f((()=>[h("TTPOS · "+b(m(w)("平板")),1)])),_:1}))])),_:1})):(v(),A(u,{key:1,class:"ti-item-logo"},{default:f((()=>[p(u,{class:"ti-platform"},{default:f((()=>[h(b(y.value+" · "+m(w)("平板")),1)])),_:1})])),_:1})),p(d,{class:"m-top-32px",onFocus:C,onBlur:U,onBindErr:x})])),_:1})])),_:1})])),_:1})])),_:1}),p(u,{class:"ti-language-box"},{default:f((()=>[p(da,{firstBind:!0})])),_:1})])),_:1}),p(B,{class:"ti-action-tips",show:e.value,"onUpdate:show":t[1]||(t[1]=a=>e.value=a),isCancelShow:!1,isConfirmShow:!0,content:l.value,onConfirm:t[2]||(t[2]=a=>e.value=!1),confirmType:"danger"},{title:f((()=>[p(u,{class:"warning-header"},{default:f((()=>[p(u,{class:"warning-image-round"},{default:f((()=>[p(i,{class:"warning-image",src:o.value,mode:""},null,8,["src"])])),_:1}),p(u,{class:"warning-text yx-text-bold"},{default:f((()=>[h(b(s.value),1)])),_:1})])),_:1})])),default:f((()=>[P("template",null,[p(u)])])),_:1},8,["show","content"]),p(B,{class:"ti-action-tips",show:n.value,title:m(w)("店鋪到期"),isCancelShow:!1,onConfirm:t[3]||(t[3]=a=>n.value=!1),isConfirmShow:!0,content:m(w)("店鋪狀態已到期，如需使用，請聯繫銷售代表"),confirmType:"danger"},{title:f((()=>[p(u,{class:"warning-header"},{default:f((()=>[p(u,{class:"warning-image-round"},{default:f((()=>[p(i,{class:"warning-image",src:na,mode:""})])),_:1}),p(u,{class:"warning-text"},{default:f((()=>[h(b(m(w)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-955957ad"]]);export{ra as default};
