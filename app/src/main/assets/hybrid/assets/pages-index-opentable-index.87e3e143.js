import{h as e,j as t,w as l,q as a,F as s,t as i,a4 as u,k as o,a5 as n,n as c,r,a6 as d,a7 as v,e as _,a8 as f,R as p,S as m,p as h,f as b,a9 as g,aa as y,Y as w,ab as k,v as x,x as C,a0 as T,X as A,s as I,ac as S,ad as O,ae as L,y as P,af as N,ag as U,ah as D,ai as R,K,aj as B,ak as E,T as j,a1 as $,$ as F,al as M,am as z,an as W,ao as q,ap as G,aq as Q,ar as Y,o as H,g as J,d as V,l as X,m as Z,as as ee,I as te,H as le,at as ae,z as se,A as ie,B as ue,C as oe,D as ne,E as ce,G as re,J as de,P as ve,c as _e,L as fe,M as pe,N as me}from"./index-0552372c.js";import{i as he,a as be,r as ge,b as ye,c as we,u as ke,d as xe,e as Ce,f as Te,D as Ae,v as Ie,_ as Se}from"./verify.c871bc96.js";import{c as Oe,e as Le,f as Pe,i as Ne,g as Ue,_ as De,a as Re,b as Ke}from"./platform.6d09b8ff.js";import{_ as Be,a as Ee}from"./ti-button.e1f1dded.js";import"./components-ti-keyboard-ti-keyboard.004b8d6f.js";var je=/\s/;var $e=/^\s+/;function Fe(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&je.test(e.charAt(t)););return t}(e)+1).replace($e,""):e}var Me=NaN,ze=/^[-+]0x[0-9a-f]+$/i,We=/^0b[01]+$/i,qe=/^0o[0-7]+$/i,Ge=parseInt;function Qe(e){if("number"==typeof e)return e;if(he(e))return Me;if(be(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=be(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Fe(e);var l=We.test(e);return l||qe.test(e)?Ge(e.slice(2),l?2:8):ze.test(e)?Me:+e}const Ye=function(){return ge.Date.now()};var He=Math.max,Je=Math.min;function Ve(e,t,l){var a,s,i,u,o,n,c=0,r=!1,d=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var l=a,i=s;return a=s=void 0,c=t,u=e.apply(i,l)}function f(e){var l=e-n;return void 0===n||l>=t||l<0||d&&e-c>=i}function p(){var e=Ye();if(f(e))return m(e);o=setTimeout(p,function(e){var l=t-(e-n);return d?Je(l,i-(e-c)):l}(e))}function m(e){return o=void 0,v&&a?_(e):(a=s=void 0,u)}function h(){var e=Ye(),l=f(e);if(a=arguments,s=this,n=e,l){if(void 0===o)return function(e){return c=e,o=setTimeout(p,t),r?_(e):u}(n);if(d)return clearTimeout(o),o=setTimeout(p,t),_(n)}return void 0===o&&(o=setTimeout(p,t)),u}return t=Qe(t)||0,be(l)&&(r=!!l.leading,i=(d="maxWait"in l)?He(Qe(l.maxWait)||0,t):i,v="trailing"in l?!!l.trailing:v),h.cancel=function(){void 0!==o&&clearTimeout(o),c=0,a=n=s=o=void 0},h.flush=function(){return void 0===o?u:m(Ye())},h}const Xe=Be(ye,[["render",function(r,d,v,_,f,p){const m=c;return e(),t(m,{class:"l-ball-wrapper",ref:"l-ball-wrapper"},{default:l((()=>[(e(!0),a(s,null,i(r.balls,(l=>(e(),a(s,{key:l.time},[l.done?o("",!0):(e(),t(m,{key:0,class:"l-ball",ref_for:!0,ref:l.ref,style:u(l.style),animation:l.data},null,8,["style","animation"]))],64)))),128)),n(r.$slots,"default",{active:r.active},void 0,!0)])),_:3},512)}],["__scopeId","data-v-b3f08bc3"]]),Ze=""+new URL("orange-occupy-bitmap-0d6d0ba4.svg",import.meta.url).href,et=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,tt=""+new URL("icon-lock-bd74ef9c.svg",import.meta.url).href,lt=Be({__name:"ti-category",props:{scrollLeft:{type:Number,default:0},scrollInterval:{type:Number,default:200},threshold:{type:Number,default:5}},setup(a,{expose:s}){const i=a,u=r(0),k=r(!1),x=r(!1),C=r(0),T=r(0),A=r(`ti-${d(16)}`);v((()=>i.scrollLeft),(()=>{u.value=i.scrollLeft}));const I=Ve((e=>{u.value=e.detail.scrollLeft,k.value=i.threshold<e.detail.scrollLeft,x.value=T.value+e.detail.scrollLeft<e.detail.scrollWidth-i.threshold}),300),S=()=>{k.value=!1},O=()=>{x.value=!1},L=e=>{let t=0;"left"==e?t=u.value-i.scrollInterval:"right"==e&&(t=u.value+i.scrollInterval);const l=C.value-T.value;u.value=Math.min(l,Math.max(t,0))},P=()=>{g((()=>{u.value=0;y().in(this).select(`#${A.value}`).fields({size:!0,scrollOffset:!0},(e=>{T.value=(null==e?void 0:e.width)||0,C.value=(null==e?void 0:e.scrollWidth)||0,C.value>T.value?x.value=!0:(k.value=!1,x.value=!1)})).exec()}))};return _((()=>{P(),window.addEventListener("resize",P)})),f((()=>{window.removeEventListener("resize",P)})),s({getScrollWidth:P}),(a,s)=>{const r=p(m("uni-icons"),we),d=c,v=w;return e(),t(d,{class:"ti-category-box"},{default:l((()=>[k.value?(e(),t(d,{key:0,class:"ti-category-left",onClick:s[0]||(s[0]=e=>L("left"))},{default:l((()=>[h(d,{class:"ti-category-btn"},{default:l((()=>[h(r,{type:"left",size:"14",color:"#100A05"})])),_:1})])),_:1})):o("",!0),h(v,{id:A.value,class:"ti-category","scroll-left":u.value,"scroll-x":"","enable-flex":"","scroll-with-animation":"","upper-threshold":i.threshold,"lower-threshold":i.threshold,onScrolltoupper:S,onScrolltolower:O,onScroll:b(I)},{default:l((()=>[n(a.$slots,"default",{},void 0,!0)])),_:3},8,["id","scroll-left","upper-threshold","lower-threshold","onScroll"]),x.value?(e(),t(d,{key:1,class:"ti-category-right",onClick:s[1]||(s[1]=e=>L("right"))},{default:l((()=>[h(d,{class:"ti-category-btn"},{default:l((()=>[h(r,{type:"right",size:"14",color:"#100A05"})])),_:1})])),_:1})):o("",!0)])),_:3})}}},[["__scopeId","data-v-50a73735"]]),at=Be({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null},defaultIndex:{type:Number,default:0}},emits:["update:menuId"],setup(u,{emit:n}){const d=n,_=u,f=r(0),w=r(_.defaultIndex),I=r([]),S=r();v((()=>_.list),(async e=>{var t;if(!e||0==e.length)return;await g();const l=y().in(this);e.map(((e,t)=>{l.select(`#scroll-item-${t}`).boundingClientRect((e=>{if(!e)return;const l=I.value;l[t]=e.width+10,I.value=l})).exec()})),O(w.value),null==(t=S.value)||t.getScrollWidth()}),{deep:!0,immediate:!0});const O=e=>{w.value=e,f.value=I.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(I.value[e]+100),d("update:menuId",_.list[e].category_id)};return(u,n)=>{const r=A,d=c,v=p(m("ti-category"),lt);return e(),t(d,{class:"ti-dish-menu"},{default:l((()=>[_.list&&_.list.length>0?(e(),t(v,{key:0,ref_key:"scrollRef",ref:S,scrollLeft:f.value},{default:l((()=>[h(d,{class:"ti-menu-content"},{default:l((()=>[(e(!0),a(s,null,i(_.list,((a,s)=>(e(),t(d,{key:s,class:k(["ti-menu-item",{active:s==w.value}]),id:`scroll-item-${s}`,onClick:e=>O(s)},{default:l((()=>[h(r,{class:"ti-menu-title"},{default:l((()=>[x(C(a.name[b(T)()]||a.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scrollLeft"])):o("",!0)])),_:1})}}},[["__scopeId","data-v-9834aebd"]]),st=Be({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId","update:isSpecial"],setup(u,{emit:n}){const d=ke(),{categoryList:_}=I(d),f=n,g=r(),y=r(0),w=r(0),A=S((()=>{let e=(_.value.find((e=>e.category_id==y.value))||{}).child||[];return e&&e.length>0&&(e=[xe].concat(e)),e})),O=S((()=>_.value.find((e=>e.category_id==y.value)))),L=S((()=>A.value.find((e=>e.category_id==w.value))));v((()=>y.value),(()=>{var e,t;f("update:isSpecial",null==(e=O.value)?void 0:e.is_special),f("update:categoryId",y.value),A.value&&A.value.length>0&&(w.value=A.value[0].category_id,P(w.value)),null==(t=g.value)||t.getScrollWidth()}));const P=e=>{var t;w.value=e,f("update:isSpecial",null==(t=L.value)?void 0:t.is_special),f("update:categoryId",w.value>0?w.value:y.value)};return(u,n)=>{const r=c,d=p(m("ti-category"),lt);return e(),t(r,{class:"ti-category-box"},{default:l((()=>[h(at,{list:b(_),menuId:y.value,"onUpdate:menuId":n[0]||(n[0]=e=>y.value=e)},null,8,["list","menuId"]),A.value&&A.value.length>0?(e(),t(r,{key:0,class:"ti-dish-secondary"},{default:l((()=>[h(d,{ref_key:"categoryRef",ref:g},{default:l((()=>[h(r,{class:"ti-secondary-box"},{default:l((()=>[(e(!0),a(s,null,i(A.value,((a,s)=>(e(),t(r,{key:s,class:k([{active:a.category_id==w.value},"ti-secondary-item"]),onClick:e=>P(a.category_id)},{default:l((()=>[x(C(a.name[b(T)()]||a.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},512)])),_:1})):o("",!0)])),_:1})}}},[["__scopeId","data-v-c5968335"]]);function it(e){return O("order.Order/add",e,{isLoading:!1})}function ut(e,t){return O("order.Order/getUnSendKitchen",e,{isLoading:t})}function ot(e){return O("order.Order/sendKitchen",e,{isLoading:!0,isMessage:!1})}const nt=Be({__name:"goods-detail",props:{show:{type:Boolean,default:!1},goodsDetail:{type:Object,default:()=>({})}},emits:["update:show","success","cancel"],setup(u,{emit:n}){const d=n,_=u,f=r({});r(!1);const g=r(!1),y=r({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed_ids:[],bag_price:0,delivery:L()?30:40,describe:null,is_buffet:1});v((()=>_.show),(()=>{_.show&&w()}));const w=async()=>{var e,t,l,a,s,i,u,o,n;f.value=_.goodsDetail,y.value.product_id=null==(e=f.value)?void 0:e.product_id,y.value.price=null==(t=f.value)?void 0:t.product_price,y.value.product_price=null==(l=f.value)?void 0:l.product_price,y.value.is_buffet=null==(a=f.value)?void 0:a.is_buffet,(null==(s=f.value)?void 0:s.sku.length)>0&&(null==(i=f.value)||i.sku.some((e=>{if(e.stock_num>0)return y.value.product_sku_id=e.product_sku_id,!0}))),(null==(u=f.value)?void 0:u.product_attr.length)>0&&(null==(o=f.value)||o.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?y.value.attr[t]=0:y.value.attr[t]=null}))),(null==(n=y.value)?void 0:n.feed_ids.length)>0&&(y.value.feed_ids=[])},I=(e,t)=>y.value.attr[e]==t;return(u,n)=>{const r=j,v=c,w=A,S=p(m("ti-modal"),Oe);return e(),t(S,{show:_.show,title:b(P)("商品詳情"),cancelText:b(P)("取消"),confirmText:b(P)("確定"),confirmLoading:g.value,onCancel:n[0]||(n[0]=e=>d("cancel")),onConfirm:n[1]||(n[1]=e=>(async()=>{var e,t,l;const a={x:event.clientX,y:event.clientY};if(g.value)return;const s={...y.value};s.attr=s.attr.join(",");let i=[];if(y.value.product_sku_id&&(null==(e=f.value)?void 0:e.sku)&&(null==(t=f.value)?void 0:t.sku.length)>0){const e=null==(l=f.value)?void 0:l.sku.find((e=>e.product_sku_id==y.value.product_sku_id));s.price=(null==e?void 0:e.product_price)||0,i.push(null==e?void 0:e.spec_name)}y.value.attr&&y.value.attr.length>0&&y.value.attr.map(((e,t)=>{var l;const a=null==(l=f.value)?void 0:l.product_attr[t];(null==a?void 0:a.attribute_value)&&a.attribute_value[e]&&i.push(a.attribute_value[e])})),y.value.feed_ids&&y.value.feed_ids.length>0&&y.value.feed_ids.map((e=>{var t;const l=((null==(t=f.value)?void 0:t.feed)||[]).find((t=>t.product_feed_id==e));i.push(null==l?void 0:l.feed_name),s.price=D(s.price,null==l?void 0:l.price)})),s.describe=i.join(";"),s.delivery=L()?30:40,s.order_id=R(),s.table_id=K();try{g.value=!0;const e=await it(s);1==e.code&&(B(e.data.order_id),uni.showToast({title:e.msg,icon:"none"}),d("cancel",!1),setTimeout((()=>{d("success",a)}),100))}catch(u){-32==u.code&&E("quota",u.data.value)}finally{g.value=!1}})())},{content:l((()=>[h(v,{class:"ti-dialog-content"},{default:l((()=>[h(v,{class:"ti-detail-box"},{default:l((()=>[h(v,{class:"ti-detail-image"},{default:l((()=>{var l,a,s,i;return[(null==(l=f.value)?void 0:l.image)&&(null==(a=f.value)?void 0:a.image[0])&&(null==(s=f.value)?void 0:s.image[0].file_path)?(e(),t(r,{key:0,src:null==(i=f.value)?void 0:i.image[0].file_path,mode:"widthFix"},null,8,["src"])):(e(),t(r,{key:1,src:Ze,mode:"widthFix"}))]})),_:1}),h(v,{class:"ti-detail-con"},{default:l((()=>[h(v,{class:"ti-detail-title text-ellipsis"},{default:l((()=>{var e,t;return[x(C((null==(e=f.value)?void 0:e.product_name[b(T)()])||(null==(t=f.value)?void 0:t.product_name_text)),1)]})),_:1}),h(v,{class:"ti-price-box"},{default:l((()=>[h(w,{class:"ti-detail-unit"},{default:l((()=>[x(C(b(P)("單價：")),1)])),_:1}),h(w,{class:"ti-detail-price"},{default:l((()=>{var e;return[x(C(b(N)((null==(e=f.value)?void 0:e.product_price)||0)),1)]})),_:1}),h(w,{class:"ti-detail-subPrice"},{default:l((()=>{var e;return[x(C(b(U)((null==(e=f.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),h(v,{class:"ti-price-box"},{default:l((()=>[h(w,{class:"ti-detail-unit"},{default:l((()=>[x(C(b(P)("單位：")),1)])),_:1}),h(w,{class:"ti-detail-price"},{default:l((()=>{var e,t;return[x(C((null==(e=f.value)?void 0:e.product_unit[b(T)()])||(null==(t=f.value)?void 0:t.product_unit_text)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),h(v,{class:"ti-detail-specs"},{default:l((()=>[h(v,{class:"ti-specs-box"},{default:l((()=>{var u,n,c,r,d,_;return[(null==(u=f.value)?void 0:u.sku)&&(null==(n=f.value)?void 0:n.sku.length)>0?(e(),t(v,{key:0,class:"ti-specs-item"},{default:l((()=>[h(v,{class:"ti-specs-title"},{default:l((()=>[x(C(b(P)("規格")),1)])),_:1}),h(v,{class:"ti-specs-child"},{default:l((()=>{var u;return[(e(!0),a(s,null,i(null==(u=f.value)?void 0:u.sku,(a=>(e(),t(v,{key:a.product_sku_id,class:k([{active:a.product_sku_id==y.value.product_sku_id,disabled:a.stock_num<=0},"ti-child-item"]),onClick:e=>(e=>{e.stock_num<=0||y.value.product_sku_id!=e.product_sku_id&&(y.value.product_sku_id=e.product_sku_id)})(a)},{default:l((()=>[h(w,{class:"ti-child-name"},{default:l((()=>[x(C(a.spec_name_i18n[b(T)()]||a.spec_name_text),1)])),_:2},1024),h(w,{class:"ti-child-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.product_price)||0)),1)])),_:2},1024),h(w,{class:"ti-child-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):o("",!0),(null==(c=f.value)?void 0:c.product_attr)&&(null==(r=f.value)?void 0:r.product_attr.length)>0?(e(),t(v,{key:1},{default:l((()=>{var u;return[(e(!0),a(s,null,i(null==(u=f.value)?void 0:u.product_attr,((u,o)=>(e(),t(v,{key:o,class:"ti-specs-item"},{default:l((()=>[h(v,{class:"ti-specs-title"},{default:l((()=>[x(C(u.attribute_name_i18n[b(T)()]||u.attribute_name_text),1)])),_:2},1024),h(v,{class:"ti-specs-child"},{default:l((()=>[(e(!0),a(s,null,i(null==u?void 0:u.attribute_value_i18n,((a,s)=>(e(),t(v,{key:s,class:k([{active:I(o,s)},"ti-child-item"]),onClick:e=>((e,t)=>{y.value.attr[e]=t})(o,s)},{default:l((()=>[h(w,{class:"ti-child-name"},{default:l((()=>[x(C(a[b(T)()]||(null==u?void 0:u.attribute_value_text[s])),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:1})):o("",!0),(null==(d=f.value)?void 0:d.feed)&&(null==(_=f.value)?void 0:_.feed.length)>0?(e(),t(v,{key:2,class:"ti-specs-item"},{default:l((()=>[h(v,{class:"ti-specs-title"},{default:l((()=>[x(C(b(P)("加料")),1)])),_:1}),h(v,{class:"ti-specs-child"},{default:l((()=>{var u;return[(e(!0),a(s,null,i(null==(u=f.value)?void 0:u.feed,(a=>(e(),t(v,{key:a.product_feed_id,class:k([{active:(y.value.feed_ids||[]).indexOf(a.product_feed_id)>-1,disabled:a.stock_num<=0},"ti-child-item"]),onClick:e=>(e=>{if(e.stock_num<=0)return;const t=y.value.feed_ids.indexOf(e.product_feed_id);t>=0?y.value.feed_ids.splice(t,1):y.value.feed_ids.push(e.product_feed_id)})(a)},{default:l((()=>[h(w,{class:"ti-child-name"},{default:l((()=>[x(C(a.feed_name_i18n[b(T)()]||a.feed_name_text),1)])),_:2},1024),h(w,{class:"ti-child-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.price)||0)),1)])),_:2},1024),h(w,{class:"ti-child-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):o("",!0)]})),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText","confirmLoading"])}}},[["__scopeId","data-v-79e685f2"]]),ct=Be({__name:"dish-car-order-nav",emits:["car","confirm"],setup(a,{expose:s,emit:i}){const u=i,n=()=>{u("car")},d=()=>{u("confirm")},v=r(),_=r(!1),f=async()=>{var e;try{const t=await ut({table_id:K()},!1);v.value=(null==(e=t.data)?void 0:e.detail)||{},v.value.unSendKitchenProductTotalNum>0?_.value=!0:_.value=!1}catch(t){}};return f(),s({getCarData:f}),(a,s)=>{const i=j,u=A,r=c;return e(),t(r,{class:"ti-car-order"},{default:l((()=>[h(r,{class:"ti-order-total",onClick:n},{default:l((()=>[h(i,{class:"ti-total-image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE9SURBVHgB7ZjxrcIgEMY/Xt4AbvAYwRHc4DmKbuAG6gR1A92g3UA3sE6gTnAesZqG1gLKSf/oL7nQwKV8Be6AAj1DPR6IaMTF6NmgVIlUGDFsR2qSVUJ7I8iQIwWVKF2zWU3UBH2AhexJhtx8dFufPw5NF8gwYTu2jbxLkIYsmV3hEiQdYdoepdSCGn38OpzXbP+Qo2Q7YCAA9aqhyhNbyK6jHe+Zcy9PFrQgec52v11R9o0IayTe1IJKu6JL0B8S4EqM0lztii5BGvIELWoNeU52ReopC4qyAvL472PmWECyZAiF5LJ1Ti9uM8pDlMb9yKnxOWbNHHj/KjDwJs4pq8PTN+VizFb4DHuofxD88qW1MGcx/UPFjFsi5RzLv84nmTr0eBL3OEPNnxGrmP7vCDKXuk2V1Bax/Qd8uQE+N6CHpHz4IAAAAABJRU5ErkJggg=="}),h(u,{class:"ti-total-price"},{default:l((()=>{var e;return[x(C(b(N)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),h(u,{class:"ti-total-subPrice"},{default:l((()=>{var e;return[x(C(b(U)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1}),_.value?(e(),t(r,{key:0,class:"ti-total-badge-box"},{default:l((()=>[h(u,{class:"ti-total-badge"},{default:l((()=>{var e;return[x(C(null==(e=v.value)?void 0:e.unSendKitchenProductTotalNum),1)]})),_:1})])),_:1})):o("",!0),h(r,{class:"ti-order-btn",onClick:d},{default:l((()=>[h(u,{class:"ti-btn-text"},{default:l((()=>[x(C(a.$t("下單")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-92b25286"]]),rt=Be({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})},isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["change"],setup(a,{emit:s}){const i=a,u=s,o=r(!1),n=async e=>{var t,l,a,s;if(i.isOrderOverTime&&1==(null==(t=i.productItem)?void 0:t.is_buffet_product)&&"up"==e&&1!=i.isOverTime)return void E("buffet_remain",P("點餐時間已到，無法繼續下單"));if(0==i.buyContinue&&1==i.isOverTime&&"up"==e)return void E("buffet_remain",P("用餐時間已到，無法繼續下單"));if(1==i.isOverTime&&1==(null==(l=i.productItem)?void 0:l.is_buffet_product)&&"up"==e)return void E("buffet_remain",P("自助餐时间已到达，自助餐商品不可继续下单"));const n={order_product_id:null==(a=i.productItem)?void 0:a.order_product_id,product_num:null==(s=i.productItem)?void 0:s.total_num,type:e};"up"==e?n.product_num+=1:n.product_num-=1;try{o.value=!0;const e=await function(e){return O("order.Order/sub",e)}(n);1==e.code&&u("change")}catch(c){-32==c.code&&E("quota",c.data.value)}finally{o.value=!1}};return(s,i)=>{const u=c;return e(),t(u,{class:"ti-number-box",onClick:i[2]||(i[2]=$((()=>{}),["stop"]))},{default:l((()=>[h(u,{class:"ti-number-btn ti-number-minus",disabled:!1,onClick:i[0]||(i[0]=e=>n("down"))},{default:l((()=>[h(u,{class:"ti-number-minus-reduce"})])),_:1}),h(u,{class:"ti-number-input"},{default:l((()=>[x(C(a.productItem.total_num),1)])),_:1}),h(u,{class:"ti-number-btn ti-number-plus",disabled:!1,onClick:i[1]||(i[1]=e=>n("up"))},{default:l((()=>[h(u,{class:"ti-number-plus-add"}),h(u,{class:"ti-number-plus-add2"})])),_:1})])),_:1})}}},[["__scopeId","data-v-5c59d502"]]),dt=Be({__name:"dish-car-ordering-list",props:{isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["success","change","sendkitchenFail","close"],setup(u,{emit:n}){const d=u,v=r(!1),_=n,f=r(),g=r(),y=r({table_id:""}),k=async e=>{var t;y.table_id=K();try{const e=await ut(y,!1);f.value=e.data.detail,g.value=(null==(t=e.data.detail)?void 0:t.unSendKitchenProduct)||[],_("change")}catch(l){}},T=async e=>{try{v.value=!0;const e=await ot({table_id:K()});uni.showToast({title:P(e.msg),icon:"none"}),setTimeout((()=>{_("success")}),500)}catch(t){_("sendkitchenFail",t)}finally{v.value=!1}};return k(),F("handleDelProuct",(e=>{k()})),(u,n)=>{const r=c,v=A,y=w,I=p(m("ti-button"),Ee),S=p(m("ti-empty-data"),Le);return e(),t(r,{class:"ti-shop-list-box"},{default:l((()=>{var u,c;return[(null==(u=g.value)?void 0:u.length)>0?(e(),t(r,{key:0,class:"ti-shop-list"},{default:l((()=>[h(r,null,{default:l((()=>[h(r,{class:"ti-cart-shop-head"},{default:l((()=>[h(r,{class:"ti-shop-head-title"},{default:l((()=>[x(C(b(P)("商品名稱")),1)])),_:1}),h(r,{class:"ti-shop-head-money yx-shop-head-price"},{default:l((()=>[x(C(b(P)("單價")),1)])),_:1}),h(r,{class:"ti-shop-head-num"},{default:l((()=>[x(C(b(P)("數量")),1)])),_:1}),h(r,{class:"ti-shop-head-money"},{default:l((()=>[x(C(b(P)("小計")),1)])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-scroll-box"},{default:l((()=>[h(y,{class:"ti-shop-scroll","scroll-y":""},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[(e(!0),a(s,null,i(g.value,((a,s)=>(e(),t(r,{class:"ti-shop-item",key:a},{default:l((()=>[h(r,{class:"ti-shop-item-box"},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[h(r,{class:"ti-shop-body-top"},{default:l((()=>[h(r,{class:"ti-shop-title text-ellipsis"},{default:l((()=>[x(C(a.product_name_text),1)])),_:2},1024),h(r,{class:"ti-shop-spec"},{default:l((()=>[x(C(a.product_attr),1)])),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-money yx-shop-body-pirce"},{default:l((()=>[h(v,{class:"ti-shop-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.product_price)||0)),1)])),_:2},1024),h(v,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.product_price)||0)),1)])),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-number"},{default:l((()=>[h(rt,{buyContinue:d.buyContinue,isOverTime:d.isOverTime,isOrderOverTime:d.isOrderOverTime,productItem:a,onChange:n[0]||(n[0]=e=>k())},null,8,["buyContinue","isOverTime","isOrderOverTime","productItem"])])),_:2},1024),h(r,{class:"ti-shop-body-money"},{default:l((()=>[h(v,{class:"ti-shop-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.total_product_price)||0)),1)])),_:2},1024),h(v,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.total_product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-content-bottom"},{default:l((()=>[h(r,{class:"ti-car-shop-bottom"},{default:l((()=>[h(r,{class:"ti-shop-bottom-item"},{default:l((()=>[h(r,null,{default:l((()=>[h(v,{class:"ti-shop-bottom-text"},{default:l((()=>{var e;return[x(C(b(P)("共")+((null==(e=f.value)?void 0:e.unSendKitchenProductTotalNum)||0)+b(P)("件")),1)]})),_:1})])),_:1}),h(r,null,{default:l((()=>[h(v,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(b(P)("商品金額：")),1)])),_:1}),h(v,{class:"ti-shop-bottom-price"},{default:l((()=>{var e;return[x(C(b(N)((null==(e=f.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),h(v,{class:"ti-shop-bottom-subPrice"},{default:l((()=>{var e;return[x(C(b(U)((null==(e=f.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),h(r,{class:"bottom-button"},{default:l((()=>[h(I,{title:b(P)("退出"),onClick:n[1]||(n[1]=e=>_("close")),class:"close-button"},null,8,["title"]),h(I,{title:b(P)("確認下單"),type:"primary",onClick:T},null,8,["title"])])),_:1})])),_:1})])),_:1})):o("",!0),(null==(c=g.value)?void 0:c.length)<=0?(e(),t(r,{key:1,class:"ti-empty-data-box"},{default:l((()=>[h(S,{title:b(P)("當前無待下單商品")},null,8,["title"]),h(I,{title:b(P)("退出"),onClick:n[2]||(n[2]=e=>_("close"))},null,8,["title"])])),_:1})):o("",!0)]})),_:1})}}},[["__scopeId","data-v-a2d7f33b"]]),vt=Be({__name:"dish-car-ordered-list",emits:["close"],setup(u,{emit:n}){const d=r([]),v=r(""),_=r();let f=0;const g=n;(async()=>{try{const t=await(e={table_id:K()},O("order.Order/getSendKitchen",e));d.value=t.data.list||[],v.value=t.data.total_price,t.data.list.forEach((e=>{f+=e.plist.length})),_.value=f}catch(t){}var e})();return(u,n)=>{const r=c,f=A,y=w,k=p(m("ti-button"),Ee),T=p(m("ti-empty-data"),Le);return e(),t(r,{class:"ti-shop-list-box"},{default:l((()=>[Object.keys(d.value).length>0?(e(),t(r,{key:0,class:"ti-shop-list"},{default:l((()=>[h(r,{class:"ti-scroll-box"},{default:l((()=>[h(y,{class:"ti-shop-scroll","scroll-y":""},{default:l((()=>[(e(!0),a(s,null,i(d.value,((u,n)=>(e(),t(r,{class:"ti-shop-item",key:n},{default:l((()=>[h(r,{class:"ti-shop-time-top"}),h(r,{class:"ti-shop-time-box"},{default:l((()=>[x(C(u.date+" "+b(P)("下單")),1)])),_:2},1024),(e(!0),a(s,null,i(u.plist,((a,s)=>(e(),t(r,{key:s},{default:l((()=>[h(r,{class:"ti-shop-item-box"},{default:l((()=>[h(r,{class:"ti-shop-box"},{default:l((()=>[h(r,{class:"ti-shop-body-top"},{default:l((()=>[h(r,{class:"ti-shop-title text-ellipsis"},{default:l((()=>[x(C(a.product_name_text||a.name_text||a.buffet_name_text),1)])),_:2},1024),a.product_attr||a.customer_type_name_text?(e(),t(r,{key:0,class:"ti-shop-spec"},{default:l((()=>[x("("+C(a.product_attr||a.customer_type_name_text)+")",1)])),_:2},1024)):o("",!0)])),_:2},1024),h(r,{class:"ti-shop-body-money yx-shop-body-pirce"},{default:l((()=>[h(f,{class:"ti-shop-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.product_price)||(null==a?void 0:a.price)||0)),1)])),_:2},1024),h(f,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.product_price)||(null==a?void 0:a.price)||0)),1)])),_:2},1024)])),_:2},1024),h(r,{class:"ti-shop-body-state"},{default:l((()=>[null!=a.finish_num?(e(),t(r,{key:0,class:"ti-state-left"},{default:l((()=>[x(C(null!=a.finish_num?a.finish_num:a.num),1)])),_:2},1024)):o("",!0),null!=a.finish_num?(e(),t(r,{key:1,class:"ti-state-line"},{default:l((()=>[x("/")])),_:1})):o("",!0),h(r,{class:"ti-state-right"},{default:l((()=>[x(C(a.total_num||a.num),1)])),_:2},1024),null!=a.finish_num?(e(),t(r,{key:2,class:"ti-state-text"},{default:l((()=>{return[x(C((e=null!=a.finish_num?a.kitchen_status:a.is_comb,P(0===e?"製作中":1===e?"已完成":"未知"))),1)];var e})),_:2},1024)):o("",!0)])),_:2},1024),h(r,{class:"ti-shop-body-money"},{default:l((()=>[h(f,{class:"ti-shop-price"},{default:l((()=>[x(C(b(N)((null==a?void 0:a.total_product_price)||(null==a?void 0:a.total_price)||0)),1)])),_:2},1024),h(f,{class:"ti-shop-subPrice"},{default:l((()=>[x(C(b(U)((null==a?void 0:a.total_product_price)||(null==a?void 0:a.total_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),s!=u.length-1?(e(),t(r,{key:0,class:"ti-shop-item-box-bottom-border"})):o("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})])),_:1}),h(r,{class:"ti-content-bottom"},{default:l((()=>[h(r,{class:"ti-car-shop-bottom"},{default:l((()=>[h(r,{class:"ti-shop-bottom-item"},{default:l((()=>[h(r,null,{default:l((()=>[h(f,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(b(P)("共")+(_.value||0)+b(P)("件")),1)])),_:1})])),_:1}),h(r,null,{default:l((()=>[h(f,{class:"ti-shop-bottom-text"},{default:l((()=>[x(C(b(P)("商品金額：")),1)])),_:1}),h(f,{class:"ti-shop-bottom-price"},{default:l((()=>[x(C(b(N)(v.value||0)),1)])),_:1}),h(f,{class:"ti-shop-bottom-subPrice"},{default:l((()=>[x(C(b(U)(v.value||0)),1)])),_:1})])),_:1})])),_:1})])),_:1}),h(k,{title:b(P)("退出"),onClick:n[0]||(n[0]=e=>g("close")),style:{}},null,8,["title"])])),_:1})])),_:1})):o("",!0),Object.keys(d.value).length<=0?(e(),t(r,{key:1,class:"ti-empty-data-box"},{default:l((()=>[h(T,{title:b(P)("當前無已下單商品")},null,8,["title"]),h(k,{title:b(P)("退出"),onClick:n[1]||(n[1]=e=>g("close"))},null,8,["title"])])),_:1})):o("",!0)])),_:1})}}},[["__scopeId","data-v-60e32d8d"]]),_t=Be({__name:"goods-not-enough",props:{show:{type:Boolean,default:!1},productList:{type:Array,default:[]}},emits:["update:show","confirm"],setup(u,{emit:o}){const n=o,r=u,d=()=>{n("confirm")};return(o,v)=>{const _=A,f=c,b=w,g=p(m("ti-modal"),Oe);return e(),t(g,{class:"ti-action-tip",show:r.show,isCancelShow:!1,title:o.$t("温馨提示"),confirmText:o.$t("確定"),onCancel:v[0]||(v[0]=e=>n("update:show",!1)),onConfirm:d},{content:l((()=>[h(f,{class:"ti-dialog-content"},{default:l((()=>[h(f,{class:"ti-detail-box"},{default:l((()=>[h(_,{class:"ti-detail-des"},{default:l((()=>[x(C(o.$t("商品庫存不足，請重新選擇")),1)])),_:1})])),_:1}),h(f,{class:"ti-detail-specs"},{default:l((()=>[h(b,{"scroll-y":""},{default:l((()=>[(e(!0),a(s,null,i(u.productList,((a,s)=>(e(),t(f,{class:"ti-specs-box"},{default:l((()=>[h(f,{class:"ti-specs-item"},{default:l((()=>[h(f,{class:"ti-specs-title"},{default:l((()=>[x(C(a.product_name_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmText"])}}},[["__scopeId","data-v-a9bc6e2e"]]),ft=Be({__name:"dish-list-copy",emits:["success","goodsDetail","notEnough"],setup(u,{expose:n,emit:d}){const f=Ce(),{goodsLoading:y,goodsInfo:w}=I(f),O=S((()=>{var e;return f.getGoodsInfo(null==(e=w.value)?void 0:e.list)})),D=ke();I(D);const B=d,E=r(!1),$=r({}),Y=r(0),H=r({category_id:null}),J=r(!1),V=r(!1),X=r(0),Z=r(0),ee=r(!1),te=r(!1),le=r("");r(!1);const ae=r(!1),se=r(),ie=r();v((()=>H.value.category_id),(()=>{de()}));const ue=e=>{ie.value.action(e),B("success"),se.value.getCarData()},oe=()=>{B("success"),se.value.getCarData()},ne=()=>{var e;(null==(e=w.value)?void 0:e.isNextPage)&&de(!0)},ce=()=>{E.value=!1},re=e=>{te.value=!0,le.value=e},de=async e=>{const t={...H.value};t.category_id||(t.category_id=0),1==Y.value&&(t.is_special=1);try{await(null==f?void 0:f.getCacheGoodsList(t,e))}catch(l){uni.showToast({title:l.toString(),icon:"none"})}};F("closeShowLanguage",(e=>{e.isSelectLanguage&&M()&&setTimeout((()=>{de()}),500)})),r([]);const ve=r(),_e=()=>{ve.value=!0,Ie.value=!0},fe=()=>{me(!1)},pe=r([]),me=async e=>{var t;try{const l=await ut({table_id:K()},e);pe.value=(null==(t=l.data.detail)?void 0:t.unSendKitchenProduct)||[],pe.value.length>0?ye():(ve.value=!0,Ie.value=!1)}catch(l){}},he=async e=>{var t;const l={product_id:e.product_id,product_num:1,price:e.product_price,product_price:e.product_price,product_sku_id:null==(t=e.sku[0])?void 0:t.product_sku_id,attr:"",feed:"",bag_price:e.bag_price,delivery:L()?30:40,describe:"",is_buffet:e.is_buffet,table_id:K(),order_id:R()};try{const e=await it(l);uni.showToast({title:e.msg,icon:"none"}),oe()}catch(a){if(-32==a.code)return void Ee(a.data.value);re(a.msg)}},be=r([]),ge=r(!1),ye=async()=>{try{const e=await ot({table_id:K()});uni.showToast({title:P(e.msg),icon:"none"}),setTimeout((()=>{B("success"),se.value.getCarData(),ve.value=!0,Ie.value=!1}),300)}catch(e){xe(e)}},we=(e,t)=>{e||(ve.value=!1)},xe=e=>{if(-32==e.code)Ee(e.data.value);else if(-31==e.code){const t=P("剩余")+Math.ceil(e.data.value/60)+P("分鐘即可繼續下單");re(t)}0==e.data.length?Ue.value||0==ae.value?re(P("自助餐时间已到达，自助餐商品不可继续下单")):re(P("用餐時間已到，無法繼續下單")):B("notEnough",e.data)};r([]);const Ae=async()=>{ge.value=!1},Ie=r(!0),Se=e=>{Ie.value=e},Ne=()=>{Ie.value=!1,se.value.getCarData()};Ie.value=!0;const Ue=r(!0);r(-1);const De=r(),Re=r(),Ke=r(!1);_((()=>{F("globalLock",(e=>{ee.value=1==e})),F("sendHead",(e=>{const t=-1!=parseInt(e.buffet.buffet_expired_time);if(Ue.value=1==e.buffet.is_buy_continue,!t)return ae.value=!1,void(Ke.value=!1);const l=e.buffet.buffet_remaining_time,a=60*parseInt(e.buffet.minute);l<=a&&De.value>=a&&(X.value=e.buffet.minute,J.value=!0),De.value=l;const s=ae.value;if(ae.value=0==e.buffet.buffet_remaining_time,ae.value!=s&&1==ae.value&&(J.value=!0),1==e.buffet.is_remain_continue&&0!=e.buffet.remain_continue_time){const t=e.buffet.buffet_order_remaining_time,l=60*parseInt(e.buffet.remain_continue_notice_time);t<=l&&Re.value>=l&&(Z.value=e.buffet.remain_continue_notice_time,V.value=!0),Re.value=t;const a=Ke.value;Ke.value=0==e.buffet.buffet_order_remaining_time,Ke.value!=a&&1==Ke.value&&1!=ae.value&&(V.value=!0)}})),F("buffet_remain",(e=>{re(e)})),F("quota",(e=>{Ee(e)}))}));const Be=r(null);r(0),r(0);const Ee=e=>{const t=P("單次僅可下單")+" "+e+" "+P("個數量，請分多次下單");re(t)};return z((()=>{null==D||D.getCategory(!0)})),W((()=>{q("globalLock"),q("closeShowLanguage"),q("refresh"),q("buffet_remain")})),n({handleSuccess:oe}),(u,n)=>{const r=p(m("ti-loading"),Te),d=j,v=A,_=c,f=p(m("ti-empty-data"),Le),I=G("RecycleScroller"),S=p(m("l-ball"),Xe),L=p(m("ti-drawer"),Pe),D=p(m("ti-modal"),Oe);return e(),a(s,null,[h(_,{class:"ti-dish-box"},{default:l((()=>[h(st,{categoryId:H.value.category_id,"onUpdate:categoryId":n[0]||(n[0]=e=>H.value.category_id=e),isSpecial:Y.value,"onUpdate:isSpecial":n[1]||(n[1]=e=>Y.value=e)},null,8,["categoryId","isSpecial"]),h(_,{class:"ti-dish-list"},{default:l((()=>[h(I,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:ne},{default:l((()=>{var u,n;return[b(y)?(e(),t(r,{key:0})):(null==(u=b(w))?void 0:u.list)&&(null==(n=b(w))?void 0:n.list.length)>0?(e(),a(s,{key:1},[h(_,{class:"ti-dish-goods"},{default:l((()=>[(e(!0),a(s,null,i(O.value,((s,i)=>(e(),t(_,{key:i,class:k([{"sold-out":s.product_stock<=0||1==s.limit_num_status},"ti-goods-item"]),onClick:e=>(async(e,t)=>{if(t.product_stock<=0)return uni.showToast({title:P("已售罄"),icon:"none"});if(1==t.limit_num_status)return uni.showToast({title:P("已限購"),icon:"none"});if(!Ke.value||ae.value||1!=t.is_buffet){if(Ue.value){if(Ke.value&&1==t.is_buffet)return void re(P("自助餐时间已到达，自助餐商品不可继续下单"))}else if(ae.value&&Ke.value||ae.value)return void re(P("用餐時間已到，無法添加商品"));if((null==t?void 0:t.sku.length)<=1&&0==(null==t?void 0:t.product_attr.length)&&0==(null==t?void 0:t.feed.length))return ie.value.action(e),he(t);g((()=>{1==E.value?E.value=!1:(E.value=!0,$.value=t)}))}else re(P("點餐時間已到，無法繼續下單"))})(e,s)},{default:l((()=>[h(_,{class:"ti-goods-image",ref_for:!0,ref_key:"imageRef",ref:Be},{default:l((()=>{var i,u;return[(null==(i=s.image[0])?void 0:i.file_path)?(e(),a("img",{key:0,src:(u=s.image[0].file_path,`${u}?w=168&h=126`),mode:"widthFix"},null,8,["src"])):(e(),t(d,{key:1,src:Ze,mode:"widthFix"})),s.product_stock<=0?(e(),t(v,{key:2,class:"sold-out-text"},{default:l((()=>[x(C(b(P)("已售罄")),1)])),_:1})):o("",!0),1==s.limit_num_status?(e(),t(v,{key:3,class:"sold-out-text"},{default:l((()=>[x(C(b(P)("已限購")),1)])),_:1})):o("",!0)]})),_:2},1536),h(_,{class:"ti-goods-content"},{default:l((()=>[h(_,{class:"ti-goods-title line-clamp-2"},{default:l((()=>[x(C(s.product_name[b(T)()]||s.product_name_text||"-"),1)])),_:2},1024),h(_,{class:"ti-price-box"},{default:l((()=>[h(v,{class:"ti-goods-price"},{default:l((()=>[x(C(b(N)((null==s?void 0:s.product_price)||0)),1)])),_:2},1024),h(v,{class:"ti-goods-subPrice"},{default:l((()=>[x(C(b(U)((null==s?void 0:s.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),1==(null==s?void 0:s.is_buffet)&&(null==s?void 0:s.buffet_limit_num)>0||0==(null==s?void 0:s.is_buffet)&&(null==s?void 0:s.limit_num)>0?(e(),t(_,{key:0,class:"ti-restriction"},{default:l((()=>[x(C(b(Q)("限購{count}份",{count:1==(null==s?void 0:s.is_buffet)?null==s?void 0:s.buffet_limit_num:(null==s?void 0:s.limit_num)||0})),1)])),_:2},1024)):o("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),h(r,{status:b(w).isNextPage?"loading":"no-more"},null,8,["status"])],64)):(e(),t(f,{key:2}))]})),_:1})])),_:1}),h(_,{class:"ti-car-order-nav"},{default:l((()=>[h(S,{ref_key:"ballRef",ref:ie,offset:150,size:23,duration:500},{default:l((({active:e})=>[h(ct,{ref_key:"carRef",ref:se,class:k(["nav-car",{active:e}]),onCar:_e,onConfirm:fe},null,8,["class"])])),_:1},512)])),_:1})])),_:1}),h(nt,{show:E.value,"onUpdate:show":n[2]||(n[2]=e=>E.value=e),goodsDetail:$.value,onCancel:ce,onSuccess:ue},null,8,["show","goodsDetail"]),h(_t,{style:{"z-index":"9999"},show:ge.value,"onUpdate:show":n[3]||(n[3]=e=>ge.value=e),productList:be.value,onConfirm:Ae},null,8,["show","productList"]),h(L,{show:ve.value,width:603.992,title:b(P)("我點的菜"),maskClick:!0,onChange:we},{content:l((()=>[h(_,{class:"ti-drawer-content"},{default:l((()=>[h(_,{class:"ti-content-head"},{default:l((()=>[h(_,{class:"ti-switch-box"},{default:l((()=>[h(_,{class:k(Ie.value?"ti-switch-on":"ti-switch-off"),onClick:n[4]||(n[4]=e=>Se(!0))},{default:l((()=>[h(v,{class:k(Ie.value?"ti-switch-text-on":"ti-switch-text-off")},{default:l((()=>[x(C(b(P)("未下單")),1)])),_:1},8,["class"])])),_:1},8,["class"]),h(_,{class:"ti-switch-space"}),h(_,{class:k(Ie.value?"ti-switch-off":"ti-switch-on"),onClick:n[5]||(n[5]=e=>Se(!1))},{default:l((()=>[h(v,{class:k(Ie.value?"ti-switch-text-off":"ti-switch-text-on")},{default:l((()=>[x(C(b(P)("已下單")),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})])),_:1}),Ie.value?(e(),t(dt,{key:0,buyContinue:Ue.value,isOverTime:ae.value,isOrderOverTime:Ke.value,onSuccess:Ne,onClose:n[6]||(n[6]=e=>ve.value=!1),onChange:oe,onSendkitchenFail:xe},null,8,["buyContinue","isOverTime","isOrderOverTime"])):o("",!0),Ie.value?o("",!0):(e(),t(vt,{key:1,onClose:n[7]||(n[7]=e=>ve.value=!1)}))])),_:1})])),footer:l((()=>[h(_)])),_:1},8,["show","title"]),h(D,{class:"ti-action-tips",show:J.value,"onUpdate:show":n[8]||(n[8]=e=>J.value=e),isCancelShow:!1,onConfirm:n[9]||(n[9]=e=>J.value=!1)},{title:l((()=>[h(_,{class:"warning-header"},{default:l((()=>[h(_,{class:"warning-image-round"},{default:l((()=>[h(d,{class:"warning-image",src:et})])),_:1}),ae.value?(e(),t(_,{key:1,class:"warning-text"},{default:l((()=>[x(C(b(P)("用餐時間結束")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:l((()=>[h(v,null,{default:l((()=>[x(C(b(P)("用餐")),1)])),_:1}),h(v,null,{default:l((()=>[x(C(b(P)("還有")),1)])),_:1}),h(v,{class:"warning-text red"},{default:l((()=>[x(C(X.value),1)])),_:1}),h(v,null,{default:l((()=>[x(C(b(P)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:l((()=>[ae.value?(e(),t(_,{key:1,class:"warning-text"},{default:l((()=>[x(C(b(P)("如有需要，請呼叫服務員")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:l((()=>[h(v,null,{default:l((()=>[x(C(b(P)("請盡快用餐,如有需要，請呼叫服務員")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:V.value,"onUpdate:show":n[10]||(n[10]=e=>V.value=e),isCancelShow:!1,onConfirm:n[11]||(n[11]=e=>V.value=!1)},{title:l((()=>[h(_,{class:"warning-header"},{default:l((()=>[h(_,{class:"warning-image-round"},{default:l((()=>[h(d,{class:"warning-image",src:et})])),_:1}),Ke.value?(e(),t(_,{key:1,class:"warning-text"},{default:l((()=>[x(C(b(P)("點餐時間結束")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:l((()=>[h(v,null,{default:l((()=>[x(C(b(P)("點餐")),1)])),_:1}),h(v,null,{default:l((()=>[x(C(b(P)("還有")),1)])),_:1}),h(v,{class:"warning-text red"},{default:l((()=>[x(C(Z.value),1)])),_:1}),h(v,null,{default:l((()=>[x(C(b(P)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:l((()=>[Ke.value?(e(),t(_,{key:1,class:"warning-text"},{default:l((()=>[x(C(b(P)("如有需要，請呼叫服務員")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:l((()=>[h(v,null,{default:l((()=>[x(C(b(P)("請在剩餘時間完成選購")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:ee.value,"onUpdate:show":n[12]||(n[12]=e=>ee.value=e),isCancelShow:!1,isConfirmShow:!1},{title:l((()=>[h(_,{class:"warning-header"},{default:l((()=>[h(_,{class:"warning-image-round"},{default:l((()=>[h(d,{class:"warning-image",src:tt})])),_:1}),h(_,{class:"warning-text"},{default:l((()=>[x(C(b(P)("订单已锁定")),1)])),_:1})])),_:1})])),footer:l((()=>[h(_)])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:te.value,"onUpdate:show":n[13]||(n[13]=e=>te.value=e),isCancelShow:!1,isConfirmShow:!0,onConfirm:n[14]||(n[14]=e=>te.value=!1),title:b(P)("溫馨提示"),content:le.value},{title:l((()=>[h(_,{class:"warning-header"},{default:l((()=>[h(_,{class:"warning-image-round"},{default:l((()=>[h(d,{class:"warning-image",src:et})])),_:1}),h(_,{class:"warning-text"},{default:l((()=>[x(C(b(P)("温馨提示")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-b616b0f4"]]),pt=Be({__name:"opentable-index",setup(a){const s=ke(),i=Ce();Y(),r();const u=()=>{B()},o=r(),n=r(),d=r("");r([]);const v=r(),f=r(!1),g=r(!1),y=r({ip:"",port:"",device_id:"",remark:""}),w=()=>{const e=X();y.value.ip=(null==e?void 0:e.ip)||Z()||"127.0.0.1",y.value.port=(null==e?void 0:e.port)||"8080"},k=e=>{y.value.remark=e},T=e=>{y.value.ip=e},I=e=>{y.value.port=e},S=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const l=await ue(oe(`${null==t?void 0:t.ip}:${t.port}`),!1);ne(t),ce(l.data.app_id),re(l.data.shop_supplier_id),le(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{f.value=!0}),150)}catch(l){-102==l.code?uni.showToast({title:P("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:P("绑定失败"),icon:"none"})}else uni.showToast({title:P("請輸入連接埠"),icon:"none"});else uni.showToast({title:P("請輸入伺服器位址"),icon:"none"})},O=e=>{f.value=!1,e&&(v.value=e,d.value=e.table_no)},L=()=>{w(),d.value=te().table_no,v.value=te()},N=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const l=await ue(oe(`${null==t?void 0:t.ip}:${t.port}`),!1);if(!v.value)return void uni.showToast({title:P("請查找桌位"),icon:"none"});ne(t),ce(l.data.app_id),re(l.data.shop_supplier_id),le(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{U()}),150)}catch(l){-102==l.code?uni.showToast({title:P("綁定失敗,該商家授權已過期"),icon:"none"}):uni.showToast({title:P("绑定失败"),icon:"none"})}else uni.showToast({title:P("請輸入連接埠"),icon:"none"});else uni.showToast({title:P("請輸入伺服器位址"),icon:"none"})},U=async()=>{if(K()===v.value.table_id&&y.value.remark==de("machine_remark"))return uni.showToast({title:P("绑定成功"),icon:"none"}),n.value=!1,ve(!1),void setTimeout((()=>{_e({url:"/pages/index/index"})}),150);try{await fe({key:de("machine_id"),table_id:v.value.table_id,old_table_id:K(),device_remark:y.value.remark});pe(v.value),uni.showToast({title:P("绑定成功"),icon:"none"}),n.value=!1,ve(!1),setTimeout((()=>{_e({url:"/pages/index/index"})}),150),y.value.remark!=de("machine_remark")&&me({key:"machine_remark",data:y.value.remark})}catch(e){uni.showToast({title:e.msg||e.errMsg,icon:"none"})}},D=r(!1),R=r(!1),B=()=>{D.value=!0,R.value=!0},E=async e=>{if(e)try{await Ie({password:e});y.value.remark=de("machine_remark")||"",n.value=!0,v.value=te(),d.value=v.value.table_no,$()}catch(t){(t.errMsg||t.msg)&&uni.showToast({title:t.msg||t.errMsg,icon:"none"})}else uni.showToast({title:P("請輸入密碼"),icon:"none"})},$=()=>{D.value=!1,R.value=!1};w(),F("goodsRefresh",(()=>{null==s||s.getCategory(!0),null==i||i.getCacheGoodsList(!0)}));const z=r({name:"",logo:"",tableNo:"",is_call_service:1}),G=async e=>{var t,l,a;if(M())try{const s=await ee(e);z.value.name=s.data.name,z.value.logo=s.data.logo,z.value.tableNo=te().table_no,z.value.is_call_service=parseInt(null==(l=null==(t=null==s?void 0:s.data)?void 0:t.tablet)?void 0:l.is_call_service),le(null==(a=s.data)?void 0:a.currency),ae(s)}catch(s){}};return F("authorization",(e=>{g.value=!e})),F("refresh",(e=>{G(!1)})),H((()=>{G(!1)})),W((()=>{q("refresh")})),_((()=>{Ne()?y.value.device_id=Ue():J({success:e=>{y.value.device_id=e.deviceId}})})),V((()=>{var e;null==(e=o.value)||e.showBuffet(!0,0)})),(a,s)=>{const i=p(m("ti-layout-head"),Se),r=c,v=A,_=p(m("ti-input"),Re),w=p(m("ti-layout-table-list"),Ke),U=p(m("ti-modal"),Oe),K=j;return e(),t(r,{class:"ti-page",onClick:s[1]||(s[1]=e=>b(ie)())},{default:l((()=>[h(r,null,{default:l((()=>[h(i,{ref_key:"refCallServer",ref:o,isPay:!0,isTableNo:!0,onDoubleLogo:u,is_call_service:parseInt(z.value.is_call_service)},null,8,["is_call_service"])])),_:1}),h(ft),h(Ae,{show:D.value,title:b(P)("密碼"),password:R.value,placeholder:b(P)("請輸入密碼"),onExit:$,onConfirm:E},null,8,["show","title","password","placeholder"]),h(U,{show:n.value,title:b(P)("設置"),cancelText:b(P)("重置"),confirmText:b(P)("確定"),onCancel:L,onConfirm:N},{content:l((()=>[h(r,{class:"ti-item-input"},{default:l((()=>[h(r,{class:"ti-label-box"},{default:l((()=>[h(r,{class:"ti-label-left"},{default:l((()=>[h(v,{class:"ti-label-server"},{default:l((()=>[x(C(b(P)("當前機器ID")),1)])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-input-box"},{default:l((()=>[h(_,{type:"text",clearable:!1,disabled:!0,value:y.value.device_id},null,8,["value"])])),_:1})])),_:1}),h(r,{class:"ti-item-input"},{default:l((()=>[h(r,{class:"ti-label-box"},{default:l((()=>[h(r,{class:"ti-label-left"},{default:l((()=>[h(v,{class:"ti-label-server"},{default:l((()=>[x(C(b(P)("機器備註(非必填)")),1)])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-input-box"},{default:l((()=>[h(_,{type:"text",onInput:k,value:y.value.remark,placeholder:b(P)("機器備註"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),h(r,{class:"ti-item-input"},{default:l((()=>[h(r,{class:"ti-label-box"},{default:l((()=>[h(r,{class:"ti-label-left"},{default:l((()=>[h(v,{class:"ti-label-server"},{default:l((()=>[x(C(b(P)("服務器連接地址")),1)])),_:1})])),_:1}),h(r,{class:"ti-label-right",onClick:S},{default:l((()=>[h(v,{class:"ti-label-table"},{default:l((()=>[x(C(d.value?b(P)("已選 : ")+b(se)(d.value,19):b(P)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),h(r,{class:"ti-input-box"},{default:l((()=>[h(_,{type:"text",onInput:T,value:y.value.ip,placeholder:b(P)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),h(r,{class:"ti-colon"},{default:l((()=>[x(":")])),_:1}),h(r,{class:"ti-input-port"},{default:l((()=>[h(_,{type:"number",onInput:I,value:y.value.port,placeholder:b(P)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1}),h(w,{show:f.value,"onUpdate:show":s[0]||(s[0]=e=>f.value=e),onConfirm:O},null,8,["show"])])),_:1},8,["show","title","cancelText","confirmText"]),h(U,{class:"ti-action-tips",show:g.value,title:b(P)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:b(P)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:l((()=>[h(r,{class:"warning-header"},{default:l((()=>[h(r,{class:"warning-image-round"},{default:l((()=>[h(K,{class:"warning-image",src:De,mode:""})])),_:1}),h(r,{class:"warning-text"},{default:l((()=>[x(C(b(P)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})}}},[["__scopeId","data-v-6493a80b"]]);export{pt as default};
