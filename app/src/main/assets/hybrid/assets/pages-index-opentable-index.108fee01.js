import{h as e,j as t,w as a,q as l,F as s,t as u,_ as i,k as o,a0 as n,n as c,r as d,a1 as r,a2 as v,e as _,a3 as f,O as p,P as m,p as h,f as g,a4 as y,a5 as b,V as w,a6 as k,v as x,x as C,X as T,U as A,s as I,a7 as O,a8 as S,a9 as L,$ as P,aa as U,ab as N,ac as D,ad as K,J as j,ae as B,Q as E,Y as R,af as F,ag as $,ah as z,ai as G,aj as Q,ak as W,al as M,o as Y,g as H,d as J,l as V,m as q,am as X,I as Z,H as ee,an as te,y as ae,B as le,C as se,D as ue,E as ie,G as oe,N as ne,c as ce,K as de,L as re}from"./index-238fb213.js";import{i as ve,a as _e,b as fe,c as pe,D as me,v as he,_ as ge}from"./verify.ddacffe1.js";import{d as ye,r as be,u as we,e as ke,b as xe,f as Ce,h as Te,j as Ae,k as Ie,i as Oe,g as Se,_ as Le,a as Pe}from"./platform.5d96ca9c.js";import{_ as Ue,a as Ne}from"./ti-button.00c3bc11.js";import"./components-ti-keyboard-ti-keyboard.64f286d3.js";var De=/\s/;var Ke=/^\s+/;function je(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&De.test(e.charAt(t)););return t}(e)+1).replace(Ke,""):e}var Be=NaN,Ee=/^[-+]0x[0-9a-f]+$/i,Re=/^0b[01]+$/i,Fe=/^0o[0-7]+$/i,$e=parseInt;function ze(e){if("number"==typeof e)return e;if(ve(e))return Be;if(ye(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=ye(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=je(e);var a=Re.test(e);return a||Fe.test(e)?$e(e.slice(2),a?2:8):Ee.test(e)?Be:+e}const Ge=function(){return be.Date.now()};var Qe=Math.max,We=Math.min;function Me(e,t,a){var l,s,u,i,o,n,c=0,d=!1,r=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function _(t){var a=l,u=s;return l=s=void 0,c=t,i=e.apply(u,a)}function f(e){var a=e-n;return void 0===n||a>=t||a<0||r&&e-c>=u}function p(){var e=Ge();if(f(e))return m(e);o=setTimeout(p,function(e){var a=t-(e-n);return r?We(a,u-(e-c)):a}(e))}function m(e){return o=void 0,v&&l?_(e):(l=s=void 0,i)}function h(){var e=Ge(),a=f(e);if(l=arguments,s=this,n=e,a){if(void 0===o)return function(e){return c=e,o=setTimeout(p,t),d?_(e):i}(n);if(r)return clearTimeout(o),o=setTimeout(p,t),_(n)}return void 0===o&&(o=setTimeout(p,t)),i}return t=ze(t)||0,ye(a)&&(d=!!a.leading,u=(r="maxWait"in a)?Qe(ze(a.maxWait)||0,t):u,v="trailing"in a?!!a.trailing:v),h.cancel=function(){void 0!==o&&clearTimeout(o),c=0,l=n=s=o=void 0},h.flush=function(){return void 0===o?i:m(Ge())},h}const Ye=Ue(_e,[["render",function(d,r,v,_,f,p){const m=c;return e(),t(m,{class:"l-ball-wrapper",ref:"l-ball-wrapper"},{default:a((()=>[(e(!0),l(s,null,u(d.balls,(a=>(e(),l(s,{key:a.time},[a.done?o("",!0):(e(),t(m,{key:0,class:"l-ball",ref_for:!0,ref:a.ref,style:i(a.style),animation:a.data},null,8,["style","animation"]))],64)))),128)),n(d.$slots,"default",{active:d.active},void 0,!0)])),_:3},512)}],["__scopeId","data-v-b3f08bc3"]]),He=""+new URL("occupy-bitmap-77eee00d.svg",import.meta.url).href,Je=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,Ve=""+new URL("icon-lock-bd74ef9c.svg",import.meta.url).href,qe=Ue({__name:"ti-category",props:{scrollLeft:{type:Number,default:0},scrollInterval:{type:Number,default:200},threshold:{type:Number,default:5}},setup(l,{expose:s}){const u=l,i=d(0),k=d(!1),x=d(!1),C=d(0),T=d(0),A=d(`ti-${r(16)}`);v((()=>u.scrollLeft),(()=>{i.value=u.scrollLeft}));const I=Me((e=>{i.value=e.detail.scrollLeft,k.value=u.threshold<e.detail.scrollLeft,x.value=T.value+e.detail.scrollLeft<e.detail.scrollWidth-u.threshold}),300),O=()=>{k.value=!1},S=()=>{x.value=!1},L=e=>{let t=0;"left"==e?t=i.value-u.scrollInterval:"right"==e&&(t=i.value+u.scrollInterval);const a=C.value-T.value;i.value=Math.min(a,Math.max(t,0))},P=()=>{y((()=>{i.value=0;b().in(this).select(`#${A.value}`).fields({size:!0,scrollOffset:!0},(e=>{T.value=(null==e?void 0:e.width)||0,C.value=(null==e?void 0:e.scrollWidth)||0,C.value>T.value?x.value=!0:(k.value=!1,x.value=!1)})).exec()}))};return _((()=>{P(),window.addEventListener("resize",P)})),f((()=>{window.removeEventListener("resize",P)})),s({getScrollWidth:P}),(l,s)=>{const d=p(m("uni-icons"),fe),r=c,v=w;return e(),t(r,{class:"ti-category-box"},{default:a((()=>[k.value?(e(),t(r,{key:0,class:"ti-category-left",onClick:s[0]||(s[0]=e=>L("left"))},{default:a((()=>[h(r,{class:"ti-category-btn"},{default:a((()=>[h(d,{type:"left",size:"14",color:"#100A05"})])),_:1})])),_:1})):o("",!0),h(v,{id:A.value,class:"ti-category","scroll-left":i.value,"scroll-x":"","enable-flex":"","scroll-with-animation":"","upper-threshold":u.threshold,"lower-threshold":u.threshold,onScrolltoupper:O,onScrolltolower:S,onScroll:g(I)},{default:a((()=>[n(l.$slots,"default",{},void 0,!0)])),_:3},8,["id","scroll-left","upper-threshold","lower-threshold","onScroll"]),x.value?(e(),t(r,{key:1,class:"ti-category-right",onClick:s[1]||(s[1]=e=>L("right"))},{default:a((()=>[h(r,{class:"ti-category-btn"},{default:a((()=>[h(d,{type:"right",size:"14",color:"#100A05"})])),_:1})])),_:1})):o("",!0)])),_:3})}}},[["__scopeId","data-v-50a73735"]]),Xe=Ue({__name:"dish-menu",props:{list:{type:Array,default:()=>[]},menuId:{type:Number,default:null},defaultIndex:{type:Number,default:0}},emits:["update:menuId"],setup(i,{emit:n}){const r=n,_=i,f=d(0),w=d(_.defaultIndex),I=d([]);v((()=>_.list),(async e=>{if(!e||0==e.length)return;await y();const t=b().in(this);e.map(((e,a)=>{t.select(`#scroll-item-${a}`).boundingClientRect((e=>{if(!e)return;const t=I.value;t[a]=e.width+10,I.value=t})).exec()})),O(w.value)}),{deep:!0,immediate:!0});const O=e=>{w.value=e,f.value=I.value.slice(0,e+1).reduce(((e,t)=>e+t),0)-(I.value[e]+100),r("update:menuId",_.list[e].category_id)};return(i,n)=>{const d=A,r=c,v=p(m("ti-category"),qe);return e(),t(r,{class:"ti-dish-menu"},{default:a((()=>[_.list&&_.list.length>0?(e(),t(v,{key:0,scrollLeft:f.value},{default:a((()=>[h(r,{class:"ti-menu-content"},{default:a((()=>[(e(!0),l(s,null,u(_.list,((l,s)=>(e(),t(r,{key:s,class:k(["ti-menu-item",{active:s==w.value}]),id:`scroll-item-${s}`,onClick:e=>O(s)},{default:a((()=>[h(d,{class:"ti-menu-title"},{default:a((()=>[x(C(l.name[g(T)()]||l.name_text),1)])),_:2},1024)])),_:2},1032,["id","class","onClick"])))),128))])),_:1})])),_:1},8,["scrollLeft"])):o("",!0)])),_:1})}}},[["__scopeId","data-v-053715b0"]]),Ze=Ue({__name:"dish-category",props:{categoryId:{type:Number,default:null}},emits:["update:categoryId","update:isSpecial"],setup(i,{emit:n}){const r=we(),{categoryList:_}=I(r),f=n,y=d(),b=d(0),w=d(0),A=O((()=>{let e=(_.value.find((e=>e.category_id==b.value))||{}).child||[];return e&&e.length>0&&(e=[ke].concat(e)),e})),S=O((()=>_.value.find((e=>e.category_id==b.value)))),L=O((()=>A.value.find((e=>e.category_id==w.value))));v((()=>b.value),(()=>{var e,t;f("update:isSpecial",null==(e=S.value)?void 0:e.is_special),f("update:categoryId",b.value),A.value&&A.value.length>0&&(w.value=A.value[0].category_id,P(w.value)),null==(t=y.value)||t.getScrollWidth()}));const P=e=>{var t;w.value=e,f("update:isSpecial",null==(t=L.value)?void 0:t.is_special),f("update:categoryId",w.value>0?w.value:b.value)};return(i,n)=>{const d=c,r=p(m("ti-category"),qe);return e(),t(d,{class:"ti-category-box"},{default:a((()=>[h(Xe,{list:g(_),menuId:b.value,"onUpdate:menuId":n[0]||(n[0]=e=>b.value=e)},null,8,["list","menuId"]),A.value&&A.value.length>0?(e(),t(d,{key:0,class:"ti-dish-secondary"},{default:a((()=>[h(r,{ref_key:"categoryRef",ref:y},{default:a((()=>[h(d,{class:"ti-secondary-box"},{default:a((()=>[(e(!0),l(s,null,u(A.value,((l,s)=>(e(),t(d,{key:s,class:k([{active:l.category_id==w.value},"ti-secondary-item"]),onClick:e=>P(l.category_id)},{default:a((()=>[x(C(l.name[g(T)()]||l.name_text),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1},512)])),_:1})):o("",!0)])),_:1})}}},[["__scopeId","data-v-c5968335"]]);function et(e){return S("order.Order/add",e)}function tt(e,t){return S("order.Order/getUnSendKitchen",e,{isLoading:t})}function at(e){return S("order.Order/sendKitchen",e,{isLoading:!0,isMessage:!1})}const lt=Ue({__name:"goods-detail",props:{show:{type:Boolean,default:!1},goodsDetail:{type:Object,default:()=>({})}},emits:["update:show","success","cancel"],setup(i,{emit:n}){const r=n,_=i,f=d({});d(!1);const y=d(!1),b=d({product_id:null,product_num:1,price:null,product_price:null,product_sku_id:null,attr:[],feed_uuids:[],bag_price:0,delivery:L()?30:40,describe:null,is_buffet:1});v((()=>_.show),(()=>{_.show&&w()}));const w=async()=>{var e,t,a,l,s,u,i,o,n,c;f.value=_.goodsDetail,b.value.product_id=null==(e=f.value)?void 0:e.product_id,b.value.price=null==(t=f.value)?void 0:t.product_price,b.value.product_price=null==(a=f.value)?void 0:a.product_price,b.value.is_buffet=null==(l=f.value)?void 0:l.is_buffet,(null==(s=f.value)?void 0:s.sku)&&(null==(u=f.value)?void 0:u.sku.length)>0&&(null==(i=f.value)||i.sku.some((e=>{if(e.stock_num>0)return b.value.product_sku_id=e.product_sku_id,!0}))),(null==(o=f.value)?void 0:o.product_attr)&&(null==(n=f.value)?void 0:n.product_attr.length)>0&&(null==(c=f.value)||c.product_attr.map(((e,t)=>{(null==e?void 0:e.attribute_value)&&(null==e?void 0:e.attribute_value.length)>0?b.value.attr[t]=0:b.value.attr[t]=null}))),b.value.feed_uuids&&b.value.feed_uuids.length>0&&(b.value.feed_uuids=[])},I=(e,t)=>b.value.attr[e]==t;return(i,n)=>{const d=E,v=c,w=A,O=p(m("ti-modal"),xe);return e(),t(O,{show:_.show,title:g(P)("商品詳情"),cancelText:g(P)("取消"),confirmText:g(P)("確定"),confirmLoading:y.value,onCancel:n[0]||(n[0]=e=>r("cancel")),onConfirm:n[1]||(n[1]=e=>(async()=>{var e,t,a;const l={x:event.clientX,y:event.clientY};if(y.value)return;const s={...b.value};s.attr=s.attr.join(",");let u=[];if(b.value.product_sku_id&&(null==(e=f.value)?void 0:e.sku)&&(null==(t=f.value)?void 0:t.sku.length)>0){const e=null==(a=f.value)?void 0:a.sku.find((e=>e.product_sku_id==b.value.product_sku_id));s.price=(null==e?void 0:e.product_price)||0,u.push(null==e?void 0:e.spec_name)}b.value.attr&&b.value.attr.length>0&&b.value.attr.map(((e,t)=>{var a;const l=null==(a=f.value)?void 0:a.product_attr[t];(null==l?void 0:l.attribute_value)&&l.attribute_value[e]&&u.push(l.attribute_value[e])})),b.value.feed_uuids&&b.value.feed_uuids.length>0&&b.value.feed_uuids.map((e=>{var t;const a=((null==(t=f.value)?void 0:t.product_feed)||[]).find((t=>t.uuid==e));u.push(null==a?void 0:a.feed_name),s.price=D(s.price,null==a?void 0:a.price)})),s.describe=u.join(";"),s.delivery=L()?30:40,s.order_id=K(),s.table_id=j();try{y.value=!0;const e=await et(s);1==e.code&&(B(e.data.order_id),uni.showToast({title:e.msg,icon:"none"}),r("update:show",!1),setTimeout((()=>{r("success",l)}),100))}catch(i){}finally{y.value=!1}})())},{content:a((()=>[h(v,{class:"ti-dialog-content"},{default:a((()=>[h(v,{class:"ti-detail-box"},{default:a((()=>[h(v,{class:"ti-detail-image"},{default:a((()=>{var a,l,s,u;return[(null==(a=f.value)?void 0:a.image)&&(null==(l=f.value)?void 0:l.image[0])&&(null==(s=f.value)?void 0:s.image[0].file_path)?(e(),t(d,{key:0,src:null==(u=f.value)?void 0:u.image[0].file_path,mode:"widthFix"},null,8,["src"])):(e(),t(d,{key:1,src:He,mode:"widthFix"}))]})),_:1}),h(v,{class:"ti-detail-con"},{default:a((()=>[h(v,{class:"ti-detail-title text-ellipsis"},{default:a((()=>{var e,t;return[x(C((null==(e=f.value)?void 0:e.product_name[g(T)()])||(null==(t=f.value)?void 0:t.product_name_text)),1)]})),_:1}),h(v,{class:"ti-price-box"},{default:a((()=>[h(w,{class:"ti-detail-unit"},{default:a((()=>[x(C(g(P)("單價：")),1)])),_:1}),h(w,{class:"ti-detail-price"},{default:a((()=>{var e;return[x(C(g(U)((null==(e=f.value)?void 0:e.product_price)||0)),1)]})),_:1}),h(w,{class:"ti-detail-subPrice"},{default:a((()=>{var e;return[x(C(g(N)((null==(e=f.value)?void 0:e.product_price)||0)),1)]})),_:1})])),_:1}),h(v,{class:"ti-price-box"},{default:a((()=>[h(w,{class:"ti-detail-unit"},{default:a((()=>[x(C(g(P)("單位：")),1)])),_:1}),h(w,{class:"ti-detail-price"},{default:a((()=>{var e,t;return[x(C((null==(e=f.value)?void 0:e.product_unit[g(T)()])||(null==(t=f.value)?void 0:t.product_unit_text)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),h(v,{class:"ti-detail-specs"},{default:a((()=>[h(v,{class:"ti-specs-box"},{default:a((()=>{var i,n,c,d,r,_;return[(null==(i=f.value)?void 0:i.sku)&&(null==(n=f.value)?void 0:n.sku.length)>0?(e(),t(v,{key:0,class:"ti-specs-item"},{default:a((()=>[h(v,{class:"ti-specs-title"},{default:a((()=>[x(C(g(P)("規格")),1)])),_:1}),h(v,{class:"ti-specs-child"},{default:a((()=>{var i;return[(e(!0),l(s,null,u(null==(i=f.value)?void 0:i.sku,(l=>(e(),t(v,{key:l.product_sku_id,class:k([{active:l.product_sku_id==b.value.product_sku_id,disabled:l.stock_num<=0},"ti-child-item"]),onClick:e=>(e=>{e.stock_num<=0||b.value.product_sku_id!=e.product_sku_id&&(b.value.product_sku_id=e.product_sku_id)})(l)},{default:a((()=>[h(w,{class:"ti-child-name"},{default:a((()=>[x(C(l.spec_name_i18n[g(T)()]||l.spec_name_text),1)])),_:2},1024),h(w,{class:"ti-child-price"},{default:a((()=>[x(C(g(U)((null==l?void 0:l.product_price)||0)),1)])),_:2},1024),h(w,{class:"ti-child-subPrice"},{default:a((()=>[x(C(g(N)((null==l?void 0:l.product_price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):o("",!0),(null==(c=f.value)?void 0:c.product_attr)&&(null==(d=f.value)?void 0:d.product_attr.length)>0?(e(),t(v,{key:1},{default:a((()=>{var i;return[(e(!0),l(s,null,u(null==(i=f.value)?void 0:i.product_attr,((i,o)=>(e(),t(v,{key:o,class:"ti-specs-item"},{default:a((()=>[h(v,{class:"ti-specs-title"},{default:a((()=>[x(C(i.attribute_name_i18n[g(T)()]||i.attribute_name_text),1)])),_:2},1024),h(v,{class:"ti-specs-child"},{default:a((()=>[(e(!0),l(s,null,u(null==i?void 0:i.attribute_value_i18n,((l,s)=>(e(),t(v,{key:s,class:k([{active:I(o,s)},"ti-child-item"]),onClick:e=>((e,t)=>{b.value.attr[e]=t})(o,s)},{default:a((()=>[h(w,{class:"ti-child-name"},{default:a((()=>[x(C(l[g(T)()]||(null==i?void 0:i.attribute_value_text[s])),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:2},1024)])),_:2},1024)))),128))]})),_:1})):o("",!0),(null==(r=f.value)?void 0:r.product_feed)&&(null==(_=f.value)?void 0:_.product_feed.length)>0?(e(),t(v,{key:2,class:"ti-specs-item"},{default:a((()=>[h(v,{class:"ti-specs-title"},{default:a((()=>[x(C(g(P)("加料")),1)])),_:1}),h(v,{class:"ti-specs-child"},{default:a((()=>{var i;return[(e(!0),l(s,null,u(null==(i=f.value)?void 0:i.product_feed,(l=>(e(),t(v,{key:l.uuid,class:k([{active:(b.value.feed_uuids||[]).indexOf(l.uuid)>-1},"ti-child-item"]),onClick:e=>(e=>{const t=b.value.feed_uuids.indexOf(e);t>=0?b.value.feed_uuids.splice(t,1):b.value.feed_uuids.push(e)})(l.uuid)},{default:a((()=>[h(w,{class:"ti-child-name"},{default:a((()=>[x(C(l.feed_name_i18n[g(T)()]||l.feed_name_text),1)])),_:2},1024),h(w,{class:"ti-child-price"},{default:a((()=>[x(C(g(U)((null==l?void 0:l.price)||0)),1)])),_:2},1024),h(w,{class:"ti-child-subPrice"},{default:a((()=>[x(C(g(N)((null==l?void 0:l.price)||0)),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))]})),_:1})])),_:1})):o("",!0)]})),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","cancelText","confirmText","confirmLoading"])}}},[["__scopeId","data-v-babe1690"]]),st=Ue({__name:"dish-car-order-nav",emits:["car","confirm"],setup(l,{expose:s,emit:u}){const i=u,n=()=>{i("car")},r=()=>{i("confirm")},v=d(),_=d(!1),f=async()=>{var e;try{const t=await tt({table_id:j()},!1);v.value=(null==(e=t.data)?void 0:e.detail)||{},v.value.unSendKitchenProductTotalNum>0?_.value=!0:_.value=!1}catch(t){}};return f(),s({getCarData:f}),(l,s)=>{const u=E,i=A,d=c;return e(),t(d,{class:"ti-car-order"},{default:a((()=>[h(d,{class:"ti-order-total",onClick:n},{default:a((()=>[h(u,{class:"ti-total-image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAE9SURBVHgB7ZjxrcIgEMY/Xt4AbvAYwRHc4DmKbuAG6gR1A92g3UA3sE6gTnAesZqG1gLKSf/oL7nQwKV8Be6AAj1DPR6IaMTF6NmgVIlUGDFsR2qSVUJ7I8iQIwWVKF2zWU3UBH2AhexJhtx8dFufPw5NF8gwYTu2jbxLkIYsmV3hEiQdYdoepdSCGn38OpzXbP+Qo2Q7YCAA9aqhyhNbyK6jHe+Zcy9PFrQgec52v11R9o0IayTe1IJKu6JL0B8S4EqM0lztii5BGvIELWoNeU52ReopC4qyAvL472PmWECyZAiF5LJ1Ti9uM8pDlMb9yKnxOWbNHHj/KjDwJs4pq8PTN+VizFb4DHuofxD88qW1MGcx/UPFjFsi5RzLv84nmTr0eBL3OEPNnxGrmP7vCDKXuk2V1Bax/Qd8uQE+N6CHpHz4IAAAAABJRU5ErkJggg=="}),h(i,{class:"ti-total-price"},{default:a((()=>{var e;return[x(C(g(U)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),h(i,{class:"ti-total-subPrice"},{default:a((()=>{var e;return[x(C(g(N)((null==(e=v.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1}),_.value?(e(),t(d,{key:0,class:"ti-total-badge-box"},{default:a((()=>[h(i,{class:"ti-total-badge"},{default:a((()=>{var e;return[x(C(null==(e=v.value)?void 0:e.unSendKitchenProductTotalNum),1)]})),_:1})])),_:1})):o("",!0),h(d,{class:"ti-order-btn",onClick:r},{default:a((()=>[h(i,{class:"ti-btn-text"},{default:a((()=>[x(C(l.$t("下單")),1)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-4b7b5136"]]),ut=Ue({__name:"cart-number",props:{productItem:{type:Object,default:()=>({})},isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["change"],setup(l,{emit:s}){const u=l,i=s,o=d(!1),n=async e=>{var t,a,l,s;if(u.isOrderOverTime&&1==(null==(t=u.productItem)?void 0:t.is_buffet_product)&&"up"==e&&1!=u.isOverTime)return void F("buffet_remain",P("點餐時間已到，無法繼續下單"));if(0==u.buyContinue&&1==u.isOverTime&&1==u.isOrderOverTime&&"up"==e)return void F("buffet_remain",P("用餐時間已到，無法繼續下單"));if(1==u.isOverTime&&1==(null==(a=u.productItem)?void 0:a.is_buffet_product)&&"up"==e)return void F("buffet_remain",P("自助餐时间已到达，自助餐商品不可继续下单"));const n={order_product_id:null==(l=u.productItem)?void 0:l.order_product_id,product_num:null==(s=u.productItem)?void 0:s.total_num,type:e};"up"==e?n.product_num+=1:n.product_num-=1;try{o.value=!0;const e=await function(e){return S("order.Order/sub",e)}(n);1==e.code&&i("change")}catch(c){}finally{o.value=!1}};return(s,u)=>{const i=c;return e(),t(i,{class:"ti-number-box",onClick:u[2]||(u[2]=R((()=>{}),["stop"]))},{default:a((()=>[h(i,{class:"ti-number-btn ti-number-minus",disabled:!1,onClick:u[0]||(u[0]=e=>n("down"))},{default:a((()=>[h(i,{class:"ti-number-minus-reduce"})])),_:1}),h(i,{class:"ti-number-input"},{default:a((()=>[x(C(l.productItem.total_num),1)])),_:1}),h(i,{class:"ti-number-btn ti-number-plus",disabled:!1,onClick:u[1]||(u[1]=e=>n("up"))},{default:a((()=>[h(i,{class:"ti-number-plus-add"}),h(i,{class:"ti-number-plus-add2"})])),_:1})])),_:1})}}},[["__scopeId","data-v-5e29d975"]]),it=Ue({__name:"dish-car-ordering-list",props:{isOverTime:{type:Boolean,default:!1},isOrderOverTime:{type:Boolean,default:!1},buyContinue:{type:Boolean,default:!1}},emits:["success","change","sendkitchenFail"],setup(i,{emit:n}){const r=i,v=d(!1),_=n,f=d(),y=d(),b=d({table_id:""}),k=async e=>{var t;b.table_id=j();try{const e=await tt(b,!1);f.value=e.data.detail,y.value=(null==(t=e.data.detail)?void 0:t.unSendKitchenProduct)||[],_("change")}catch(a){}},T=async e=>{try{v.value=!0;const e=await at({table_id:j()});uni.showToast({title:P(e.msg),icon:"none"}),setTimeout((()=>{_("success")}),500)}catch(t){_("sendkitchenFail",t)}finally{v.value=!1}};return k(),$("handleDelProuct",(e=>{k()})),(i,n)=>{const d=c,v=A,_=w,b=p(m("ti-button"),Ne),I=p(m("ti-empty-data"),Ce);return e(),t(d,{class:"ti-shop-list-box"},{default:a((()=>{var i,c;return[(null==(i=y.value)?void 0:i.length)>0?(e(),t(d,{key:0,class:"ti-shop-list"},{default:a((()=>[h(d,null,{default:a((()=>[h(d,{class:"ti-cart-shop-head"},{default:a((()=>[h(d,{class:"ti-shop-head-title"},{default:a((()=>[x(C(g(P)("商品名稱")),1)])),_:1}),h(d,{class:"ti-shop-head-money"},{default:a((()=>[x(C(g(P)("金額")),1)])),_:1}),h(d,{class:"ti-shop-head-num"},{default:a((()=>[x(C(g(P)("數量")),1)])),_:1})])),_:1})])),_:1}),h(d,{class:"ti-scroll-box"},{default:a((()=>[h(_,{class:"ti-shop-scroll","scroll-y":""},{default:a((()=>[h(d,{class:"ti-shop-box"},{default:a((()=>[(e(!0),l(s,null,u(y.value,((l,s)=>(e(),t(d,{class:"ti-shop-item",key:l},{default:a((()=>[h(d,{class:"ti-shop-item-box"},{default:a((()=>[h(d,{class:"ti-shop-box"},{default:a((()=>[h(d,{class:"ti-shop-body-top"},{default:a((()=>[h(d,{class:"ti-shop-title text-ellipsis"},{default:a((()=>[x(C(l.product_name_text),1)])),_:2},1024),h(d,{class:"ti-shop-spec"},{default:a((()=>[x(C(l.product_attr),1)])),_:2},1024)])),_:2},1024),h(d,{class:"ti-shop-body-money"},{default:a((()=>[h(v,{class:"ti-shop-price"},{default:a((()=>[x(C(g(U)((null==l?void 0:l.total_pay_price)||0)),1)])),_:2},1024),h(v,{class:"ti-shop-subPrice"},{default:a((()=>[x(C(g(N)((null==l?void 0:l.total_pay_price)||0)),1)])),_:2},1024)])),_:2},1024),h(d,{class:"ti-shop-body-number"},{default:a((()=>[h(ut,{buyContinue:r.buyContinue,isOverTime:r.isOverTime,isOrderOverTime:r.isOrderOverTime,productItem:l,onChange:n[0]||(n[0]=e=>k())},null,8,["buyContinue","isOverTime","isOrderOverTime","productItem"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1}),h(d,{class:"ti-content-bottom"},{default:a((()=>[h(d,{class:"ti-car-shop-bottom"},{default:a((()=>[h(d,{class:"ti-shop-bottom-item"},{default:a((()=>[h(d,null,{default:a((()=>[h(v,{class:"ti-shop-bottom-text"},{default:a((()=>{var e;return[x(C(g(P)("共")+((null==(e=f.value)?void 0:e.unSendKitchenProductTotalNum)||0)+g(P)("件")),1)]})),_:1})])),_:1}),h(d,null,{default:a((()=>[h(v,{class:"ti-shop-bottom-text"},{default:a((()=>[x(C(g(P)("小計：")),1)])),_:1}),h(v,{class:"ti-shop-bottom-price"},{default:a((()=>{var e;return[x(C(g(U)((null==(e=f.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1}),h(v,{class:"ti-shop-bottom-subPrice"},{default:a((()=>{var e;return[x(C(g(N)((null==(e=f.value)?void 0:e.unSendKitchenProductTotalPrice)||0)),1)]})),_:1})])),_:1})])),_:1})])),_:1}),h(b,{title:g(P)("確認下單"),type:"primary",onClick:T},null,8,["title"])])),_:1})])),_:1})):o("",!0),(null==(c=y.value)?void 0:c.length)<=0?(e(),t(d,{key:1,class:"ti-empty-data-box"},{default:a((()=>[h(I,{title:g(P)("當前無待下單商品")},null,8,["title"])])),_:1})):o("",!0)]})),_:1})}}},[["__scopeId","data-v-246d4d98"]]),ot=Ue({__name:"dish-car-ordered-list",setup(i){const n=d([]),r=d(""),v=d();let _=0;(async()=>{try{const t=await(e={table_id:j()},S("order.Order/getSendKitchen",e));n.value=t.data.list||[],r.value=t.data.total_price,t.data.list.forEach((e=>{_+=e.plist.length})),v.value=_}catch(t){}var e})();return(i,d)=>{const _=c,f=A,y=w,b=p(m("ti-empty-data"),Ce);return e(),t(_,{class:"ti-shop-list-box"},{default:a((()=>[Object.keys(n.value).length>0?(e(),t(_,{key:0,class:"ti-shop-list"},{default:a((()=>[h(_,{class:"ti-scroll-box"},{default:a((()=>[h(y,{class:"ti-shop-scroll","scroll-y":""},{default:a((()=>[(e(!0),l(s,null,u(n.value,((i,n)=>(e(),t(_,{class:"ti-shop-item",key:n},{default:a((()=>[h(_,{class:"ti-shop-time-top"}),h(_,{class:"ti-shop-time-box"},{default:a((()=>[x(C(i.date+" "+g(P)("下單")),1)])),_:2},1024),(e(!0),l(s,null,u(i.plist,((l,s)=>(e(),t(_,{key:s},{default:a((()=>[h(_,{class:"ti-shop-item-box"},{default:a((()=>[h(_,{class:"ti-shop-box"},{default:a((()=>[h(_,{class:"ti-shop-body-top"},{default:a((()=>[h(_,{class:"ti-shop-title text-ellipsis"},{default:a((()=>[x(C(l.product_name_text||l.name_text||l.buffet_name_text),1)])),_:2},1024),l.product_attr||l.customer_type_name_text?(e(),t(_,{key:0,class:"ti-shop-spec"},{default:a((()=>[x("("+C(l.product_attr||l.customer_type_name_text)+")",1)])),_:2},1024)):o("",!0)])),_:2},1024),h(_,{class:"ti-shop-body-money"},{default:a((()=>[h(f,{class:"ti-shop-price"},{default:a((()=>[x(C(g(U)((null==l?void 0:l.total_product_price)||(null==l?void 0:l.total_price)||0)),1)])),_:2},1024),h(f,{class:"ti-shop-subPrice"},{default:a((()=>[x(C(g(N)((null==l?void 0:l.total_product_price)||(null==l?void 0:l.total_price)||0)),1)])),_:2},1024)])),_:2},1024),h(_,{class:"ti-shop-body-state"},{default:a((()=>[null!=l.finish_num?(e(),t(_,{key:0,class:"ti-state-left"},{default:a((()=>[x(C(null!=l.finish_num?l.finish_num:l.num),1)])),_:2},1024)):o("",!0),null!=l.finish_num?(e(),t(_,{key:1,class:"ti-state-line"},{default:a((()=>[x("/")])),_:1})):o("",!0),h(_,{class:"ti-state-right"},{default:a((()=>[x(C(l.total_num||l.num),1)])),_:2},1024),null!=l.finish_num?(e(),t(_,{key:2,class:"ti-state-text"},{default:a((()=>{return[x(C((e=null!=l.finish_num?l.kitchen_status:l.is_comb,P(0===e?"製作中":1===e?"已完成":"未知"))),1)];var e})),_:2},1024)):o("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),s!=i.length-1?(e(),t(_,{key:0,class:"ti-shop-item-box-bottom-border"})):o("",!0)])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1})])),_:1}),h(_,{class:"ti-content-bottom"},{default:a((()=>[h(_,{class:"ti-car-shop-bottom"},{default:a((()=>[h(_,{class:"ti-shop-bottom-item"},{default:a((()=>[h(_,null,{default:a((()=>[h(f,{class:"ti-shop-bottom-text"},{default:a((()=>[x(C(g(P)("共")+(v.value||0)+g(P)("件")),1)])),_:1})])),_:1}),h(_,null,{default:a((()=>[h(f,{class:"ti-shop-bottom-text"},{default:a((()=>[x(C(g(P)("小計：")),1)])),_:1}),h(f,{class:"ti-shop-bottom-price"},{default:a((()=>[x(C(g(U)(r.value||0)),1)])),_:1}),h(f,{class:"ti-shop-bottom-subPrice"},{default:a((()=>[x(C(g(N)(r.value||0)),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):o("",!0),Object.keys(n.value).length<=0?(e(),t(b,{key:1,class:"ti-empty-data",title:g(P)("當前無已下單商品")},null,8,["title"])):o("",!0)])),_:1})}}},[["__scopeId","data-v-3219f391"]]),nt=Ue({__name:"goods-not-enough",props:{show:{type:Boolean,default:!1},productList:{type:Array,default:[]}},emits:["update:show","confirm"],setup(i,{emit:o}){const n=o,d=i,r=()=>{n("confirm")};return(o,v)=>{const _=A,f=c,g=w,y=p(m("ti-modal"),xe);return e(),t(y,{class:"ti-action-tip",show:d.show,isCancelShow:!1,title:o.$t("温馨提示"),confirmText:o.$t("確定"),onCancel:v[0]||(v[0]=e=>n("update:show",!1)),onConfirm:r},{content:a((()=>[h(f,{class:"ti-dialog-content"},{default:a((()=>[h(f,{class:"ti-detail-box"},{default:a((()=>[h(_,{class:"ti-detail-des"},{default:a((()=>[x(C(o.$t("商品庫存不足，請重新選擇")),1)])),_:1})])),_:1}),h(f,{class:"ti-detail-specs"},{default:a((()=>[h(g,{"scroll-y":""},{default:a((()=>[(e(!0),l(s,null,u(i.productList,((l,s)=>(e(),t(f,{class:"ti-specs-box"},{default:a((()=>[h(f,{class:"ti-specs-item"},{default:a((()=>[h(f,{class:"ti-specs-title"},{default:a((()=>[x(C(l.product_name_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title","confirmText"])}}},[["__scopeId","data-v-a9bc6e2e"]]),ct=Ue({__name:"dish-list",emits:["success","goodsDetail","notEnough"],setup(i,{expose:n,emit:r}){const f=Te(),{goodsLoading:y,goodsInfo:b}=I(f),S=O((()=>{var e;return f.getGoodsInfo(null==(e=b.value)?void 0:e.list)})),D=we();I(D);const B=r,R=d(!1),F=d({}),Y=d(0),H=d({category_id:null}),J=d(!1),V=d(!1),q=d(0),X=d(0),Z=d(!1),ee=d(!1),te=d("");d(!1);const ae=d(!1),le=d(),se=d();v((()=>H.value.category_id),(()=>{de(!0)}));const ue=e=>{se.value.action(e),B("success"),le.value.getCarData()},ie=()=>{B("success"),le.value.getCarData()},oe=()=>{var e;(null==(e=b.value)?void 0:e.isNextPage)&&de(!0)},ne=()=>{R.value=!1},ce=e=>{ee.value=!0,te.value=e},de=async e=>{const t={...H.value};t.category_id||(t.category_id=0),1==Y.value&&(t.is_special=1);try{await(null==f?void 0:f.getCacheGoodsList(t,e))}catch(a){uni.showToast({title:a.toString(),icon:"none"})}};$("closeShowLanguage",(e=>{e.isSelectLanguage&&z()&&setTimeout((()=>{de()}),500)})),d([]);const re=d(),ve=()=>{re.value=!0,Se.value=!0},_e=()=>{me(!1)},fe=d([]),me=async e=>{var t;try{const a=await tt({table_id:j()},e);fe.value=(null==(t=a.data.detail)?void 0:t.unSendKitchenProduct)||[],fe.value.length>0?be():(re.value=!0,Se.value=!1)}catch(a){}},he=async e=>{var t;const a={product_id:e.product_id,product_num:1,price:e.product_price,product_price:e.product_price,product_sku_id:null==(t=e.sku[0])?void 0:t.product_sku_id,attr:"",feed:"",bag_price:e.bag_price,delivery:L()?30:40,describe:"",is_buffet:e.is_buffet,table_id:j(),order_id:K()};try{const e=await et(a);uni.showToast({title:e.msg,icon:"none"}),ie()}catch(l){ce(l.msg)}},ge=d([]),ye=d(!1),be=async()=>{try{const e=await at({table_id:j()});uni.showToast({title:P(e.msg),icon:"none"}),setTimeout((()=>{B("success"),le.value.getCarData(),re.value=!0,Se.value=!1}),300)}catch(e){Ie(e)}},ke=(e,t)=>{e||(re.value=!1)},Ie=e=>{0==e.data.length?Ue.value||0==ae.value?ce(P("自助餐时间已到达，自助餐商品不可继续下单")):ce(P("用餐時間已到，無法繼續下單")):B("notEnough",e.data)};d([]);const Oe=async()=>{ye.value=!1},Se=d(!0),Le=e=>{Se.value=e},Pe=()=>{Se.value=!1,le.value.getCarData()};Se.value=!0;const Ue=d(!0);d(-1);const Ne=d(),De=d(),Ke=d(!1);return _((()=>{$("globalLock",(e=>{Z.value=1==e})),$("sendHead",(e=>{const t=-1!=parseInt(e.buffet_expired_time);if(Ue.value=1==e.is_buy_continue,!t)return ae.value=!1,void(Ke.value=!1);const a=e.buffet_remaining_time,l=60*parseInt(e.minute);a<=l&&Ne.value>=l&&(q.value=e.minute,J.value=!0),Ne.value=a;const s=ae.value;if(ae.value=0==e.buffet_remaining_time,ae.value!=s&&1==ae.value&&(J.value=!0),1==e.is_remain_continue){const t=e.buffet_order_remaining_time,a=60*parseInt(e.remain_continue_notice_time);t<=a&&De.value>=a&&(X.value=e.remain_continue_notice_time,V.value=!0),De.value=t;const l=Ke.value;Ke.value=0==e.buffet_order_remaining_time,Ke.value!=l&&1==Ke.value&&1!=ae.value&&(V.value=!0)}})),$("buffet_remain",(e=>{ce(e)}))})),G((()=>{null==D||D.getCategory(!0),null==f||f.getCacheGoodsList(!0)})),Q((()=>{W("globalLock"),W("closeShowLanguage"),W("refresh"),W("buffet_remain")})),n({handleSuccess:ie}),(i,n)=>{const d=p(m("ti-loading"),pe),r=E,v=A,_=c,f=p(m("ti-empty-data"),Ce),I=w,O=p(m("l-ball"),Ye),L=p(m("ti-drawer"),Ae),D=p(m("ti-modal"),xe);return e(),l(s,null,[h(_,{class:"ti-dish-box"},{default:a((()=>[h(Ze,{categoryId:H.value.category_id,"onUpdate:categoryId":n[0]||(n[0]=e=>H.value.category_id=e),isSpecial:Y.value,"onUpdate:isSpecial":n[1]||(n[1]=e=>Y.value=e)},null,8,["categoryId","isSpecial"]),h(_,{class:"ti-dish-list"},{default:a((()=>[h(I,{class:"ti-scroll","scroll-y":"","lower-threshold":50,onScrolltolower:oe},{default:a((()=>{var i,n;return[g(y)?(e(),t(d,{key:0})):(null==(i=g(b))?void 0:i.list)&&(null==(n=g(b))?void 0:n.list.length)>0?(e(),l(s,{key:1},[h(_,{class:"ti-dish-goods"},{default:a((()=>[(e(!0),l(s,null,u(S.value,((l,s)=>(e(),t(_,{key:s,class:k([{"sold-out":l.product_stock<=0||1==l.limit_num_status},"ti-goods-item"]),onClick:e=>(async(e,t)=>{if(t.product_stock<=0)return uni.showToast({title:P("已售罄"),icon:"none"});if(1==t.limit_num_status)return uni.showToast({title:P("已限購"),icon:"none"});if(!Ke.value||ae.value||1!=t.is_buffet){if(Ue.value){if(Ke.value&&1==t.is_buffet)return void ce(P("自助餐时间已到达，自助餐商品不可继续下单"))}else if(ae.value&&Ke.value)return void ce(P("用餐時間已到，無法添加商品"));if((null==t?void 0:t.sku)&&(null==t?void 0:t.sku.length)<=1&&t.product_attr&&0==t.product_attr.length&&t.product_feed&&0==t.product_feed.length)return se.value.action(e),he(t);R.value=!0,F.value=t}else ce(P("點餐時間已到，無法繼續下單"))})(e,l)},{default:a((()=>[h(_,{class:"ti-goods-image"},{default:a((()=>[l.image&&l.image[0]&&l.image[0].file_path?(e(),t(r,{key:0,src:l.image[0].file_path,mode:"widthFix"},null,8,["src"])):(e(),t(r,{key:1,src:He,mode:"widthFix"})),l.product_stock<=0?(e(),t(v,{key:2,class:"sold-out-text"},{default:a((()=>[x(C(g(P)("已售罄")),1)])),_:1})):o("",!0),1==l.limit_num_status?(e(),t(v,{key:3,class:"sold-out-text"},{default:a((()=>[x(C(g(P)("已限購")),1)])),_:1})):o("",!0)])),_:2},1024),h(_,{class:"ti-goods-content"},{default:a((()=>[h(_,{class:"ti-goods-title line-clamp-2"},{default:a((()=>[x(C(l.product_name[g(T)()]||l.product_name_text||"-"),1)])),_:2},1024),h(_,{class:"ti-price-box"},{default:a((()=>[h(v,{class:"ti-goods-price"},{default:a((()=>[x(C(g(U)((null==l?void 0:l.product_price)||0)),1)])),_:2},1024),h(v,{class:"ti-goods-subPrice"},{default:a((()=>[x(C(g(N)((null==l?void 0:l.product_price)||0)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),1==(null==l?void 0:l.is_buffet)&&(null==l?void 0:l.buffet_limit_num)>0||0==(null==l?void 0:l.is_buffet)&&(null==l?void 0:l.limit_num)>0?(e(),t(_,{key:0,class:"ti-restriction"},{default:a((()=>[x(C(g(M)("限購{count}份",{count:1==(null==l?void 0:l.is_buffet)?null==l?void 0:l.buffet_limit_num:(null==l?void 0:l.limit_num)||0})),1)])),_:2},1024)):o("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),h(d,{status:g(b).isNextPage?"loading":"no-more"},null,8,["status"])],64)):(e(),t(f,{key:2}))]})),_:1})])),_:1}),h(_,{class:"ti-car-order-nav"},{default:a((()=>[h(O,{ref_key:"ballRef",ref:se,offset:150,size:23,duration:500},{default:a((({active:e})=>[h(st,{ref_key:"carRef",ref:le,class:k(["nav-car",{active:e}]),onCar:ve,onConfirm:_e},null,8,["class"])])),_:1},512)])),_:1})])),_:1}),h(lt,{show:R.value,"onUpdate:show":n[2]||(n[2]=e=>R.value=e),goodsDetail:F.value,onCancel:ne,onSuccess:ue},null,8,["show","goodsDetail"]),h(nt,{style:{"z-index":"9999"},show:ye.value,"onUpdate:show":n[3]||(n[3]=e=>ye.value=e),productList:ge.value,onConfirm:Oe},null,8,["show","productList"]),h(L,{show:re.value,width:603.992,title:g(P)("我點的菜"),maskClick:!0,onChange:ke},{content:a((()=>[h(_,{class:"ti-drawer-content"},{default:a((()=>[h(_,{class:"ti-content-head"},{default:a((()=>[h(_,{class:"ti-switch-box"},{default:a((()=>[h(_,{class:k(Se.value?"ti-switch-on":"ti-switch-off"),onClick:n[4]||(n[4]=e=>Le(!0))},{default:a((()=>[h(v,{class:k(Se.value?"ti-switch-text-on":"ti-switch-text-off")},{default:a((()=>[x(C(g(P)("未下單")),1)])),_:1},8,["class"])])),_:1},8,["class"]),h(_,{class:"ti-switch-space"}),h(_,{class:k(Se.value?"ti-switch-off":"ti-switch-on"),onClick:n[5]||(n[5]=e=>Le(!1))},{default:a((()=>[h(v,{class:k(Se.value?"ti-switch-text-off":"ti-switch-text-on")},{default:a((()=>[x(C(g(P)("已下單")),1)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})])),_:1}),Se.value?(e(),t(it,{key:0,buyContinue:Ue.value,isOverTime:ae.value,isOrderOverTime:Ke.value,onSuccess:Pe,onChange:ie,onSendkitchenFail:Ie},null,8,["buyContinue","isOverTime","isOrderOverTime"])):o("",!0),Se.value?o("",!0):(e(),t(ot,{key:1}))])),_:1})])),footer:a((()=>[h(_)])),_:1},8,["show","title"]),h(D,{class:"ti-action-tips",show:J.value,"onUpdate:show":n[6]||(n[6]=e=>J.value=e),isCancelShow:!1,onConfirm:n[7]||(n[7]=e=>J.value=!1)},{title:a((()=>[h(_,{class:"warning-header"},{default:a((()=>[h(_,{class:"warning-image-round"},{default:a((()=>[h(r,{class:"warning-image",src:Je})])),_:1}),ae.value?(e(),t(_,{key:1,class:"warning-text"},{default:a((()=>[x(C(g(P)("用餐時間結束")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:a((()=>[h(v,null,{default:a((()=>[x(C(g(P)("用餐")),1)])),_:1}),h(v,null,{default:a((()=>[x(C(g(P)("還有")),1)])),_:1}),h(v,{class:"warning-text red"},{default:a((()=>[x(C(q.value),1)])),_:1}),h(v,null,{default:a((()=>[x(C(g(P)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:a((()=>[ae.value?(e(),t(_,{key:1,class:"warning-text"},{default:a((()=>[x(C(g(P)("如有需要，請呼叫服務員")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:a((()=>[h(v,null,{default:a((()=>[x(C(g(P)("請盡快用餐,如有需要，請呼叫服務員")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:V.value,"onUpdate:show":n[8]||(n[8]=e=>V.value=e),isCancelShow:!1,onConfirm:n[9]||(n[9]=e=>V.value=!1)},{title:a((()=>[h(_,{class:"warning-header"},{default:a((()=>[h(_,{class:"warning-image-round"},{default:a((()=>[h(r,{class:"warning-image",src:Je})])),_:1}),Ke.value?(e(),t(_,{key:1,class:"warning-text"},{default:a((()=>[x(C(g(P)("點餐時間結束")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:a((()=>[h(v,null,{default:a((()=>[x(C(g(P)("點餐")),1)])),_:1}),h(v,null,{default:a((()=>[x(C(g(P)("還有")),1)])),_:1}),h(v,{class:"warning-text red"},{default:a((()=>[x(C(X.value),1)])),_:1}),h(v,null,{default:a((()=>[x(C(g(P)("分鐘")),1)])),_:1})])),_:1}))])),_:1})])),content:a((()=>[Ke.value?(e(),t(_,{key:1,class:"warning-text"},{default:a((()=>[x(C(g(P)("如有需要，請呼叫服務員")),1)])),_:1})):(e(),t(_,{key:0,class:"warning-text"},{default:a((()=>[h(v,null,{default:a((()=>[x(C(g(P)("請在剩餘時間完成選購")),1)])),_:1})])),_:1}))])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:Z.value,"onUpdate:show":n[10]||(n[10]=e=>Z.value=e),isCancelShow:!1,isConfirmShow:!1},{title:a((()=>[h(_,{class:"warning-header"},{default:a((()=>[h(_,{class:"warning-image-round"},{default:a((()=>[h(r,{class:"warning-image",src:Ve})])),_:1}),h(_,{class:"warning-text"},{default:a((()=>[x(C(g(P)("订单已锁定")),1)])),_:1})])),_:1})])),footer:a((()=>[h(_)])),_:1},8,["show"]),h(D,{class:"ti-action-tips",show:ee.value,"onUpdate:show":n[11]||(n[11]=e=>ee.value=e),isCancelShow:!1,isConfirmShow:!0,onConfirm:n[12]||(n[12]=e=>ee.value=!1),title:g(P)("溫馨提示"),content:te.value},{title:a((()=>[h(_,{class:"warning-header"},{default:a((()=>[h(_,{class:"warning-image-round"},{default:a((()=>[h(r,{class:"warning-image",src:Je})])),_:1}),h(_,{class:"warning-text"},{default:a((()=>[x(C(g(P)("温馨提示")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])],64)}}},[["__scopeId","data-v-68314407"]]),dt=Ue({__name:"opentable-index",setup(l){const s=we(),u=Te();Ie(),d();const i=()=>{D()},o=d(),n=d(),r=d("");d([]);const v=d(),f=d(!1),y=d({ip:"",port:"",device_id:""}),b=()=>{const e=V();y.value.ip=(null==e?void 0:e.ip)||q()||"127.0.0.1",y.value.port=(null==e?void 0:e.port)||"8080"},w=e=>{y.value.ip=e},k=e=>{y.value.port=e},T=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const a=await le(se(`${null==t?void 0:t.ip}:${t.port}`));ue(t),ie(a.data.app_id),oe(a.data.shop_supplier_id),ee(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{f.value=!0}),150)}catch(a){uni.showToast({title:P("绑定失败"),icon:"none"})}else uni.showToast({title:P("請輸入連接埠"),icon:"none"});else uni.showToast({title:P("請輸入伺服器位址"),icon:"none"})},I=e=>{f.value=!1,e&&(v.value=e,r.value=e.table_no)},O=()=>{b(),r.value=Z().table_no,v.value=Z()},S=async()=>{var e;const t={...y.value};if(t.ip)if(t.port)try{const a=await le(se(`${null==t?void 0:t.ip}:${t.port}`));if(!v.value)return void uni.showToast({title:P("請查找桌位"),icon:"none"});ue(t),ie(a.data.app_id),oe(a.data.shop_supplier_id),ee(null==(e=a.data)?void 0:e.currency),setTimeout((()=>{L()}),150)}catch(a){uni.showToast({title:P("绑定失败"),icon:"none"})}else uni.showToast({title:P("請輸入連接埠"),icon:"none"});else uni.showToast({title:P("請輸入伺服器位址"),icon:"none"})},L=async()=>{if(j()===v.value.table_id)return uni.showToast({title:P("绑定成功"),icon:"none"}),n.value=!1,ne(!1),void setTimeout((()=>{ce({url:"/pages/index/index"})}),150);try{await de({table_id:v.value.table_id,old_table_id:j()});re(v.value),uni.showToast({title:P("绑定成功"),icon:"none"}),n.value=!1,ne(!1),setTimeout((()=>{ce({url:"/pages/index/index"})}),150)}catch(e){}},U=d(!1),N=d(!1),D=()=>{U.value=!0,N.value=!0},K=async e=>{if(e)try{await he({password:e});n.value=!0,v.value=Z(),r.value=v.value.table_no,B()}catch(t){}else uni.showToast({title:P("請輸入密碼"),icon:"none"})},B=()=>{U.value=!1,N.value=!1};b(),$("goodsRefresh",(()=>{null==s||s.getCategory(!0),null==u||u.getCacheGoodsList(!0)}));const E=d({name:"",logo:"",tableNo:"",is_call_service:1}),R=async e=>{var t,a,l;if(z())try{const s=await X(e);E.value.name=s.data.name,E.value.logo=s.data.logo,E.value.tableNo=Z().table_no,E.value.is_call_service=parseInt(null==(a=null==(t=null==s?void 0:s.data)?void 0:t.tablet)?void 0:a.is_call_service),ee(null==(l=s.data)?void 0:l.currency),te(s)}catch(s){}};return $("refresh",(e=>{R(!1)})),Y((()=>{R(!1)})),Q((()=>{W("refresh")})),_((()=>{Oe()?y.value.device_id=Se():H({success:e=>{y.value.device_id=e.deviceId}})})),J((()=>{var e;null==(e=o.value)||e.showBuffet(!0,0)})),(l,s)=>{const u=p(m("ti-layout-head"),ge),d=c,v=A,_=p(m("ti-input"),Le),b=p(m("ti-layout-table-list"),Pe),L=p(m("ti-modal"),xe);return e(),t(d,{class:"ti-page"},{default:a((()=>[h(d,null,{default:a((()=>[h(u,{ref_key:"refCallServer",ref:o,isPay:!0,isTableNo:!0,onDoubleLogo:i,is_call_service:parseInt(E.value.is_call_service)},null,8,["is_call_service"])])),_:1}),h(ct),h(me,{show:U.value,title:g(P)("密碼"),password:N.value,placeholder:g(P)("請輸入密碼"),onExit:B,onConfirm:K},null,8,["show","title","password","placeholder"]),h(L,{show:n.value,title:g(P)("設置"),cancelText:g(P)("重置"),confirmText:g(P)("確定"),onCancel:O,onConfirm:S},{content:a((()=>[h(d,{class:"ti-item-input"},{default:a((()=>[h(d,{class:"ti-label-box"},{default:a((()=>[h(d,{class:"ti-label-left"},{default:a((()=>[h(v,{class:"ti-label-server"},{default:a((()=>[x(C(g(P)("服務器連接地址")),1)])),_:1})])),_:1}),h(d,{class:"ti-label-right",onClick:T},{default:a((()=>[h(v,{class:"ti-label-table"},{default:a((()=>[x(C(r.value?g(P)("已選 : ")+g(ae)(r.value,19):g(P)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),h(d,{class:"ti-input-box"},{default:a((()=>[h(_,{type:"text",onInput:w,value:y.value.ip,placeholder:g(P)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),h(d,{class:"ti-colon"},{default:a((()=>[x(":")])),_:1}),h(d,{class:"ti-input-port"},{default:a((()=>[h(_,{type:"number",onInput:k,value:y.value.port,placeholder:g(P)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1})])),_:1}),h(b,{show:f.value,"onUpdate:show":s[0]||(s[0]=e=>f.value=e),onConfirm:I},null,8,["show"])])),_:1},8,["show","title","cancelText","confirmText"])])),_:1})}}},[["__scopeId","data-v-247e2d8b"]]);export{dt as default};
