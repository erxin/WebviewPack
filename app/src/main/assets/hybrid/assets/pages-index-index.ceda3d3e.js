import{u as e,a,s as l,r as t,o as s,i,b as o,c as u,d as n,e as r,g as c,f as d,h as v,j as f,w as _,k as p,l as b,m,n as h,p as w,q as g,t as y,F as x,v as k,x as T,$ as C,y as I,z as F,A as j,B as E,C as U,D as $,E as B,G as D,H as S,I as L,J as R,K as A,L as q,M as z,N as G,O as H,P as J,Q as K,R as M,S as N,T as O,U as P,V as Q,W as V,X as W}from"./index-794d2c93.js";import{D as X,v as Y,_ as Z}from"./verify.8ff84953.js";import{i as ee,g as ae,_ as le,a as te,b as se}from"./platform.9e65a980.js";import{_ as ie}from"./ti-button.d7cdd364.js";import"./components-ti-keyboard-ti-keyboard.be852b43.js";const oe=""+new URL("icon-ring-192350e1.svg",import.meta.url).href,ue=ie({__name:"index",setup(ie){const ue=e(),ne=a(),{userInfo:re}=l(ue),{tableInfo:ce}=l(ne),{getUserInfo:de,setUserInfo:ve}=e(),{getTableInfoAsync:fe}=a(),_e=t(!1),pe=t(!1);fe();const be=t(0),me=t(!0),he=t(!1),we=t(!1),ge=t(),ye=e=>{var a,l;be.value=e.detail.current,xe(null==(l=null==(a=re.value)?void 0:a.tablet)?void 0:l.carousel,be.value)};t([]);const xe=(e,a)=>{const l=e[a];"video"==j(l.real_name)?setTimeout((()=>{ge.value=l,we.value=!0,me.value=!1,he.value=!0}),50):he.value=!1},ke=()=>{var e,a,l,t;we.value=!1,me.value=!0,be.value==(null==(a=null==(e=re.value)?void 0:e.tablet)?void 0:a.carousel.length)-1?(be.value=0,xe(null==(t=null==(l=re.value)?void 0:l.tablet)?void 0:t.carousel,be.value)):be.value+=1},Te=()=>{Ve()},Ce=()=>{u({url:"/pages/index/index"})},Ie=t(),Fe=t("");t([]);const je=t(),Ee=t(!1),Ue=t({ip:"",port:"",device_id:"",remark:""}),$e=()=>{const e=b();Ue.value.ip=(null==e?void 0:e.ip)||m()||"127.0.0.1",Ue.value.port=(null==e?void 0:e.port)||"8080"},Be=e=>{Ue.value.remark=e},De=e=>{Ue.value.ip=e},Se=e=>{Ue.value.port=e},Le=async()=>{var e;const a={...Ue.value};if(a.ip)if(a.port)try{const l=await E(U(`${null==a?void 0:a.ip}:${a.port}`));1==parseInt(l.data.cashier.order_method.is_table_order)?($(a),B(l.data.app_id),D(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{Ee.value=!0}),150)):uni.showToast({title:C("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:C("绑定失败"),icon:"none"})}else uni.showToast({title:C("請輸入連接埠"),icon:"none"});else uni.showToast({title:C("請輸入伺服器位址"),icon:"none"})},Re=e=>{Ee.value=!1,e&&(je.value=e,Fe.value=e.table_no)},Ae=()=>{$e(),Fe.value=L().table_no,je.value=L()},qe=async()=>{var e;const a={...Ue.value};if(a.ip)if(a.port)try{const l=await E(U(`${null==a?void 0:a.ip}:${a.port}`));if(!je.value)return void uni.showToast({title:C("請查找桌位"),icon:"none"});1==parseInt(l.data.cashier.order_method.is_table_order)?($(a),B(l.data.app_id),D(l.data.shop_supplier_id),S(null==(e=l.data)?void 0:e.currency),setTimeout((()=>{ze()}),150)):uni.showToast({title:C("桌台用餐方式已关闭，请联系管理员"),icon:"none"})}catch(l){uni.showToast({title:C("绑定失败"),icon:"none"})}else uni.showToast({title:C("請輸入連接埠"),icon:"none"});else uni.showToast({title:C("請輸入伺服器位址"),icon:"none"})},ze=async()=>{if(Ue.value.remark!=R("machine_remark")&&A({key:"machine_remark",data:Ue.value.remark}),q()===je.value.table_id)return uni.showToast({title:C("绑定成功"),icon:"none"}),void(Ie.value=!1);try{const e=await z({table_id:je.value.table_id,old_table_id:q()});G(je.value),de(),fe(),uni.showToast({title:e.msg,icon:"none"}),Ie.value=!1}catch(e){}},Ge=t(),He=t(!1),Je=async()=>{var e,a,l,t,s;if(de(),1===parseInt(null==(e=null==re?void 0:re.value)?void 0:e.tablet.is_customer_order)&&1===parseInt(null==(a=null==re?void 0:re.value)?void 0:a.cashier.order_method.is_table_order))try{const e=await H({table_id:q()});if(1===parseInt(e.data.tablet.is_customer_order))if(10===e.data.status)Ne();else{if(1==(null==(t=e.data.order)?void 0:t.is_buffet))return He.value=!0,void(pe.value=!0);Ke()}else null==(s=Ge.value)||s.tiCallClick("1")}catch(i){}else null==(l=Ge.value)||l.tiCallClick("1")},Ke=()=>{J(!0),u({url:"/pages/index/opentable-index"})},Me=t(!1),Ne=()=>{Me.value=!0},Oe=e=>{var a;Me.value=!1,e&&(null==(a=Ge.value)||a.tiCallClick("1"))},Pe=t(!1),Qe=t(!1),Ve=()=>{Pe.value=!0,Qe.value=!0},We=async e=>{if(e)try{await Y({password:e});Ie.value=!0,Ue.value.remark=R("machine_remark")||"",je.value=L(),Fe.value=je.value.table_no,Xe()}catch(a){}else uni.showToast({title:C("請輸入密碼"),icon:"none",duration:3e3})},Xe=()=>{(()=>{Pe.value=!1,Qe.value=!1;const e=setTimeout((()=>{Ie.value,clearTimeout(e)}),300)})()};return t({name:"",logo:"",table_no:"",is_call_service:1,is_customer_order:1}),s((()=>{i()&&o()&&u({url:"/pages/index/opentable-index"})})),n((()=>{var e;null==(e=Ge.value)||e.showBuffet(!1,0)})),$e(),r((()=>{ee()?Ue.value.device_id=ae():c({success:e=>{Ue.value.device_id=e.deviceId}})})),(e,a)=>{const l=K(M("ti-layout-head"),Z),t=h,s=N,u=O,n=P,r=Q,c=V,b=K(M("ti-input"),le),m=K(M("ti-layout-table-list"),te),E=K(M("ti-modal"),se),U=W;return d(i)()&&!d(o)()?(v(),f(t,{key:0,class:"ti-page",onClick:a[3]||(a[3]=e=>d(F)())},{default:_((()=>[w(t,null,{default:_((()=>{var e,a;return[w(l,{ref_key:"refCallServer",ref:Ge,onDoubleLogo:Te,onRefresh:Ce,is_call_service:parseInt(null==(a=null==(e=d(re))?void 0:e.tablet)?void 0:a.is_call_service)},null,8,["is_call_service"])]})),_:1}),w(t,{class:"ti-page-content"},{default:_((()=>{var e;return[w(t,{class:"ti-page-left"},{default:_((()=>[we.value?p("",!0):(v(),f(n,{key:0,onChange:ye,class:"ti-swiper",current:be.value,autoplay:me.value,circular:"",interval:"30000","indicator-dots":!0,"indicator-color":"#FFFFFF80","indicator-active-color":"#FFBE00"},{default:_((()=>{var e,a;return[(v(!0),g(x,null,y(null==(a=null==(e=d(re))?void 0:e.tablet)?void 0:a.carousel,((e,a)=>(v(),f(u,{class:"ti-swiper-item",key:a},{default:_((()=>["image"===d(j)(e.real_name)?(v(),f(s,{key:0,class:"ti-swiper-item-image",mode:"scaleToFill",src:e.file_path},null,8,["src"])):p("",!0),"video"===d(j)(e.real_name)?(v(),f(s,{key:1,class:"ti-swiper-item-image",mode:"scaleToFill",src:""})):p("",!0)])),_:2},1024)))),128))]})),_:1},8,["current","autoplay"])),we.value?(v(),f(n,{key:1,class:"ti-swiper"},{default:_((()=>[w(u,{class:"ti-swiper-item"},{default:_((()=>{var e;return[w(r,{onEnded:ke,class:"ti-swiper-item-video",controls:!1,"show-fullscreen-btn":!1,autoplay:!0,src:null==(e=ge.value)?void 0:e.file_path},null,8,["src"])]})),_:1})])),_:1})):p("",!0)])),_:1}),w(t,{class:"ti-page-right"},{default:_((()=>[w(t,{class:"ti-store-box"},{default:_((()=>[w(t,{class:"ti-store-item"},{default:_((()=>{var e;return[w(s,{class:"ti-store-logo",src:null==(e=d(re))?void 0:e.logo},null,8,["src"]),w(c,{class:"ti-store-name"},{default:_((()=>{var e;return[k(T(null==(e=d(re))?void 0:e.name),1)]})),_:1})]})),_:1}),w(t,{class:"ti-table-item"},{default:_((()=>[w(t,{class:"ti-table-number"},{default:_((()=>{var e;return[k(T(d(C)("當前桌號："))+T(null==(e=d(ce))?void 0:e.table_no),1)]})),_:1}),w(t,{class:"ti-table-button",onClick:Je},{default:_((()=>[w(c,{class:"ti-table-button-text"},{default:_((()=>[k(T(d(C)("開始點餐")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),w(X,{show:Me.value,title:"["+(null==(e=d(ce))?void 0:e.table_no)+"]"+d(C)("就餐人数"),placeholder:d(C)("請輸入人數"),isBuffet:!0,password:Qe.value,onExit:Oe},null,8,["show","title","placeholder","password"]),w(X,{show:Pe.value,title:d(C)("密碼"),password:Qe.value,placeholder:d(C)("請輸入密碼"),onExit:Xe,onConfirm:We},null,8,["show","title","password","placeholder"])]})),_:1}),w(E,{show:Ie.value,title:d(C)("設置"),cancelText:d(C)("重置"),confirmText:d(C)("確定"),onCancel:Ae,onConfirm:qe},{content:_((()=>[w(t,{class:"ti-item-input"},{default:_((()=>[w(t,{class:"ti-label-box"},{default:_((()=>[w(t,{class:"ti-label-left"},{default:_((()=>[w(c,{class:"ti-label-server"},{default:_((()=>[k(T(d(C)("當前機器ID")),1)])),_:1})])),_:1})])),_:1}),w(t,{class:"ti-input-box"},{default:_((()=>[w(b,{type:"text",clearable:!1,disabled:!0,value:Ue.value.device_id},null,8,["value"])])),_:1})])),_:1}),w(t,{class:"ti-item-input"},{default:_((()=>[w(t,{class:"ti-label-box"},{default:_((()=>[w(t,{class:"ti-label-left"},{default:_((()=>[w(c,{class:"ti-label-server"},{default:_((()=>[k(T(d(C)("機器備註(非必填)")),1)])),_:1})])),_:1})])),_:1}),w(t,{class:"ti-input-box"},{default:_((()=>[w(b,{type:"text",value:Ue.value.remark,onInput:Be,placeholder:d(C)("機器備註"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),w(t,{class:"ti-item-input"},{default:_((()=>[w(t,{class:"ti-label-box"},{default:_((()=>[w(t,{class:"ti-label-left"},{default:_((()=>[w(c,{class:"ti-label-server"},{default:_((()=>[k(T(d(C)("服務器連接地址")),1)])),_:1})])),_:1}),w(t,{class:"ti-label-right",onClick:Le},{default:_((()=>[w(c,{class:"ti-label-table"},{default:_((()=>[k(T(Fe.value?d(C)("已選 : ")+d(I)(Fe.value,19):d(C)("查找桌位")),1)])),_:1})])),_:1})])),_:1}),w(t,{class:"ti-input-box"},{default:_((()=>[w(b,{type:"text",onInput:De,value:Ue.value.ip,placeholder:d(C)("伺服器位址"),clearable:!1},null,8,["value","placeholder"]),w(t,{class:"ti-colon"},{default:_((()=>[k(":")])),_:1}),w(t,{class:"ti-input-port"},{default:_((()=>[w(b,{type:"number",onInput:Se,value:Ue.value.port,placeholder:d(C)("端口"),clearable:!1},null,8,["value","placeholder"])])),_:1})])),_:1}),w(m,{show:Ee.value,"onUpdate:show":a[0]||(a[0]=e=>Ee.value=e),onConfirm:Re},null,8,["show"])])),_:1})])),_:1},8,["show","title","cancelText","confirmText"]),w(E,{class:"ti-dialog-buffet",show:pe.value,title:d(C)("提示"),onCancel:a[1]||(a[1]=e=>(pe.value=!1,void(He.value=!1))),onConfirm:a[2]||(a[2]=e=>Ke())},{content:_((()=>[w(t,{class:"ti-dialog-content"},{default:_((()=>[w(U,{class:"ti-buffet-scroll","scroll-y":""},{default:_((()=>[w(t,{class:"ti-buffet-message"},{default:_((()=>[w(t,{class:"ti-buffet-case"}),w(t,{class:"ti-buffet-text"},{default:_((()=>[k(T(d(C)("如有剩餘食物，可能產生額外費用")),1)])),_:1})])),_:1}),w(t,{class:"ti-buffet-message"},{default:_((()=>[w(t,{class:"ti-buffet-case"}),w(t,{class:"ti-buffet-text"},{default:_((()=>[k(T(d(C)("點菜時請考慮您的飽食量，只訂購能夠完全食用的食品數量")),1)])),_:1})])),_:1}),w(t,{class:"ti-buffet-message"},{default:_((()=>[w(t,{class:"ti-buffet-case"}),w(t,{class:"ti-buffet-text"},{default:_((()=>[k(T(d(C)("對於食品和飲品的過度點單，可能會引發額外費用")),1)])),_:1})])),_:1}),w(t,{class:"ti-buffet-message"},{default:_((()=>[w(t,{class:"ti-buffet-case"}),w(t,{class:"ti-buffet-text"},{default:_((()=>[k(T(d(C)("如有多餘食物或飲品浪費的情況，我們可能會視情況追加費用")),1)])),_:1})])),_:1}),w(t,{class:"ti-buffet-tips"},{default:_((()=>[k(T(d(C)("我们鼓励客人谨慎点菜，仅订购会食用完的食品，避免剩菜问题和额外费用")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["show","title"]),w(E,{class:"ti-action-tips",show:_e.value,title:d(C)("店鋪到期"),isCancelShow:!1,isConfirmShow:!1,content:d(C)("店鋪狀態已到期，如需使用，請聯繫銷售代表")},{title:_((()=>[w(t,{class:"warning-header"},{default:_((()=>[w(t,{class:"warning-image-round"},{default:_((()=>[w(s,{class:"warning-image",src:oe,mode:""})])),_:1}),w(t,{class:"warning-text"},{default:_((()=>[k(T(d(C)("店鋪到期")),1)])),_:1})])),_:1})])),_:1},8,["show","title","content"])])),_:1})):p("",!0)}}},[["__scopeId","data-v-08f1b9ed"]]);export{ue as default};
